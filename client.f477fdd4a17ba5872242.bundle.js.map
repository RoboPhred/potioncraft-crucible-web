{"version":3,"file":"client.f477fdd4a17ba5872242.bundle.js","mappings":"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","sources":["webpack://potioncraft-mapmixer-web/./src/entities/defs/DangerZonePart/Bone1.png","webpack://potioncraft-mapmixer-web/./src/entities/defs/DangerZonePart/Bone2.png","webpack://potioncraft-mapmixer-web/./src/entities/defs/DangerZonePart/Fang1.png","webpack://potioncraft-mapmixer-web/./src/entities/defs/DangerZonePart/Fang2.png","webpack://potioncraft-mapmixer-web/./src/entities/defs/DangerZonePart/Skull1.png","webpack://potioncraft-mapmixer-web/./src/entities/defs/PotionEffect/Acid.webp","webpack://potioncraft-mapmixer-web/./src/entities/defs/PotionEffect/Berserker.webp","webpack://potioncraft-mapmixer-web/./src/entities/defs/PotionEffect/Bounce.webp","webpack://potioncraft-mapmixer-web/./src/entities/defs/PotionEffect/Charm.webp","webpack://potioncraft-mapmixer-web/./src/entities/defs/PotionEffect/Crop.webp","webpack://potioncraft-mapmixer-web/./src/entities/defs/PotionEffect/Explosion.webp","webpack://potioncraft-mapmixer-web/./src/entities/defs/PotionEffect/Fire.webp","webpack://potioncraft-mapmixer-web/./src/entities/defs/PotionEffect/Fly.webp","webpack://potioncraft-mapmixer-web/./src/entities/defs/PotionEffect/Frost.webp","webpack://potioncraft-mapmixer-web/./src/entities/defs/PotionEffect/Growth.webp","webpack://potioncraft-mapmixer-web/./src/entities/defs/PotionEffect/Hallucinations.webp","webpack://potioncraft-mapmixer-web/./src/entities/defs/PotionEffect/Healing.webp","webpack://potioncraft-mapmixer-web/./src/entities/defs/PotionEffect/Invisibility.webp","webpack://potioncraft-mapmixer-web/./src/entities/defs/PotionEffect/Libido.webp","webpack://potioncraft-mapmixer-web/./src/entities/defs/PotionEffect/Light.webp","webpack://potioncraft-mapmixer-web/./src/entities/defs/PotionEffect/Lightning.webp","webpack://potioncraft-mapmixer-web/./src/entities/defs/PotionEffect/Mana.webp","webpack://potioncraft-mapmixer-web/./src/entities/defs/PotionEffect/Necromancy.webp","webpack://potioncraft-mapmixer-web/./src/entities/defs/PotionEffect/Poison.webp","webpack://potioncraft-mapmixer-web/./src/entities/defs/PotionEffect/SharpVision.webp","webpack://potioncraft-mapmixer-web/./src/entities/defs/PotionEffect/Sleep.webp","webpack://potioncraft-mapmixer-web/./src/entities/defs/PotionEffect/SlowDown.webp","webpack://potioncraft-mapmixer-web/./src/entities/defs/PotionEffect/StoneSkin.webp","webpack://potioncraft-mapmixer-web/./src/components/Button/Button.module.css?a282","webpack://potioncraft-mapmixer-web/./src/components/MapEditor/MapEditor.module.css?4c56","webpack://potioncraft-mapmixer-web/./src/components/MapEditor/components/DragPreview/DragPreview.module.css?695a","webpack://potioncraft-mapmixer-web/./src/components/MapEditor/components/MapCanvas.module.css?0101","webpack://potioncraft-mapmixer-web/./src/components/MapEditor/components/MapWidgets/MapWidgets.module.css?039a","webpack://potioncraft-mapmixer-web/./src/components/MapEditor/components/PanZoomHandler/PanZoomHandler.module.css?8fc8","webpack://potioncraft-mapmixer-web/./src/components/Menus/Menus.module.css?27a7","webpack://potioncraft-mapmixer-web/./src/components/TitleBar/TitleBar.module.css?c6e3","webpack://potioncraft-mapmixer-web/./src/components/ToolBar/ToolBar.module.css?1b30","webpack://potioncraft-mapmixer-web/./src/pages/editor/EditorPage.module.css?5d2f","webpack://potioncraft-mapmixer-web/./src/pages/editor/components/EntityTrayWindow/EntityTrayWindow.module.css?c396","webpack://potioncraft-mapmixer-web/./src/pages/editor/components/MapWindow/MapWindow.module.css?1b4c","webpack://potioncraft-mapmixer-web/./src/pages/editor/components/Window/Window.module.css?46f6","webpack://potioncraft-mapmixer-web/./src/actions/editor-modifierkeys-changed.ts","webpack://potioncraft-mapmixer-web/./src/actions/editor-mouse-down.ts","webpack://potioncraft-mapmixer-web/./src/actions/editor-mouse-move.ts","webpack://potioncraft-mapmixer-web/./src/actions/editor-mouse-out.ts","webpack://potioncraft-mapmixer-web/./src/actions/editor-mouse-up.ts","webpack://potioncraft-mapmixer-web/./src/actions/editor-pan.ts","webpack://potioncraft-mapmixer-web/./src/actions/editor-rendered.ts","webpack://potioncraft-mapmixer-web/./src/actions/editor-tool-radius-set.ts","webpack://potioncraft-mapmixer-web/./src/actions/editor-tool-set.ts","webpack://potioncraft-mapmixer-web/./src/actions/editor-viewport-resize.ts","webpack://potioncraft-mapmixer-web/./src/actions/editor-zoom.ts","webpack://potioncraft-mapmixer-web/./src/actions/entity-delete.ts","webpack://potioncraft-mapmixer-web/./src/actions/entity-insert.ts","webpack://potioncraft-mapmixer-web/./src/actions/entity-offset.ts","webpack://potioncraft-mapmixer-web/./src/actions/entity-prototype-instantiate.ts","webpack://potioncraft-mapmixer-web/./src/actions/initialize.ts","webpack://potioncraft-mapmixer-web/./src/actions/map-config-load-blank.ts","webpack://potioncraft-mapmixer-web/./src/actions/map-config-load-file.ts","webpack://potioncraft-mapmixer-web/./src/actions/map-config-load-template.ts","webpack://potioncraft-mapmixer-web/./src/actions/map-config-receive.ts","webpack://potioncraft-mapmixer-web/./src/actions/map-config-save.ts","webpack://potioncraft-mapmixer-web/./src/actions/select-clear.ts","webpack://potioncraft-mapmixer-web/./src/actions/select-entity.ts","webpack://potioncraft-mapmixer-web/./src/actions/selection-delete.ts","webpack://potioncraft-mapmixer-web/./src/actions/set-language.ts","webpack://potioncraft-mapmixer-web/./src/arrays.ts","webpack://potioncraft-mapmixer-web/./src/canvas.ts","webpack://potioncraft-mapmixer-web/./src/components/AbstractLoadButton.tsx","webpack://potioncraft-mapmixer-web/./src/components/AutoPopover.tsx","webpack://potioncraft-mapmixer-web/./src/components/Button/Button.tsx","webpack://potioncraft-mapmixer-web/./src/components/Button/index.ts","webpack://potioncraft-mapmixer-web/./src/components/FileMenu.tsx","webpack://potioncraft-mapmixer-web/./src/components/FileMenuButton.tsx","webpack://potioncraft-mapmixer-web/./src/components/MapEditorToolbar/MapEditorToolBar.tsx","webpack://potioncraft-mapmixer-web/./src/components/MapEditorToolbar/index.ts","webpack://potioncraft-mapmixer-web/./src/components/MapEditor/MapEditor.tsx","webpack://potioncraft-mapmixer-web/./src/components/MapEditor/components/DragPreview/DragPreview.tsx","webpack://potioncraft-mapmixer-web/./src/components/MapEditor/components/DragPreview/index.ts","webpack://potioncraft-mapmixer-web/./src/components/MapEditor/components/MapCanvas.tsx","webpack://potioncraft-mapmixer-web/./src/components/MapEditor/components/MapWidgets/MapWidgets.tsx","webpack://potioncraft-mapmixer-web/./src/components/MapEditor/components/MapWidgets/index.ts","webpack://potioncraft-mapmixer-web/./src/components/MapEditor/components/PanZoomHandler/PanZoomHandler.tsx","webpack://potioncraft-mapmixer-web/./src/components/MapEditor/components/PanZoomHandler/index.ts","webpack://potioncraft-mapmixer-web/./src/components/MapEditor/index.ts","webpack://potioncraft-mapmixer-web/./src/components/MapEditor/keymap.ts","webpack://potioncraft-mapmixer-web/./src/components/Menus/DividerMenuItem.tsx","webpack://potioncraft-mapmixer-web/./src/components/Menus/Menu.tsx","webpack://potioncraft-mapmixer-web/./src/components/Menus/MenuCloseContext.tsx","webpack://potioncraft-mapmixer-web/./src/components/Menus/MenuItem.tsx","webpack://potioncraft-mapmixer-web/./src/components/Menus/SubMenuItem.tsx","webpack://potioncraft-mapmixer-web/./src/components/Popover/Popover.tsx","webpack://potioncraft-mapmixer-web/./src/components/Popover/PopoverChildContext.tsx","webpack://potioncraft-mapmixer-web/./src/components/Popover/index.ts","webpack://potioncraft-mapmixer-web/./src/components/TitleBar/TitleBar.tsx","webpack://potioncraft-mapmixer-web/./src/components/TitleBar/index.ts","webpack://potioncraft-mapmixer-web/./src/components/ToolBar/ToggleButton.tsx","webpack://potioncraft-mapmixer-web/./src/components/ToolBar/ToolBar.tsx","webpack://potioncraft-mapmixer-web/./src/drag-items/new-entity.ts","webpack://potioncraft-mapmixer-web/./src/entities/consts.ts","webpack://potioncraft-mapmixer-web/./src/entities/defs/DangerZonePart/DangerZonePart.ts","webpack://potioncraft-mapmixer-web/./src/entities/defs/DangerZonePart/index.ts","webpack://potioncraft-mapmixer-web/./src/entities/defs/ExperienceBonus.ts","webpack://potioncraft-mapmixer-web/./src/entities/defs/PotionEffect/PotionEffect.ts","webpack://potioncraft-mapmixer-web/./src/entities/defs/PotionEffect/index.ts","webpack://potioncraft-mapmixer-web/./src/entities/defs/Vortex.ts","webpack://potioncraft-mapmixer-web/./src/entities/defs/index.ts","webpack://potioncraft-mapmixer-web/./src/entities/index.ts","webpack://potioncraft-mapmixer-web/./src/entities/tiles/index.ts","webpack://potioncraft-mapmixer-web/./src/fp-set.ts","webpack://potioncraft-mapmixer-web/./src/geometry.ts","webpack://potioncraft-mapmixer-web/./src/history.ts","webpack://potioncraft-mapmixer-web/./src/hooks/use-action.ts","webpack://potioncraft-mapmixer-web/./src/hooks/use-array-state.ts","webpack://potioncraft-mapmixer-web/./src/hooks/use-component-bounds.ts","webpack://potioncraft-mapmixer-web/./src/hooks/use-native-event.ts","webpack://potioncraft-mapmixer-web/./src/hooks/use-outside-mouse-event.ts","webpack://potioncraft-mapmixer-web/./src/hooks/use-selector.ts","webpack://potioncraft-mapmixer-web/./src/index.tsx","webpack://potioncraft-mapmixer-web/./src/map-templates/index.ts","webpack://potioncraft-mapmixer-web/./src/modifier-keys.ts","webpack://potioncraft-mapmixer-web/./src/pages/editor/EditorPage.tsx","webpack://potioncraft-mapmixer-web/./src/pages/editor/components/EntityTrayWindow/EntityTrayWindow.tsx","webpack://potioncraft-mapmixer-web/./src/pages/editor/components/EntityTrayWindow/components/EntityCategory.tsx","webpack://potioncraft-mapmixer-web/./src/pages/editor/components/EntityTrayWindow/components/EntityTrayItem.tsx","webpack://potioncraft-mapmixer-web/./src/pages/editor/components/EntityTrayWindow/index.ts","webpack://potioncraft-mapmixer-web/./src/pages/editor/components/MapWindow/MapWindow.tsx","webpack://potioncraft-mapmixer-web/./src/pages/editor/components/MapWindow/index.ts","webpack://potioncraft-mapmixer-web/./src/pages/editor/components/Window/Window.tsx","webpack://potioncraft-mapmixer-web/./src/pages/editor/components/Window/index.ts","webpack://potioncraft-mapmixer-web/./src/reducer/index.ts","webpack://potioncraft-mapmixer-web/./src/reducer/priorities.ts","webpack://potioncraft-mapmixer-web/./src/reducer/utils.ts","webpack://potioncraft-mapmixer-web/./src/root.tsx","webpack://potioncraft-mapmixer-web/./src/routes.tsx","webpack://potioncraft-mapmixer-web/./src/runtime-env.ts","webpack://potioncraft-mapmixer-web/./src/selection-mode.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-damage/reducer/editor-rendered.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-damage/reducer/editor-viewport.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-damage/reducer/entity-delete.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-damage/reducer/entity-insert.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-damage/reducer/entity-offset.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-damage/reducer/entity-prototype-instantiate.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-damage/reducer/index.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-damage/reducer/map-config-receive.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-damage/reducer/select-clear.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-damage/reducer/select-entity.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-damage/selector/damage.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-damage/state-utils.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-damage/state.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-mouse/reducer/index.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-mouse/reducer/modifierkeys-changed.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-mouse/reducer/mouse-down.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-mouse/reducer/mouse-move.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-mouse/reducer/mouse-out.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-mouse/reducer/mouse-up.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-mouse/reducer/tool-radius-set.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-mouse/reducer/tool-set.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-mouse/selectors/drag-move.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-mouse/selectors/drag-select.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-mouse/selectors/tools.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-mouse/selectors/viewport.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-mouse/selectors/world-coords.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-mouse/state-utils.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-mouse/state.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-selection/reducer/entity-delete.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-selection/reducer/index.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-selection/reducer/select-clear.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-selection/reducer/select-entity.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-selection/reducer/selection-delete.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-selection/selectors/selection.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-selection/state-utils.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-selection/state.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-view/hooks/use-client-to-world.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-view/reducer/index.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-view/reducer/pan.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-view/reducer/viewport-resize.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-view/reducer/zoom.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-view/selectors/coordinate-mapping.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-view/selectors/view.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-view/selectors/viewport.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-view/state-utils.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-view/state.ts","webpack://potioncraft-mapmixer-web/./src/services/editor-view/utils.ts","webpack://potioncraft-mapmixer-web/./src/services/i18n/components/I18NProvider.tsx","webpack://potioncraft-mapmixer-web/./src/services/i18n/i18n.ts","webpack://potioncraft-mapmixer-web/./src/services/i18n/persist.ts","webpack://potioncraft-mapmixer-web/./src/services/i18n/reducer/index.ts","webpack://potioncraft-mapmixer-web/./src/services/i18n/reducer/set-language.ts","webpack://potioncraft-mapmixer-web/./src/services/i18n/selectors/language.ts","webpack://potioncraft-mapmixer-web/./src/services/i18n/state-utils.ts","webpack://potioncraft-mapmixer-web/./src/services/i18n/state.ts","webpack://potioncraft-mapmixer-web/./src/services/map-config/hooks/use-load-map-file.ts","webpack://potioncraft-mapmixer-web/./src/services/map-config/reducer/index.ts","webpack://potioncraft-mapmixer-web/./src/services/map-config/reducer/load-map-config.ts","webpack://potioncraft-mapmixer-web/./src/services/map-config/reducer/receive-map-config.ts","webpack://potioncraft-mapmixer-web/./src/services/map-config/saga/index.ts","webpack://potioncraft-mapmixer-web/./src/services/map-config/saga/map-config-load-blank.ts","webpack://potioncraft-mapmixer-web/./src/services/map-config/saga/map-config-load-file.ts","webpack://potioncraft-mapmixer-web/./src/services/map-config/saga/map-config-load-template.ts","webpack://potioncraft-mapmixer-web/./src/services/map-config/saga/map-config-save.ts","webpack://potioncraft-mapmixer-web/./src/services/map-config/selectors/loading-status.ts","webpack://potioncraft-mapmixer-web/./src/services/map-config/selectors/mapfile.ts","webpack://potioncraft-mapmixer-web/./src/services/map-config/state-utils.ts","webpack://potioncraft-mapmixer-web/./src/services/map-config/state.ts","webpack://potioncraft-mapmixer-web/./src/services/map-entities/reducer/entity-delete.ts","webpack://potioncraft-mapmixer-web/./src/services/map-entities/reducer/entity-insert.ts","webpack://potioncraft-mapmixer-web/./src/services/map-entities/reducer/entity-offset.ts","webpack://potioncraft-mapmixer-web/./src/services/map-entities/reducer/index.ts","webpack://potioncraft-mapmixer-web/./src/services/map-entities/reducer/map-config-receive.ts","webpack://potioncraft-mapmixer-web/./src/services/map-entities/reducer/prototype-instantiate.ts","webpack://potioncraft-mapmixer-web/./src/services/map-entities/regions.ts","webpack://potioncraft-mapmixer-web/./src/services/map-entities/selectors/entities.ts","webpack://potioncraft-mapmixer-web/./src/services/map-entities/state-utils.ts","webpack://potioncraft-mapmixer-web/./src/services/map-entities/state.ts","webpack://potioncraft-mapmixer-web/./src/services/reducer.ts","webpack://potioncraft-mapmixer-web/./src/services/saga.ts","webpack://potioncraft-mapmixer-web/./src/services/state-utils.ts","webpack://potioncraft-mapmixer-web/./src/services/state.ts","webpack://potioncraft-mapmixer-web/./src/state/index.ts","webpack://potioncraft-mapmixer-web/./src/state/utils.ts","webpack://potioncraft-mapmixer-web/./src/store/components/StoreProvider.tsx","webpack://potioncraft-mapmixer-web/./src/store/devtool-sanitizer.ts","webpack://potioncraft-mapmixer-web/./src/store/persist.ts","webpack://potioncraft-mapmixer-web/./src/store/saga.ts","webpack://potioncraft-mapmixer-web/./src/store/store.ts","webpack://potioncraft-mapmixer-web/./src/styles/index.ts"],"sourcesContent":["export default __webpack_public_path__ + \"images/554d4c65ae62724e74ab87f14f6fe6ae.png\";","export default __webpack_public_path__ + \"images/b9abe1d41494982388dba21bab297d3c.png\";","export default __webpack_public_path__ + \"images/90667fb5ba9b6b13ead765d8c6233b09.png\";","export default __webpack_public_path__ + \"images/f93c64ca68cd65730b9b6882b9ad5644.png\";","export default __webpack_public_path__ + \"images/17cf2f6e99bc4e1097986eac8a120524.png\";","export default __webpack_public_path__ + \"images/221df70616e53e4adcc239d508cca27a.webp\";","export default __webpack_public_path__ + \"images/afd188ea0b8a9c7598917eddc7aa5481.webp\";","export default __webpack_public_path__ + \"images/4a875ad087353ad771e4f222709b72ba.webp\";","export default __webpack_public_path__ + \"images/e88610192bc7d2b00e72cd441538c9d9.webp\";","export default __webpack_public_path__ + \"images/6039ffef3bde5c940dc845de6dd5b3c9.webp\";","export default __webpack_public_path__ + \"images/99e25220cb5cb11a802383490d99235b.webp\";","export default __webpack_public_path__ + \"images/4afbe707e81ee3b5183a74b15e678b68.webp\";","export default __webpack_public_path__ + \"images/a52ebfbbbcb501afbaf558d4c7d6e3d1.webp\";","export default __webpack_public_path__ + \"images/704a4eff3197be060bc4fb03c2124400.webp\";","export default __webpack_public_path__ + \"images/669cf5f857252a3ac756aed8e3d8ea56.webp\";","export default __webpack_public_path__ + \"images/d5668bec9dc8a2a70199da9a4497c0b0.webp\";","export default __webpack_public_path__ + \"images/bfcec0bd586c56af5ce0bb3a8ac9e6d1.webp\";","export default __webpack_public_path__ + \"images/a557e1a6ecfad5fbdbf506ccae14ea97.webp\";","export default __webpack_public_path__ + \"images/8f8d5769174b41bbd3c6485f75e70760.webp\";","export default __webpack_public_path__ + \"images/e0583dc482f0a8d3fb92d00f2e515c25.webp\";","export default __webpack_public_path__ + \"images/408fedd8899830ebf6ff1b866146591f.webp\";","export default __webpack_public_path__ + \"images/146c499d47700195fe3f98d94eb4bed8.webp\";","export default __webpack_public_path__ + \"images/03e3e21ed25868123c7dcd654cdc16a4.webp\";","export default __webpack_public_path__ + \"images/d440bb6ae84e5c842ed5e63edb299b9e.webp\";","export default __webpack_public_path__ + \"images/0a1fcec0b89a89566dea0f1bd80c8be2.webp\";","export default __webpack_public_path__ + \"images/9cc8f61a9e4daed2f175fd73a61357cc.webp\";","export default __webpack_public_path__ + \"images/d97e4ef4e1b54f52788bdf0514707854.webp\";","export default __webpack_public_path__ + \"images/33e2bac94c3099303e31e54cf854c513.webp\";","// extracted by mini-css-extract-plugin\nexport default {\"button\":\"button--rRkjR\",\"disabled\":\"disabled--FkB9N\",\"button--size-small\":\"button--size-small--tjZi7\",\"button--variant-primary\":\"button--variant-primary--MU4Xz\",\"button--variant-text\":\"button--variant-text--q2G_L\",\"button--variant-menu\":\"button--variant-menu--lkzTq\"};","// extracted by mini-css-extract-plugin\nexport default {\"map-editor\":\"map-editor--CxdeU\",\"hotkeys-container\":\"hotkeys-container--_toW8\",\"map-editor-container\":\"map-editor-container--_YO7c\",\"map-editor-item\":\"map-editor-item--ytSJP\"};","// extracted by mini-css-extract-plugin\nexport default {\"drag-preview\":\"drag-preview--OwODL\"};","// extracted by mini-css-extract-plugin\nexport default {\"map-canvas\":\"map-canvas--D53bb\"};","// extracted by mini-css-extract-plugin\nexport default {\"map-widgets\":\"map-widgets--VBMgc\"};","// extracted by mini-css-extract-plugin\nexport default {\"pan-zoom-handler\":\"pan-zoom-handler--nL1s7\"};","// extracted by mini-css-extract-plugin\nexport default {\"menu\":\"menu--W9WLz\",\"menu-item\":\"menu-item--juzxZ\",\"menu-item--disabled\":\"menu-item--disabled--_0p3x\",\"menu-item-content\":\"menu-item-content--mA3cH\",\"menu-item-text\":\"menu-item-text--aajNI\",\"menu-item-secondary\":\"menu-item-secondary--YVuq4\",\"menu-item-icon\":\"menu-item-icon--ZXjd0\",\"menu-divider\":\"menu-divider--_Evx2\"};","// extracted by mini-css-extract-plugin\nexport default {\"titlebar\":\"titlebar--uHLA9\",\"titlebar-heading\":\"titlebar-heading--c3QIH\",\"titlebar-divider\":\"titlebar-divider--FQJW7\",\"titlebar-title\":\"titlebar-title--gEy31\"};","// extracted by mini-css-extract-plugin\nexport default {\"toolbar\":\"toolbar--QwrHO\",\"toolbar-togglebutton\":\"toolbar-togglebutton--yb5up\",\"toolbar-togglebutton-pressed\":\"toolbar-togglebutton-pressed--cZbsH\"};","// extracted by mini-css-extract-plugin\nexport default {\"editor-page\":\"editor-page--Dy3BK\",\"editor-page-content\":\"editor-page-content--Agnfz\"};","// extracted by mini-css-extract-plugin\nexport default {\"entity-tray-window\":\"entity-tray-window--zqy9I\",\"entity-tray-list\":\"entity-tray-list--_jFGv\",\"entity-tray-category\":\"entity-tray-category--fTxME\",\"entity-tray-item\":\"entity-tray-item--CBa2g\",\"entity-tray-item-preview\":\"entity-tray-item-preview--KJBwu\",\"entity-tray-item-text\":\"entity-tray-item-text--_VCcu\"};","// extracted by mini-css-extract-plugin\nexport default {\"map-window\":\"map-window--kbaCr\",\"map-window-container\":\"map-window-container--eo336\",\"map-window-editor\":\"map-window-editor--SCOpX\"};","// extracted by mini-css-extract-plugin\nexport default {\"window\":\"window--i5HQq\",\"window-titlebar\":\"window-titlebar--bDj_8\",\"window-title\":\"window-title--QH8S5\",\"window-content\":\"window-content--_EHs_\"};","import { ModifierKeys } from \"@/modifier-keys\";\r\nimport { AnyAction } from \"redux\";\r\n\r\nexport const ACTION_EDITOR_MODIFIERKEYS_CHANGED =\r\n  \"editor-modifierkeys-changed\" as const;\r\nexport const editorModifierKeysChanged = (modifiers: ModifierKeys) => ({\r\n  type: ACTION_EDITOR_MODIFIERKEYS_CHANGED,\r\n  payload: { modifiers },\r\n});\r\nexport type EditorModifierKeysChangedAction = ReturnType<\r\n  typeof editorModifierKeysChanged\r\n>;\r\nexport function isEditorModifierKeysChangedAction(\r\n  action: AnyAction\r\n): action is EditorModifierKeysChangedAction {\r\n  return action.type === ACTION_EDITOR_MODIFIERKEYS_CHANGED;\r\n}\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { Point } from \"@/geometry\";\r\nimport { ModifierKeys } from \"@/modifier-keys\";\r\n\r\nexport const ACTION_EDITOR_MOUSE_DOWN = \"editor-mouse-down\" as const;\r\nexport const editorMouseDown = (\r\n  viewportPos: Point,\r\n  modifierKeys: ModifierKeys\r\n) => ({\r\n  type: ACTION_EDITOR_MOUSE_DOWN,\r\n  payload: { viewportPos, modifierKeys },\r\n});\r\nexport type EditorMouseDownAction = ReturnType<typeof editorMouseDown>;\r\nexport function isEditorMouseDownAction(\r\n  action: AnyAction\r\n): action is EditorMouseDownAction {\r\n  return action.type === ACTION_EDITOR_MOUSE_DOWN;\r\n}\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { Point } from \"@/geometry\";\r\nimport { ModifierKeys } from \"@/modifier-keys\";\r\n\r\nexport const ACTION_EDITOR_MOUSE_MOVE = \"editor-mouse-move\" as const;\r\nexport const editorMouseMove = (\r\n  viewportPos: Point,\r\n  modifierKeys: ModifierKeys\r\n) => ({\r\n  type: ACTION_EDITOR_MOUSE_MOVE,\r\n  payload: { viewportPos, modifierKeys },\r\n});\r\nexport type EditorMouseMoveAction = ReturnType<typeof editorMouseMove>;\r\nexport function isEditorMouseMoveAction(\r\n  action: AnyAction\r\n): action is EditorMouseMoveAction {\r\n  return action.type === ACTION_EDITOR_MOUSE_MOVE;\r\n}\r\n","import { AnyAction } from \"redux\";\r\n\r\nexport const ACTION_EDITOR_MOUSE_OUT = \"editor-mouse-out\" as const;\r\nexport const editorMouseOut = () => ({\r\n  type: ACTION_EDITOR_MOUSE_OUT,\r\n});\r\nexport type EditorMouseOutAction = ReturnType<typeof editorMouseOut>;\r\nexport function isEditorMouseOutAction(\r\n  action: AnyAction\r\n): action is EditorMouseOutAction {\r\n  return action.type === ACTION_EDITOR_MOUSE_OUT;\r\n}\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { Point } from \"@/geometry\";\r\nimport { ModifierKeys } from \"@/modifier-keys\";\r\n\r\nexport const ACTION_EDITOR_MOUSE_UP = \"editor-mouse-up\" as const;\r\nexport const editorMouseUp = (\r\n  viewportPos: Point,\r\n  modifierKeys: ModifierKeys\r\n) => ({\r\n  type: ACTION_EDITOR_MOUSE_UP,\r\n  payload: { viewportPos, modifierKeys },\r\n});\r\nexport type EditorMouseUpAction = ReturnType<typeof editorMouseUp>;\r\nexport function isEditorMouseUpAction(\r\n  action: AnyAction\r\n): action is EditorMouseUpAction {\r\n  return action.type === ACTION_EDITOR_MOUSE_UP;\r\n}\r\n","import { AnyAction } from \"redux\";\r\n\r\nexport const ACTION_EDITOR_PAN = \"editor-pan\" as const;\r\nexport const editorPan = (xOffset: number, yOffset: number) => ({\r\n  type: ACTION_EDITOR_PAN,\r\n  payload: { x: xOffset, y: yOffset },\r\n});\r\nexport type EditorPanAction = ReturnType<typeof editorPan>;\r\nexport function isEditorPanAction(\r\n  action: AnyAction\r\n): action is EditorPanAction {\r\n  return action.type === ACTION_EDITOR_PAN;\r\n}\r\n","import { AnyAction } from \"redux\";\r\n\r\nexport const ACTION_EDITOR_RENDERED = \"editor-rendered\" as const;\r\nexport const editorRendered = () => ({\r\n  type: ACTION_EDITOR_RENDERED,\r\n});\r\nexport function isEditorRenderedAction(action: AnyAction): boolean {\r\n  return action.type === ACTION_EDITOR_RENDERED;\r\n}\r\n","import { AnyAction } from \"redux\";\r\n\r\nexport const ACTION_EDITOR_TOOL_RADIUS_SET = \"editor-tool-radius-set\" as const;\r\nexport const editorToolRadiusSet = (radius: number) => ({\r\n  type: ACTION_EDITOR_TOOL_RADIUS_SET,\r\n  payload: { radius },\r\n});\r\nexport type EditorToolRadiusSetAction = ReturnType<typeof editorToolRadiusSet>;\r\nexport function isEditorToolRadiusSetAction(\r\n  action: AnyAction\r\n): action is EditorToolRadiusSetAction {\r\n  return action.type === ACTION_EDITOR_TOOL_RADIUS_SET;\r\n}\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { EditorMouseTool } from \"@/services/editor-mouse/state\";\r\n\r\nexport const ACTION_EDITOR_TOOL_SET = \"editor-tool-set\" as const;\r\nexport const editorToolSet = (tool: EditorMouseTool) => ({\r\n  type: ACTION_EDITOR_TOOL_SET,\r\n  payload: { tool },\r\n});\r\nexport type EditorToolSetAction = ReturnType<typeof editorToolSet>;\r\nexport function isEditorToolSetAction(\r\n  action: AnyAction\r\n): action is EditorToolSetAction {\r\n  return action.type === ACTION_EDITOR_TOOL_SET;\r\n}\r\n","import { AnyAction } from \"redux\";\r\n\r\nexport const ACTION_EDITOR_VIEWPORT_RESIZE = \"editor-viewport-resize\" as const;\r\nexport const editorViewportResize = (width: number, height: number) => ({\r\n  type: ACTION_EDITOR_VIEWPORT_RESIZE,\r\n  payload: { width, height },\r\n});\r\nexport type EditorViewportResizeAction = ReturnType<\r\n  typeof editorViewportResize\r\n>;\r\nexport function isEditorViewportResizeAction(\r\n  action: AnyAction\r\n): action is EditorViewportResizeAction {\r\n  return action.type === ACTION_EDITOR_VIEWPORT_RESIZE;\r\n}\r\n","import { AnyAction } from \"redux\";\r\n\r\nexport const ACTION_EDITOR_ZOOM = \"editor-zoom\" as const;\r\nexport const editorZoom = (zoomFactor: number) => ({\r\n  type: ACTION_EDITOR_ZOOM,\r\n  payload: { zoomFactor },\r\n});\r\nexport type EditorZoomAction = ReturnType<typeof editorZoom>;\r\nexport function isEditorZoomAction(\r\n  action: AnyAction\r\n): action is EditorZoomAction {\r\n  return action.type === ACTION_EDITOR_ZOOM;\r\n}\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { asArray, MaybeArray } from \"@/arrays\";\r\n\r\nexport const ACTION_ENTITY_DELETE = \"entity-delete\" as const;\r\nexport const entityDelete = (entityKeys: MaybeArray<string>) => ({\r\n  type: ACTION_ENTITY_DELETE,\r\n  payload: {\r\n    entityKeys: asArray(entityKeys),\r\n  },\r\n});\r\nexport type EntityDeleteAction = ReturnType<typeof entityDelete>;\r\nexport function isEntityDeleteAction(\r\n  action: AnyAction\r\n): action is EntityDeleteAction {\r\n  return action.type === ACTION_ENTITY_DELETE;\r\n}\r\n","import { AnyAction } from \"redux\";\r\nimport mapKeys from \"lodash/mapKeys\";\r\nimport { v4 as uuidV4 } from \"uuid\";\r\n\r\nimport { asArray, MaybeArray } from \"@/arrays\";\r\nimport { MapEntity } from \"@/map-config\";\r\n\r\nexport const ACTION_ENTITY_INSERT = \"action-entity-insert\";\r\nexport const entityInsert = (entity: MaybeArray<MapEntity>) => ({\r\n  type: ACTION_ENTITY_INSERT,\r\n  payload: { entities: mapKeys(asArray(entity), (x) => uuidV4()) },\r\n});\r\nexport type EntityInsertAction = ReturnType<typeof entityInsert>;\r\nexport function isEntityInsertAction(\r\n  action: AnyAction\r\n): action is EntityInsertAction {\r\n  return action.type === ACTION_ENTITY_INSERT;\r\n}\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { asArray, MaybeArray } from \"@/arrays\";\r\n\r\nexport const ACTION_ENTITY_OFFSET = \"entity-offset\" as const;\r\nexport const entityOffset = (\r\n  entityKeys: MaybeArray<string>,\r\n  offsetX: number,\r\n  offsetY: number\r\n) => ({\r\n  type: ACTION_ENTITY_OFFSET,\r\n  payload: {\r\n    entityKeys: asArray(entityKeys),\r\n    offsetX,\r\n    offsetY,\r\n  },\r\n});\r\nexport type EntityOffsetAction = ReturnType<typeof entityOffset>;\r\nexport function isEntityOffsetAction(\r\n  action: AnyAction\r\n): action is EntityOffsetAction {\r\n  return action.type === ACTION_ENTITY_OFFSET;\r\n}\r\n","import { AnyAction } from \"redux\";\r\nimport { v4 as uuidV4 } from \"uuid\";\r\n\r\nimport { Point } from \"@/geometry\";\r\nimport { MapEntityPrototype } from \"@/map-config\";\r\n\r\nexport const ACTION_ENTITY_PROTOTYPE_INSTANTIATE =\r\n  \"editor-prototype-instantiate\" as const;\r\nexport const entityPrototypeInstantiate = (\r\n  prototype: MapEntityPrototype,\r\n  worldPos: Point\r\n) => ({\r\n  type: ACTION_ENTITY_PROTOTYPE_INSTANTIATE,\r\n  payload: { prototype, worldPos, entityKey: uuidV4() },\r\n});\r\nexport type EntityPrototypeInstantiateAction = ReturnType<\r\n  typeof entityPrototypeInstantiate\r\n>;\r\nexport function isEntityPrototypeInstantiateAction(\r\n  action: AnyAction\r\n): action is EntityPrototypeInstantiateAction {\r\n  return action.type === ACTION_ENTITY_PROTOTYPE_INSTANTIATE;\r\n}\r\n","export const ACTION_INITIALIZE = \"@initialize\" as const;\r\nexport const initialize = () => ({\r\n  type: ACTION_INITIALIZE,\r\n});\r\n","import { AnyAction } from \"redux\";\r\n\r\nexport const ACTION_MAPCONFIG_LOAD_BLANK = \"mapconfig-load-blank\" as const;\r\nexport const mapConfigLoadBlank = () => ({\r\n  type: ACTION_MAPCONFIG_LOAD_BLANK,\r\n});\r\nexport type MapConfigLoadBlankAction = ReturnType<typeof mapConfigLoadBlank>;\r\nexport function isMapConfigLoadBlankAction(\r\n  action: AnyAction\r\n): action is MapConfigLoadBlankAction {\r\n  return action.type === ACTION_MAPCONFIG_LOAD_BLANK;\r\n}\r\n","import { AnyAction } from \"redux\";\r\n\r\nexport const ACTION_MAPCONFIG_LOAD_FILE = \"mapconfig-load-file\" as const;\r\nexport const mapConfigLoadFile = (file: File) => ({\r\n  type: ACTION_MAPCONFIG_LOAD_FILE,\r\n  payload: { file },\r\n});\r\nexport type MapConfigLoadFileAction = ReturnType<typeof mapConfigLoadFile>;\r\nexport function isMapConfigLoadFileAction(\r\n  action: AnyAction\r\n): action is MapConfigLoadFileAction {\r\n  return action.type === ACTION_MAPCONFIG_LOAD_FILE;\r\n}\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { TemplateName } from \"@/map-templates\";\r\n\r\nexport const ACTION_MAPCONFIG_LOAD_TEMPLATE =\r\n  \"mapconfig-load-template\" as const;\r\nexport const mapConfigLoadTemplate = (templateName: TemplateName) => ({\r\n  type: ACTION_MAPCONFIG_LOAD_TEMPLATE,\r\n  payload: { templateName },\r\n});\r\nexport type MapConfigLoadTemplateAction = ReturnType<\r\n  typeof mapConfigLoadTemplate\r\n>;\r\nexport function isMapConfigLoadTemplateAction(\r\n  action: AnyAction\r\n): action is MapConfigLoadTemplateAction {\r\n  return action.type === ACTION_MAPCONFIG_LOAD_TEMPLATE;\r\n}\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { MapConfig } from \"@/map-config\";\r\n\r\nexport const ACTION_MAPFILE_RECEIVE = \"receive-mapfile\" as const;\r\nexport const mapConfigReceive = (mapConfig: MapConfig) => ({\r\n  type: ACTION_MAPFILE_RECEIVE,\r\n  payload: { mapConfig },\r\n});\r\nexport type MapConfigReceiveAction = ReturnType<typeof mapConfigReceive>;\r\nexport function isMapConfigReceiveAction(\r\n  action: AnyAction\r\n): action is MapConfigReceiveAction {\r\n  return action.type === ACTION_MAPFILE_RECEIVE;\r\n}\r\n","export const ACTION_MAPCONFIG_SAVE = \"mapconfig-save\" as const;\r\nexport const mapConfigSave = () => ({\r\n  type: ACTION_MAPCONFIG_SAVE,\r\n});\r\n","import { AnyAction } from \"redux\";\r\n\r\nexport const ACTION_SELECT_CLEAR = \"select-clear\" as const;\r\nexport const selectClear = () => ({\r\n  type: ACTION_SELECT_CLEAR,\r\n});\r\nexport type ClearSelectionAction = ReturnType<typeof selectClear>;\r\nexport function isSelectClearAction(\r\n  action: AnyAction\r\n): action is ClearSelectionAction {\r\n  return action.type === ACTION_SELECT_CLEAR;\r\n}\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { asArray, MaybeArray } from \"@/arrays\";\r\nimport { SelectionMode } from \"@/selection-mode\";\r\n\r\nexport const ACTION_SELECT_ENTITY = \"select-entity\" as const;\r\nexport const selectEntity = (\r\n  entityKeys: MaybeArray<string>,\r\n  mode: SelectionMode = \"set\"\r\n) => ({\r\n  type: ACTION_SELECT_ENTITY,\r\n  payload: { entityKeys: asArray(entityKeys), mode },\r\n});\r\nexport type SelectEntityAction = ReturnType<typeof selectEntity>;\r\nexport function isSelectEntityAction(\r\n  action: AnyAction\r\n): action is SelectEntityAction {\r\n  return action.type === ACTION_SELECT_ENTITY;\r\n}\r\n","import { AnyAction } from \"redux\";\r\n\r\nexport const ACTION_SELECTION_DELETE = \"selection-delete\" as const;\r\nexport const selectionDelete = () => ({\r\n  type: ACTION_SELECTION_DELETE,\r\n});\r\nexport type SelectionDeleteAction = ReturnType<typeof selectionDelete>;\r\nexport function isSelectionDeleteAction(\r\n  action: AnyAction\r\n): action is SelectionDeleteAction {\r\n  return action.type === ACTION_SELECTION_DELETE;\r\n}\r\n","export const ACTION_SET_LANGUAGE = \"app/set-language\";\r\nexport const setLanguage = (language: string) => ({\r\n  type: ACTION_SET_LANGUAGE as typeof ACTION_SET_LANGUAGE,\r\n  payload: language\r\n});\r\nexport type SetLanguageAction = ReturnType<typeof setLanguage>;\r\n","export type MaybeArray<T> = T | T[];\r\nexport function asArray<T>(x: MaybeArray<T>): T[] {\r\n  return Array.isArray(x) ? x : [x];\r\n}\r\n","import { EntityDefsByType } from \"./entities\";\r\nimport { POTION_RADIUS } from \"./entities/consts\";\r\nimport { MapEntity } from \"./map-config\";\r\n\r\nexport function transformToMap(\r\n  ctx: CanvasRenderingContext2D,\r\n  zoomFactor: number,\r\n  offsetX: number,\r\n  offsetY: number,\r\n  handler: () => void\r\n) {\r\n  ctx.save();\r\n  ctx.scale(zoomFactor, zoomFactor);\r\n  ctx.translate(-offsetX + 60, -offsetY + 60);\r\n  ctx.scale(1, -1);\r\n\r\n  handler();\r\n  ctx.restore();\r\n}\r\n\r\nexport function renderPotionStart(ctx: CanvasRenderingContext2D) {\r\n  ctx.beginPath();\r\n  ctx.fillStyle = \"blue\";\r\n  ctx.arc(0, 0, POTION_RADIUS, 0, 2 * Math.PI);\r\n  ctx.fill();\r\n}\r\n\r\nexport function renderEntity(\r\n  ctx: CanvasRenderingContext2D,\r\n  entity: MapEntity,\r\n  isSelected: boolean\r\n) {\r\n  const type = EntityDefsByType[entity.entityType];\r\n  if (!type) {\r\n    return;\r\n  }\r\n\r\n  ctx.save();\r\n\r\n  ctx.translate(entity.x, entity.y);\r\n  type.render(ctx, entity, (ctx) => {\r\n    if (isSelected) {\r\n      ctx.fillStyle = \"lightblue\";\r\n    }\r\n  });\r\n\r\n  ctx.restore();\r\n}\r\n","import * as React from \"react\";\r\n\r\nimport useLoadMapConfig from \"@/services/map-config/hooks/use-load-map-file\";\r\n\r\nexport interface AbstractLoadButtonProps {\r\n  onInteractionComplete?(): void;\r\n  children(props: AbstractLoadButtonRenderProps): React.ReactChild;\r\n}\r\nexport interface AbstractLoadButtonRenderProps {\r\n  disabled: boolean;\r\n  onClick(): void;\r\n}\r\n\r\ntype Props = AbstractLoadButtonProps;\r\nconst AbstractLoadButton: React.FC<Props> = ({\r\n  onInteractionComplete = () => {},\r\n  children,\r\n}) => {\r\n  const { disabled, onLoadSave } = useLoadMapConfig();\r\n  const inputRef = React.useRef<HTMLInputElement | null>(null);\r\n\r\n  const onClick = React.useCallback(() => {\r\n    if (inputRef.current) {\r\n      inputRef.current.click();\r\n    }\r\n  }, [inputRef]);\r\n\r\n  const onFileChange = React.useCallback(\r\n    (e: React.ChangeEvent<HTMLInputElement>) => {\r\n      const files = e.target.files;\r\n      if (!files || files.length === 0) {\r\n        onInteractionComplete();\r\n        return;\r\n      }\r\n      const file = files[0];\r\n\r\n      onLoadSave(file);\r\n      onInteractionComplete;\r\n    },\r\n    [onLoadSave]\r\n  );\r\n\r\n  return (\r\n    <>\r\n      {children({ disabled, onClick })}\r\n      <input\r\n        ref={inputRef}\r\n        style={{ display: \"none\" }}\r\n        type=\"file\"\r\n        accept=\".json\"\r\n        onChange={onFileChange}\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default AbstractLoadButton;\r\n","import * as React from \"react\";\r\nimport { Options } from \"@popperjs/core\";\r\n\r\nimport Popover from \"./Popover\";\r\nimport { MenuCloseListener } from \"./Menus/MenuCloseContext\";\r\n\r\nexport interface AutoPopoverProps {\r\n  content: JSX.Element;\r\n  placement?: Options[\"placement\"];\r\n}\r\n\r\nconst AutoPopover: React.FC<AutoPopoverProps> = ({\r\n  content,\r\n  placement,\r\n  children,\r\n}) => {\r\n  const anchorEl = React.useRef<HTMLDivElement | null>(null);\r\n\r\n  const [open, setOpen] = React.useState(false);\r\n  const onClick = React.useCallback(() => {\r\n    setOpen(true);\r\n  }, []);\r\n  const onClose = React.useCallback(() => {\r\n    setOpen(false);\r\n  }, []);\r\n\r\n  return (\r\n    <MenuCloseListener onClose={onClose}>\r\n      <div ref={anchorEl} onClick={onClick}>\r\n        {children}\r\n      </div>\r\n      <Popover\r\n        anchorEl={anchorEl.current}\r\n        isOpen={open}\r\n        placement={placement}\r\n        onRequestClose={onClose}\r\n      >\r\n        {open && content}\r\n      </Popover>\r\n    </MenuCloseListener>\r\n  );\r\n};\r\n\r\nexport default AutoPopover;\r\n","import * as React from \"react\";\r\nimport classNames from \"classnames\";\r\n\r\nexport interface ButtonProps extends React.HTMLAttributes<HTMLButtonElement> {\r\n  variant?: \"default\" | \"primary\" | \"text\" | \"menu\";\r\n  size?: \"default\" | \"small\";\r\n  disabled?: boolean;\r\n}\r\n\r\nimport styles from \"./Button.module.css\";\r\n\r\nconst Button: React.FC<ButtonProps> = ({\r\n  variant = \"default\",\r\n  size = \"default\",\r\n  disabled,\r\n  ...props\r\n}) => {\r\n  return (\r\n    <button\r\n      className={classNames(\r\n        styles[\"button\"],\r\n        (styles as any)[`button--variant-${variant}`],\r\n        (styles as any)[`button--size-${size}`],\r\n        disabled && styles[\"disabled\"]\r\n      )}\r\n      type=\"button\"\r\n      {...props}\r\n    >\r\n      {props.children}\r\n    </button>\r\n  );\r\n};\r\n\r\nexport default Button;\r\n","import Button from \"./Button\";\r\nexport default Button;\r\n","import React from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\n\r\nimport { loadingStatusSelector } from \"@/services/map-config/selectors/loading-status\";\r\n\r\nimport { mapConfigLoadBlank } from \"@/actions/map-config-load-blank\";\r\nimport { mapConfigLoadTemplate } from \"@/actions/map-config-load-template\";\r\nimport { mapConfigSave } from \"@/actions/map-config-save\";\r\n\r\nimport { useClickAction } from \"@/hooks/use-action\";\r\nimport { useSelector } from \"@/hooks/use-selector\";\r\n\r\nimport Menu from \"@/components/Menus/Menu\";\r\nimport MenuItem from \"@/components/Menus/MenuItem\";\r\nimport DividerMenuItem from \"@/components/Menus/DividerMenuItem\";\r\nimport SubMenuItem from \"@/components/Menus/SubMenuItem\";\r\nimport { useMenuCloseContext } from \"@/components/Menus/MenuCloseContext\";\r\nimport AbstractLoadButton from \"@/components/AbstractLoadButton\";\r\n\r\nconst FileMenu = () => {\r\n  const { t } = useTranslation();\r\n  const loadingStatus = useSelector(loadingStatusSelector);\r\n  const onNewBlankMap = useClickAction(mapConfigLoadBlank);\r\n  const onSaveMap = useClickAction(mapConfigSave);\r\n  const requestMenuClose = useMenuCloseContext();\r\n\r\n  return (\r\n    <Menu>\r\n      <MenuItem onClick={onNewBlankMap}>{t(\"map.new.blank\")}</MenuItem>\r\n      <SubMenuItem content={<MapFromTemplateMenu />}>\r\n        {t(\"map.new.template\")}\r\n      </SubMenuItem>\r\n      <DividerMenuItem />\r\n      <AbstractLoadButton onInteractionComplete={requestMenuClose}>\r\n        {({ disabled, onClick }) => (\r\n          <MenuItem\r\n            autoDismissMenu={false}\r\n            disabled={disabled}\r\n            onClick={onClick}\r\n          >\r\n            Load Map\r\n          </MenuItem>\r\n        )}\r\n      </AbstractLoadButton>\r\n      <DividerMenuItem />\r\n      <MenuItem disabled={loadingStatus !== \"loaded\"} onClick={onSaveMap}>\r\n        {t(\"map.save\")}\r\n      </MenuItem>\r\n    </Menu>\r\n  );\r\n};\r\n\r\nconst MapFromTemplateMenu = () => {\r\n  const { t } = useTranslation();\r\n  const onNewWaterMap = useClickAction(mapConfigLoadTemplate, \"water\");\r\n  const onNewOilMap = useClickAction(mapConfigLoadTemplate, \"oil\");\r\n  return (\r\n    <Menu>\r\n      <MenuItem onClick={onNewWaterMap}>\r\n        {t(\"potioncraft:bases.water_titlecase\")}\r\n      </MenuItem>\r\n      <MenuItem onClick={onNewOilMap}>\r\n        {t(\"potioncraft:bases.oil_titlecase\")}\r\n      </MenuItem>\r\n    </Menu>\r\n  );\r\n};\r\n\r\nexport default FileMenu;\r\n","import * as React from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\n\r\nimport AutoPopover from \"./AutoPopover\";\r\nimport Button from \"./Button\";\r\nimport FileMenu from \"./FileMenu\";\r\n\r\nconst FileMenuButton = () => {\r\n  const { t } = useTranslation();\r\n\r\n  return (\r\n    <AutoPopover content={<FileMenu />} placement=\"bottom-start\">\r\n      <Button variant=\"menu\">{t(\"menus.file.name\")}</Button>\r\n    </AutoPopover>\r\n  );\r\n};\r\n\r\nexport default FileMenuButton;\r\n","import * as React from \"react\";\r\n\r\nimport { useClickAction } from \"@/hooks/use-action\";\r\nimport { useSelector } from \"@/hooks/use-selector\";\r\n\r\nimport { editorToolSet } from \"@/actions/editor-tool-set\";\r\n\r\nimport {\r\n  currentToolSelector,\r\n  toolRadiusSelector,\r\n} from \"@/services/editor-mouse/selectors/tools\";\r\n\r\nimport ToolBar from \"../ToolBar/ToolBar\";\r\nimport ToggleButton from \"../ToolBar/ToggleButton\";\r\nimport { editorToolRadiusSet } from \"@/actions/editor-tool-radius-set\";\r\n\r\nconst MapEditorToolBar = () => {\r\n  const toolSize = useSelector(toolRadiusSelector);\r\n  const currentTool = useSelector(currentToolSelector);\r\n  const onIncreaseToolSize = useClickAction(\r\n    editorToolRadiusSet,\r\n    toolSize + 0.2\r\n  );\r\n  const onDecreaseToolSize = useClickAction(\r\n    editorToolRadiusSet,\r\n    toolSize - 0.2\r\n  );\r\n  const onPointerClick = useClickAction(editorToolSet, \"pointer\");\r\n  const onEraserClick = useClickAction(editorToolSet, \"eraser\");\r\n  const onBonesClick = useClickAction(editorToolSet, \"paint-danger-zone\");\r\n  return (\r\n    <ToolBar>\r\n      <ToggleButton\r\n        isPressed={currentTool === \"pointer\"}\r\n        onClick={onPointerClick}\r\n      >\r\n        Pointer\r\n      </ToggleButton>\r\n      <ToggleButton\r\n        isPressed={currentTool === \"eraser\"}\r\n        onClick={onEraserClick}\r\n      >\r\n        Eraser\r\n      </ToggleButton>\r\n      <ToggleButton\r\n        isPressed={currentTool === \"paint-danger-zone\"}\r\n        onClick={onBonesClick}\r\n      >\r\n        Bones\r\n      </ToggleButton>\r\n      Brush Size:\r\n      <button onClick={onDecreaseToolSize}>-</button>\r\n      {toolSize.toFixed(1)}\r\n      <button onClick={onIncreaseToolSize}>+</button>\r\n    </ToolBar>\r\n  );\r\n};\r\n\r\nexport default MapEditorToolBar;\r\n","import MapEditorToolBar from \"./MapEditorToolBar\";\r\nexport default MapEditorToolBar;\r\n","import * as React from \"react\";\r\nimport classNames from \"classnames\";\r\nimport { AnyAction } from \"redux\";\r\nimport { HotKeys, ComponentProps } from \"react-hotkeys\";\r\nimport { useDispatch } from \"react-redux\";\r\n\r\nimport { selectionDelete } from \"@/actions/selection-delete\";\r\n\r\nimport PanZoomHandler from \"./components/PanZoomHandler\";\r\nimport MapCanvas from \"./components/MapCanvas\";\r\nimport MapWidgets from \"./components/MapWidgets\";\r\nimport DragPreview from \"./components/DragPreview\";\r\n\r\nimport keymap, { HotkeyHandler, KeymapHandler, KEYMAP_DELETE } from \"./keymap\";\r\n\r\nimport styles from \"./MapEditor.module.css\";\r\n\r\nexport interface MapEditorProps {\r\n  className?: string;\r\n}\r\nconst MapEditor = ({ className }: MapEditorProps) => {\r\n  const dispatch = useDispatch();\r\n  const keyHandlers = React.useMemo(() => {\r\n    function createEventDispatcher(action: AnyAction): HotkeyHandler {\r\n      return (e?: KeyboardEvent) => {\r\n        if (e) {\r\n          if (e.defaultPrevented) {\r\n            return;\r\n          }\r\n          e.preventDefault();\r\n        }\r\n        dispatch(action);\r\n      };\r\n    }\r\n    const keyHandlers: KeymapHandler = {\r\n      [KEYMAP_DELETE]: createEventDispatcher(selectionDelete()),\r\n    };\r\n    return keyHandlers;\r\n  }, []);\r\n\r\n  return (\r\n    <div className={classNames(className, \"map-editor\", styles[\"map-editor\"])}>\r\n      <HotKeys\r\n        keyMap={keymap}\r\n        handlers={keyHandlers}\r\n        component={HotkeysContainer}\r\n      >\r\n        <PanZoomHandler className={styles[\"map-editor-container\"]}>\r\n          <MapCanvas className={styles[\"map-editor-item\"]} />\r\n          <DragPreview className={styles[\"map-editor-item\"]} />\r\n          <MapWidgets className={styles[\"map-editor-item\"]} />\r\n        </PanZoomHandler>\r\n      </HotKeys>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst HotkeysContainer: React.FC<ComponentProps> = ({ children, ...props }) => {\r\n  return (\r\n    // Mask ref type.  It is compatible, but HotKey typings are wonky.\r\n    <div {...(props as any)} className={styles[\"hotkeys-container\"]}>\r\n      {children}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MapEditor;\r\n","import * as React from \"react\";\r\nimport classNames from \"classnames\";\r\n\r\nimport styles from \"./DragPreview.module.css\";\r\n\r\nimport { renderEntity, transformToMap } from \"@/canvas\";\r\n\r\nimport { useSelector } from \"@/hooks/use-selector\";\r\n\r\nimport { entitiesByKeySelector } from \"@/services/map-entities/selectors/entities\";\r\nimport { selectedEntityKeysSelector } from \"@/services/editor-selection/selectors/selection\";\r\nimport {\r\n  editorOffsetXSelector,\r\n  editorOffsetYSelector,\r\n  editorZoomFactorSelector,\r\n} from \"@/services/editor-view/selectors/view\";\r\nimport { dragMoveOffsetSelector } from \"@/services/editor-mouse/selectors/drag-move\";\r\nimport {\r\n  editorViewportHeightSelector,\r\n  editorViewportWidthSelector,\r\n} from \"@/services/editor-view/selectors/viewport\";\r\n\r\nexport interface DragPreviewProps {\r\n  className?: string;\r\n}\r\nconst DragPreview = ({ className }: DragPreviewProps) => {\r\n  const entitiesByKey = useSelector(entitiesByKeySelector);\r\n  const selectedEntityKeys = useSelector(selectedEntityKeysSelector);\r\n  const offsetX = useSelector(editorOffsetXSelector);\r\n  const offsetY = useSelector(editorOffsetYSelector);\r\n  const zoomFactor = useSelector(editorZoomFactorSelector);\r\n  const viewportWidth = useSelector(editorViewportWidthSelector);\r\n  const viewportHeight = useSelector(editorViewportHeightSelector);\r\n  const dragMoveOffset = useSelector(dragMoveOffsetSelector);\r\n\r\n  const canvasRef = React.useRef<HTMLCanvasElement | null>(null);\r\n\r\n  React.useEffect(() => {\r\n    if (!canvasRef.current) {\r\n      return;\r\n    }\r\n\r\n    const ctx = canvasRef.current.getContext(\"2d\")!;\r\n\r\n    console.log(\"Redrawing drag preview\");\r\n\r\n    ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\r\n\r\n    transformToMap(ctx, zoomFactor, offsetX, offsetY, () => {\r\n      if (dragMoveOffset != null) {\r\n        ctx.translate(dragMoveOffset.x, dragMoveOffset.y);\r\n        for (const key of selectedEntityKeys) {\r\n          const entity = entitiesByKey[key];\r\n          renderEntity(ctx, entity, true);\r\n        }\r\n      }\r\n    });\r\n  }, [\r\n    entitiesByKey,\r\n    selectedEntityKeys,\r\n    offsetX,\r\n    offsetY,\r\n    zoomFactor,\r\n    dragMoveOffset,\r\n  ]);\r\n\r\n  return (\r\n    <canvas\r\n      ref={canvasRef}\r\n      className={classNames(className, styles[\"drag-preview\"])}\r\n      width={viewportWidth}\r\n      height={viewportHeight}\r\n    />\r\n  );\r\n};\r\n\r\nexport default DragPreview;\r\n","import DragPreview from \"./DragPreview\";\r\nexport default DragPreview;\r\n","import * as React from \"react\";\r\nimport { useDispatch, useStore } from \"react-redux\";\r\nimport { useDrop } from \"react-dnd\";\r\nimport classNames from \"classnames\";\r\n\r\nimport { getModifiers } from \"@/modifier-keys\";\r\nimport { normalizeRectangle, pointIntersectsRect, Rectangle } from \"@/geometry\";\r\n\r\nimport { renderEntity, renderPotionStart, transformToMap } from \"@/canvas\";\r\n\r\nimport {\r\n  DRAGOBJECT_NEW_ENTITY,\r\n  isNewEntityDragObject,\r\n} from \"@/drag-items/new-entity\";\r\n\r\nimport { LargestEntityRadius } from \"@/entities\";\r\n\r\nimport { useSelector } from \"@/hooks/use-selector\";\r\nimport { useComponentBounds } from \"@/hooks/use-component-bounds\";\r\nimport { editorMouseDown } from \"@/actions/editor-mouse-down\";\r\nimport { editorMouseMove } from \"@/actions/editor-mouse-move\";\r\nimport { editorMouseUp } from \"@/actions/editor-mouse-up\";\r\nimport { entityPrototypeInstantiate } from \"@/actions/entity-prototype-instantiate\";\r\nimport { editorModifierKeysChanged } from \"@/actions/editor-modifierkeys-changed\";\r\nimport { editorRendered } from \"@/actions/editor-rendered\";\r\n\r\nimport {\r\n  editorViewportHeightSelector,\r\n  editorViewportWidthSelector,\r\n} from \"@/services/editor-view/selectors/viewport\";\r\nimport { useClientToWorld } from \"@/services/editor-view/hooks/use-client-to-world\";\r\nimport { entitiesByKeySelector } from \"@/services/map-entities/selectors/entities\";\r\nimport {\r\n  editorOffsetXSelector,\r\n  editorOffsetYSelector,\r\n  editorZoomFactorSelector,\r\n} from \"@/services/editor-view/selectors/view\";\r\nimport { selectedEntityKeysSelector } from \"@/services/editor-selection/selectors/selection\";\r\nimport { dragMoveOffsetSelector } from \"@/services/editor-mouse/selectors/drag-move\";\r\nimport { editorDamageRectSelector } from \"@/services/editor-damage/selector/damage\";\r\nimport { worldToClientSelector } from \"@/services/editor-view/selectors/coordinate-mapping\";\r\n\r\nimport styles from \"./MapCanvas.module.css\";\r\n\r\nexport interface MapCanvasProps {\r\n  className?: string;\r\n}\r\n\r\nconst MapCanvas = ({ className }: MapCanvasProps) => {\r\n  const dispatch = useDispatch();\r\n  const store = useStore();\r\n\r\n  const pointerRef = React.useRef<number | null>(null);\r\n  const canvasRef = React.useRef<HTMLCanvasElement | null>(null);\r\n  const canvasBounds = useComponentBounds(canvasRef);\r\n  const viewportWidth = useSelector(editorViewportWidthSelector);\r\n  const viewportHeight = useSelector(editorViewportHeightSelector);\r\n\r\n  const clientToWorld = useClientToWorld();\r\n\r\n  const eventCanvasPoint = React.useCallback(\r\n    (e: React.MouseEvent | MouseEvent) => {\r\n      return {\r\n        x: e.clientX - canvasBounds.left,\r\n        y: e.clientY - canvasBounds.top,\r\n      };\r\n    },\r\n    [canvasBounds]\r\n  );\r\n\r\n  const onMouseEnter = React.useCallback(() => {\r\n    canvasRef.current?.focus();\r\n  }, []);\r\n\r\n  const onPointerDown = React.useCallback(\r\n    (e: React.PointerEvent) => {\r\n      if (pointerRef.current !== null && pointerRef.current !== e.pointerId) {\r\n        return;\r\n      }\r\n      pointerRef.current = e.pointerId;\r\n      e.currentTarget.setPointerCapture(e.pointerId);\r\n\r\n      const modifiers = getModifiers(e);\r\n      const p = eventCanvasPoint(e);\r\n      dispatch(editorMouseDown(p, modifiers));\r\n    },\r\n    [eventCanvasPoint]\r\n  );\r\n\r\n  const onPointerMove = React.useCallback(\r\n    (e: React.PointerEvent) => {\r\n      if (pointerRef.current !== null && pointerRef.current !== e.pointerId) {\r\n        return;\r\n      }\r\n\r\n      const modifiers = getModifiers(e);\r\n      const p = eventCanvasPoint(e);\r\n      dispatch(editorMouseMove(p, modifiers));\r\n    },\r\n    [eventCanvasPoint]\r\n  );\r\n\r\n  const onPointerUp = React.useCallback(\r\n    (e: React.PointerEvent) => {\r\n      if (pointerRef.current !== null && pointerRef.current !== e.pointerId) {\r\n        return;\r\n      }\r\n\r\n      e.currentTarget.releasePointerCapture(e.pointerId);\r\n      pointerRef.current = null;\r\n\r\n      const modifiers = getModifiers(e);\r\n      const p = eventCanvasPoint(e);\r\n      dispatch(editorMouseUp(p, modifiers));\r\n    },\r\n    [eventCanvasPoint]\r\n  );\r\n\r\n  const onKeyDown = React.useCallback((e: React.KeyboardEvent) => {\r\n    const modifiers = getModifiers(e);\r\n    dispatch(editorModifierKeysChanged(modifiers));\r\n    if (e.key === \"Alt\") {\r\n      e.preventDefault();\r\n    }\r\n  }, []);\r\n\r\n  const onKeyUp = React.useCallback((e: React.KeyboardEvent) => {\r\n    const modifiers = getModifiers(e);\r\n    dispatch(editorModifierKeysChanged(modifiers));\r\n    if (e.key === \"Alt\") {\r\n      e.preventDefault();\r\n    }\r\n  }, []);\r\n\r\n  const [_, dropRef] = useDrop(\r\n    {\r\n      accept: DRAGOBJECT_NEW_ENTITY,\r\n      drop: (item, monitor) => {\r\n        if (!isNewEntityDragObject(item)) {\r\n          return;\r\n        }\r\n\r\n        const { prototype } = item.payload;\r\n\r\n        const p = monitor.getClientOffset();\r\n        if (!p) {\r\n          return;\r\n        }\r\n        p.x -= canvasBounds.left;\r\n        p.y -= canvasBounds.top;\r\n        const worldP = clientToWorld(p);\r\n        dispatch(entityPrototypeInstantiate(prototype, worldP));\r\n      },\r\n    },\r\n    [clientToWorld, canvasBounds]\r\n  );\r\n\r\n  React.useEffect(() => {\r\n    let animationFrame: number | null = null;\r\n\r\n    function render() {\r\n      animationFrame = null;\r\n\r\n      if (!canvasRef.current) {\r\n        return;\r\n      }\r\n\r\n      const state = store.getState();\r\n      const entitiesByKey = entitiesByKeySelector(state);\r\n      const selectedEntityKeys = selectedEntityKeysSelector(state);\r\n      const offsetX = editorOffsetXSelector(state);\r\n      const offsetY = editorOffsetYSelector(state);\r\n      const zoomFactor = editorZoomFactorSelector(state);\r\n      const dragMoveOffset = dragMoveOffsetSelector(state);\r\n      let damageRect = editorDamageRectSelector(state);\r\n\r\n      if (!damageRect) {\r\n        // Nothing to redraw\r\n        return;\r\n      }\r\n\r\n      // Increment the damage rect to account for entity radius that needs to be cleared.\r\n      damageRect = {\r\n        p1: {\r\n          x: damageRect.p1.x - LargestEntityRadius,\r\n          y: damageRect.p1.y - LargestEntityRadius,\r\n        },\r\n        p2: {\r\n          x: damageRect.p2.x + LargestEntityRadius,\r\n          y: damageRect.p2.y + LargestEntityRadius,\r\n        },\r\n      };\r\n\r\n      // Increment redraw yet again to redraw entities that were partially cut by the clear\r\n      const redrawRect: Rectangle = {\r\n        p1: {\r\n          x: damageRect.p1.x - LargestEntityRadius,\r\n          y: damageRect.p1.y - LargestEntityRadius,\r\n        },\r\n        p2: {\r\n          x: damageRect.p2.x + LargestEntityRadius,\r\n          y: damageRect.p2.y + LargestEntityRadius,\r\n        },\r\n      };\r\n\r\n      const ctx = canvasRef.current.getContext(\"2d\")!;\r\n\r\n      const clearClientP1 = worldToClientSelector(state, damageRect.p1);\r\n      const clearClientP2 = worldToClientSelector(state, damageRect.p2);\r\n      const clearRect = normalizeRectangle(clearClientP1, clearClientP2);\r\n      ctx.clearRect(\r\n        Math.max(0, clearRect.p1.x),\r\n        Math.max(0, clearRect.p1.y),\r\n        Math.min(ctx.canvas.width, clearRect.p2.x - clearRect.p1.x),\r\n        Math.min(ctx.canvas.height, clearRect.p2.y - clearRect.p1.y)\r\n      );\r\n\r\n      transformToMap(ctx, zoomFactor, offsetX, offsetY, () => {\r\n        ctx.beginPath();\r\n        ctx.lineWidth = 0.2;\r\n        ctx.setLineDash([2, 2]);\r\n        ctx.moveTo(-60, -60);\r\n        ctx.lineTo(-60, 60);\r\n        ctx.lineTo(60, 60);\r\n        ctx.lineTo(60, -60);\r\n        ctx.lineTo(-60, -60);\r\n        ctx.stroke();\r\n\r\n        renderPotionStart(ctx);\r\n\r\n        let renderCount = 0;\r\n        for (const key of Object.keys(entitiesByKey)) {\r\n          const entity = entitiesByKey[key];\r\n          if (!pointIntersectsRect(entity, redrawRect)) {\r\n            continue;\r\n          }\r\n          const isSelected = selectedEntityKeys.includes(key);\r\n          if (dragMoveOffset != null && isSelected) {\r\n            continue;\r\n          }\r\n          renderCount++;\r\n          renderEntity(ctx, entity, isSelected);\r\n        }\r\n      });\r\n\r\n      dispatch(editorRendered());\r\n    }\r\n\r\n    function requestRender() {\r\n      if (animationFrame != null) {\r\n        return;\r\n      }\r\n      animationFrame = requestAnimationFrame(render);\r\n    }\r\n\r\n    const unsubscribe = store.subscribe(requestRender);\r\n\r\n    return () => {\r\n      if (animationFrame) {\r\n        cancelAnimationFrame(animationFrame);\r\n        animationFrame = null;\r\n      }\r\n      unsubscribe();\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <canvas\r\n      tabIndex={-1}\r\n      className={classNames(className, styles[\"map-canvas\"])}\r\n      ref={(ref) => {\r\n        canvasRef.current = ref;\r\n        dropRef(ref);\r\n      }}\r\n      width={viewportWidth}\r\n      height={viewportHeight}\r\n      onMouseEnter={onMouseEnter}\r\n      onPointerDown={onPointerDown}\r\n      onPointerMove={onPointerMove}\r\n      onPointerUp={onPointerUp}\r\n      onKeyDown={onKeyDown}\r\n      onKeyUp={onKeyUp}\r\n    />\r\n  );\r\n};\r\n\r\nexport default MapCanvas;\r\n","import * as React from \"react\";\r\nimport classNames from \"classnames\";\r\n\r\nimport { useSelector } from \"@/hooks/use-selector\";\r\n\r\nimport { viewportMousePosSelector } from \"@/services/editor-mouse/selectors/viewport\";\r\nimport {\r\n  currentToolSelector,\r\n  toolViewportRadiusSelector,\r\n} from \"@/services/editor-mouse/selectors/tools\";\r\nimport { dragSelectionRectSelector } from \"@/services/editor-mouse/selectors/drag-select\";\r\n\r\nimport styles from \"./MapWidgets.module.css\";\r\n\r\nexport interface MapWidgetsProps {\r\n  className?: string;\r\n}\r\n\r\nconst MapWidgets = ({ className }: MapWidgetsProps) => {\r\n  const selectionRect = useSelector(dragSelectionRectSelector);\r\n  const mousePos = useSelector(viewportMousePosSelector);\r\n  const toolRadius = useSelector(toolViewportRadiusSelector);\r\n  const tool = useSelector(currentToolSelector);\r\n\r\n  return (\r\n    <svg\r\n      className={classNames(className, styles[\"map-widgets\"])}\r\n      width=\"100%\"\r\n      height=\"100%\"\r\n    >\r\n      {selectionRect && (\r\n        <rect\r\n          x={selectionRect.p1.x}\r\n          y={selectionRect.p1.y}\r\n          width={selectionRect.p2.x - selectionRect.p1.x}\r\n          height={selectionRect.p2.y - selectionRect.p1.y}\r\n          stroke=\"lightblue\"\r\n          strokeWidth={3}\r\n          opacity={0.5}\r\n          strokeDasharray=\"6,6\"\r\n        />\r\n      )}\r\n      {mousePos && (tool === \"eraser\" || tool === \"paint-danger-zone\") && (\r\n        <circle\r\n          cx={mousePos.x}\r\n          cy={mousePos.y}\r\n          r={toolRadius}\r\n          stroke=\"lightblue\"\r\n          opacity={0.5}\r\n          strokeWidth={3}\r\n        />\r\n      )}\r\n    </svg>\r\n  );\r\n};\r\n\r\nexport default MapWidgets;\r\n","import MapWidgets from \"./MapWidgets\";\r\nexport default MapWidgets;\r\n","import * as React from \"react\";\r\nimport classNames from \"classnames\";\r\nimport { useDispatch } from \"react-redux\";\r\n\r\nimport { getModifiers } from \"@/modifier-keys\";\r\n\r\nimport { useComponentBounds } from \"@/hooks/use-component-bounds\";\r\nimport { useNativeEvent } from \"@/hooks/use-native-event\";\r\nimport { useSelector } from \"@/hooks/use-selector\";\r\n\r\nimport { editorZoomFactorSelector } from \"@/services/editor-view/selectors/view\";\r\n\r\nimport { editorViewportResize } from \"@/actions/editor-viewport-resize\";\r\nimport { editorZoom } from \"@/actions/editor-zoom\";\r\nimport { editorPan } from \"@/actions/editor-pan\";\r\n\r\nimport style from \"./PanZoomHandler.module.css\";\r\n\r\nexport interface PanZoomHandlerProps {\r\n  className?: string;\r\n  children: React.ReactNode;\r\n}\r\n\r\nexport const ZOOM_FACTOR = 1.07;\r\nexport const PAN_FACTOR = 0.5;\r\n\r\nconst PanZoomHandler = ({ className, children }: PanZoomHandlerProps) => {\r\n  const dispatch = useDispatch();\r\n  const zoomFactor = useSelector(editorZoomFactorSelector);\r\n\r\n  const containerRef = React.useRef<HTMLDivElement | null>(null);\r\n  const containerBounds = useComponentBounds(containerRef);\r\n\r\n  React.useLayoutEffect(() => {\r\n    dispatch(\r\n      editorViewportResize(containerBounds.width, containerBounds.height)\r\n    );\r\n  }, [containerBounds.width, containerBounds.height]);\r\n\r\n  const onWheel = React.useCallback(\r\n    (e: WheelEvent) => {\r\n      const target = containerRef.current;\r\n      if (!target || e.defaultPrevented) {\r\n        return;\r\n      }\r\n\r\n      const modifiers = getModifiers(e);\r\n\r\n      if (modifiers.ctrlMetaKey) {\r\n        const nextZoom =\r\n          e.deltaY < 0 ? zoomFactor * ZOOM_FACTOR : zoomFactor / ZOOM_FACTOR;\r\n        dispatch(editorZoom(nextZoom));\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      } else if (modifiers.shiftKey) {\r\n        dispatch(editorPan((e.deltaY * PAN_FACTOR) / zoomFactor, 0));\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      } else {\r\n        dispatch(editorPan(0, (e.deltaY * PAN_FACTOR) / zoomFactor));\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n    },\r\n    [zoomFactor]\r\n  );\r\n\r\n  // React listens to the root listener for all events,\r\n  //  and chrome assumes the root event listener for mouse events\r\n  //  never wants to preventDefault.\r\n  // We need to take a local event listener and mark it as not passive.\r\n  // https://github.com/facebook/react/issues/14856\r\n  useNativeEvent(containerRef, \"wheel\", onWheel, { passive: false });\r\n\r\n  return (\r\n    <div\r\n      className={classNames(className, style[\"pan-zoom-handler\"])}\r\n      ref={containerRef}\r\n    >\r\n      {children}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PanZoomHandler;\r\n","import PanZoomHandler from \"./PanZoomHandler\";\r\nexport default PanZoomHandler;\r\n","import MapEditor from \"./MapEditor\";\r\nexport * from \"./MapEditor\";\r\nexport default MapEditor;\r\n","export const KEYMAP_DELETE = \"keymap:MapEditor/Delete\" as const;\r\n\r\nconst keymap = {\r\n  [KEYMAP_DELETE]: [\"backspace\", \"del\"],\r\n};\r\nexport default keymap;\r\n\r\nexport type KeymapKeys = keyof typeof keymap;\r\nexport type HotkeyHandler = (keyEvent?: KeyboardEvent) => void;\r\nexport type KeymapHandler = Record<KeymapKeys, HotkeyHandler>;\r\n","import * as React from \"react\";\r\n\r\nimport styles from \"./Menus.module.css\";\r\n\r\nconst DividerMenuItem: React.FC = () => {\r\n  return <div className={styles[\"menu-divider\"]} />;\r\n};\r\n\r\nexport default DividerMenuItem;\r\n","import * as React from \"react\";\r\n\r\nimport styles from \"./Menus.module.css\";\r\n\r\nconst Menu: React.FC = ({ children }) => {\r\n  return <ul className={styles[\"menu\"]}>{children}</ul>;\r\n};\r\n\r\nexport default Menu;\r\n","import * as React from \"react\";\r\n\r\nfunction noop() {\r\n  /* Do nothing */\r\n}\r\n\r\nconst MenuCloseContext = React.createContext<() => void>(noop);\r\n\r\nexport function useMenuCloseContext() {\r\n  return React.useContext(MenuCloseContext);\r\n}\r\n\r\nexport interface MenuCloseListenerProps {\r\n  onClose?(): void;\r\n  children?: React.ReactNode;\r\n}\r\nexport const MenuCloseListener = ({\r\n  onClose: onCloseProp,\r\n  children,\r\n}: MenuCloseListenerProps) => {\r\n  const onCloseChain = useMenuCloseContext();\r\n  const onClose = React.useCallback(() => {\r\n    if (onCloseProp) onCloseProp();\r\n    if (onCloseChain) onCloseChain();\r\n  }, [onCloseProp, onCloseChain]);\r\n\r\n  return (\r\n    <MenuCloseContext.Provider value={onClose}>\r\n      {children}\r\n    </MenuCloseContext.Provider>\r\n  );\r\n};\r\n","import * as React from \"react\";\r\nimport classNames from \"classnames\";\r\n\r\nimport styles from \"./Menus.module.css\";\r\nimport { useMenuCloseContext } from \"./MenuCloseContext\";\r\n\r\nexport interface MenuItemProps {\r\n  autoDismissMenu?: boolean;\r\n  disabled?: boolean;\r\n  secondary?: string;\r\n  onClick?(e: React.MouseEvent<HTMLElement>): void;\r\n}\r\nconst MenuItem: React.FC<MenuItemProps> = ({\r\n  autoDismissMenu = true,\r\n  disabled,\r\n  onClick,\r\n  secondary,\r\n  children,\r\n}) => {\r\n  const requestMenuClose = useMenuCloseContext();\r\n  const onItemClick = React.useCallback(\r\n    (e: React.MouseEvent<HTMLElement>) => {\r\n      if (onClick) {\r\n        onClick(e);\r\n      }\r\n      if (autoDismissMenu) requestMenuClose();\r\n    },\r\n    [autoDismissMenu, requestMenuClose, onClick]\r\n  );\r\n  return (\r\n    <li\r\n      className={classNames(\r\n        styles[\"menu-item\"],\r\n        disabled && styles[\"menu-item--disabled\"]\r\n      )}\r\n      onClick={onItemClick}\r\n    >\r\n      <a className={styles[\"menu-item-content\"]}>\r\n        <span className={styles[\"menu-item-text\"]}>{children}</span>\r\n        {secondary && (\r\n          <span className={styles[\"menu-item-secondary\"]}>{secondary}</span>\r\n        )}\r\n      </a>\r\n    </li>\r\n  );\r\n};\r\n\r\nexport default MenuItem;\r\n","import * as React from \"react\";\r\nimport classNames from \"classnames\";\r\n\r\nimport AutoPopover from \"@/components/AutoPopover\";\r\n\r\nimport styles from \"./Menus.module.css\";\r\n\r\nexport interface SubMenuItemProps {\r\n  disabled?: boolean;\r\n  secondary?: string;\r\n  content: JSX.Element;\r\n}\r\nconst SubMenuItem: React.FC<SubMenuItemProps> = ({\r\n  disabled,\r\n  secondary,\r\n  content,\r\n  children,\r\n}) => {\r\n  return (\r\n    <li\r\n      className={classNames(\r\n        styles[\"menu-item\"],\r\n        disabled && styles[\"menu-item--disabled\"]\r\n      )}\r\n    >\r\n      <AutoPopover placement=\"right-start\" content={content}>\r\n        <a className={styles[\"menu-item-content\"]}>\r\n          <span className={styles[\"menu-item-text\"]}>{children}</span>\r\n          {secondary && (\r\n            <span className={styles[\"menu-item-secondary\"]}>{secondary}</span>\r\n          )}\r\n          <svg className={styles[\"menu-item-icon\"]} width={12} height={12}>\r\n            <path d=\"M0,0 l6,6 l-6,6 z\" fill=\"black\" strokeWidth={0} />\r\n          </svg>\r\n        </a>\r\n      </AutoPopover>\r\n    </li>\r\n  );\r\n};\r\n\r\nexport default SubMenuItem;\r\n","import * as React from \"react\";\r\nimport { createPortal } from \"react-dom\";\r\n\r\nimport { Options, VirtualElement } from \"@popperjs/core\";\r\nimport { usePopper } from \"react-popper\";\r\n\r\nimport { useOutsideMouseEvent } from \"@/hooks/use-outside-mouse-event\";\r\nimport { useArrayState } from \"@/hooks/use-array-state\";\r\n\r\nimport {\r\n  PopoverChildContextProvider,\r\n  usePopoverChild,\r\n} from \"./PopoverChildContext\";\r\n\r\nexport interface PopoverProps {\r\n  anchorEl: Element | VirtualElement | null;\r\n  placement?: Options[\"placement\"];\r\n  isOpen: boolean;\r\n  onRequestClose?(): void;\r\n}\r\n\r\nconst noop = () => {\r\n  /*no op*/\r\n};\r\n\r\nconst Popover: React.FC<PopoverProps> = ({\r\n  isOpen,\r\n  anchorEl,\r\n  placement = \"auto\",\r\n  onRequestClose = noop,\r\n  children,\r\n}) => {\r\n  const [popoverRef, setPopoverRef] = React.useState<HTMLDivElement | null>(\r\n    null\r\n  );\r\n  const { attributes, styles } = usePopper(\r\n    isOpen ? anchorEl : null,\r\n    popoverRef,\r\n    {\r\n      placement,\r\n    }\r\n  );\r\n\r\n  // Register us as a child of a parent popover, if any is present.\r\n  usePopoverChild(popoverRef);\r\n\r\n  const [popoverChildren, registerPopoverChild, unregisterPopoverChild] =\r\n    useArrayState<HTMLElement>();\r\n\r\n  // Close when a click happens on the outside.\r\n  // We still want to handle this even if we are a child, as the user\r\n  // may have clicked on a parent popover which should close us.\r\n  const insideRefs = React.useMemo(\r\n    () => [popoverRef, ...popoverChildren],\r\n    [popoverChildren, popoverRef]\r\n  );\r\n  useOutsideMouseEvent(insideRefs, onRequestClose);\r\n\r\n  if (!isOpen) {\r\n    return null;\r\n  }\r\n\r\n  return createPortal(\r\n    <PopoverChildContextProvider\r\n      registerPopoverChild={registerPopoverChild}\r\n      unregisterPopoverChild={unregisterPopoverChild}\r\n    >\r\n      <div\r\n        ref={setPopoverRef}\r\n        style={{ ...styles.popper, zIndex: 10 }}\r\n        {...attributes.popper}\r\n      >\r\n        {children}\r\n      </div>\r\n    </PopoverChildContextProvider>,\r\n    document.body\r\n  );\r\n};\r\n\r\nexport default Popover;\r\n","import * as React from \"react\";\r\n\r\nexport interface PopoverChildContext {\r\n  registerPopoverChild(element: HTMLElement): void;\r\n  unregisterPopoverChild(element: HTMLElement): void;\r\n}\r\n\r\nfunction noop() {\r\n  // no op.\r\n}\r\nconst noopPopoverChildContext: PopoverChildContext = {\r\n  registerPopoverChild: noop,\r\n  unregisterPopoverChild: noop,\r\n};\r\n\r\nexport const PopoverChildContext =\r\n  React.createContext<PopoverChildContext | null>(null);\r\n\r\nexport const usePopoverChildContext = () =>\r\n  React.useContext(PopoverChildContext);\r\n\r\nexport const PopoverChildContextProvider: React.FC<PopoverChildContext> = ({\r\n  registerPopoverChild: contextRegister,\r\n  unregisterPopoverChild: contextUnregister,\r\n  children,\r\n}) => {\r\n  const parent = usePopoverChildContext();\r\n  const parentRegister = parent?.registerPopoverChild;\r\n  const parentUnregister = parent?.unregisterPopoverChild;\r\n\r\n  const registerPopoverChild = React.useCallback(\r\n    (element: HTMLElement) => {\r\n      if (parentRegister) {\r\n        parentRegister(element);\r\n      }\r\n      contextRegister(element);\r\n    },\r\n    [contextRegister, parentRegister]\r\n  );\r\n\r\n  const unregisterPopoverChild = React.useCallback(\r\n    (element: HTMLElement) => {\r\n      contextUnregister(element);\r\n      if (parentUnregister) {\r\n        parentUnregister;\r\n      }\r\n    },\r\n    [contextUnregister, parentUnregister]\r\n  );\r\n\r\n  const providedContext = React.useMemo(\r\n    () => ({\r\n      registerPopoverChild,\r\n      unregisterPopoverChild,\r\n    }),\r\n    [registerPopoverChild, unregisterPopoverChild]\r\n  );\r\n\r\n  return (\r\n    <PopoverChildContext.Provider value={providedContext}>\r\n      {children}\r\n    </PopoverChildContext.Provider>\r\n  );\r\n};\r\n\r\nexport function usePopoverChild(element: HTMLElement | null) {\r\n  const popoverContext =\r\n    React.useContext(PopoverChildContext) ?? noopPopoverChildContext;\r\n\r\n  // We do not want to trigger the effect when\r\n  //  the context changes, as the context will change\r\n  //  as a result of calling register and unregister.\r\n  // As a result, we will not function right if somehow our\r\n  //  element transfers to a different popup chain without re-rendering.\r\n  const ctxRef = React.useRef(popoverContext);\r\n  React.useEffect(() => {\r\n    ctxRef.current = popoverContext;\r\n  });\r\n\r\n  React.useEffect(() => {\r\n    if (element) {\r\n      ctxRef.current.registerPopoverChild(element);\r\n      return () => ctxRef.current.unregisterPopoverChild(element);\r\n    }\r\n  }, [element]);\r\n}\r\n","export * from \"./Popover\";\r\nimport Popover from \"./Popover\";\r\nexport default Popover;\r\n","import * as React from \"react\";\r\nimport classNames from \"classnames\";\r\n\r\nimport styles from \"./TitleBar.module.css\";\r\n\r\nexport interface TitleBarProps {\r\n  className?: string;\r\n  title?: string;\r\n}\r\nconst TitleBar: React.FC<TitleBarProps> = ({ className, title, children }) => {\r\n  return (\r\n    <div className={classNames(styles.titlebar, className)}>\r\n      <span className={styles[\"titlebar-heading\"]}>MapMixer</span>\r\n      <div className={styles[\"titlebar-divider\"]} />\r\n      {title && <div className={styles[\"titlebar-title\"]}>{title}</div>}\r\n      {children}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TitleBar;\r\n","import TitleBar from \"./TitleBar\";\r\nexport default TitleBar;\r\n","import React from \"react\";\r\nimport classNames from \"classnames\";\r\n\r\nimport styles from \"./ToolBar.module.css\";\r\n\r\nexport interface ToggleButtonProps {\r\n  isPressed: boolean;\r\n  onClick?(e: React.MouseEvent<HTMLButtonElement>): void;\r\n  children?: React.ReactNode;\r\n}\r\n\r\nconst ToggleButton = ({ isPressed, onClick, children }: ToggleButtonProps) => {\r\n  return (\r\n    <button\r\n      className={classNames(\r\n        styles[\"toolbar-togglebutton\"],\r\n        isPressed && styles[\"toolbar-togglebutton-pressed\"]\r\n      )}\r\n      onClick={onClick}\r\n    >\r\n      {children}\r\n    </button>\r\n  );\r\n};\r\n\r\nexport default ToggleButton;\r\n","import * as React from \"react\";\r\n\r\nimport styles from \"./ToolBar.module.css\";\r\n\r\nexport interface ToolbarProps {\r\n  children?: React.ReactNode;\r\n}\r\nconst ToolBar = ({ children }: ToolbarProps) => {\r\n  return <div className={styles[\"toolbar\"]}>{children}</div>;\r\n};\r\nexport default ToolBar;\r\n","import { MapEntityPrototype } from \"@/map-config\";\r\n\r\nexport const DRAGOBJECT_NEW_ENTITY = \"entity-new\" as const;\r\nexport const newEntityDragObject = (prototype: MapEntityPrototype) => ({\r\n  type: DRAGOBJECT_NEW_ENTITY,\r\n  payload: { prototype },\r\n});\r\nexport type NewEntityDragObject = ReturnType<typeof newEntityDragObject>;\r\nexport function isNewEntityDragObject(item: any): item is NewEntityDragObject {\r\n  return item.type === DRAGOBJECT_NEW_ENTITY;\r\n}\r\n","export const POTION_RADIUS = 0.79;\r\n","import { DangerZonePartMapEntity } from \"@/map-config\";\r\n\r\nimport { EntityDef } from \"../../types\";\r\n\r\nfunction makeImg(src: string): HTMLImageElement {\r\n  const img = new Image();\r\n  img.onerror = console.error.bind(console);\r\n  img.src = src;\r\n  return img;\r\n}\r\n\r\nconst DangerZoneImages: Record<string, HTMLImageElement> = {\r\n  Bone1: makeImg(require(\"./Bone1.png\").default),\r\n  Bone2: makeImg(require(\"./Bone2.png\").default),\r\n  Fang1: makeImg(require(\"./Fang1.png\").default),\r\n  Fang2: makeImg(require(\"./Fang2.png\").default),\r\n  Skull1: makeImg(require(\"./Skull1.png\").default),\r\n};\r\n\r\n// TODO: Use bones as mask\r\n/*\r\n    // ctx.save();\r\n    // ctx.scale(1, -1);\r\n    // const maskW = mask.width / 95;\r\n    // const maskH = mask.height / 95;\r\n    // ctx.translate(-maskW / 2, -maskH / 2);\r\n    // ctx.drawImage(mask, 0, 0, maskW, maskH);\r\n    // ctx.restore();\r\n\r\n    ctx.fillStyle = \"red\";\r\n    tweakStyles(ctx);\r\n\r\n    // ctx.save();\r\n    // ctx.beginPath();\r\n    // // Clip a bit outside the potion radius to get the bottle opening\r\n    // ctx.arc(0, 0, POTION_RADIUS + 0.01, 0, 2 * Math.PI);\r\n    // ctx.rect(-0.28, POTION_RADIUS - 0.01, 0.56, 0.28);\r\n    // ctx.clip();\r\n\r\n    // const oldComposite = ctx.globalCompositeOperation;\r\n    // ctx.globalCompositeOperation = \"source-in\";\r\n    // // Flood a section bigger than our expected draw to paint the whole mask\r\n    // ctx.fillRect(\r\n    //   -POTION_RADIUS * 3,\r\n    //   -POTION_RADIUS * 3,\r\n    //   POTION_RADIUS * 6,\r\n    //   POTION_RADIUS * 6\r\n    // );\r\n    // ctx.globalCompositeOperation = oldComposite;\r\n    // ctx.restore();\r\n*/\r\n\r\nconst DangerZonePartDef: EntityDef<DangerZonePartMapEntity> = {\r\n  hitRadius: 0.2,\r\n  render(\r\n    ctx: CanvasRenderingContext2D,\r\n    entity: DangerZonePartMapEntity,\r\n    tweakStyles: (ctx: CanvasRenderingContext2D) => void\r\n  ) {\r\n    ctx.save();\r\n    ctx.beginPath();\r\n\r\n    ctx.fillStyle = \"gray\";\r\n\r\n    tweakStyles(ctx);\r\n\r\n    ctx.rotate(degreesToRadians(entity.angle));\r\n\r\n    switch (entity.type) {\r\n      case \"Fang1\":\r\n        // 0.1226418, 0.400135\r\n        ctx.fillRect(-0.06, -0.02, 0.12, 0.4);\r\n        break;\r\n      case \"Fang2\":\r\n        // 0.1371522, 0.2445218\r\n        ctx.fillRect(-0.065, -0.12, 0.13, 0.24);\r\n        break;\r\n      case \"Bone1\":\r\n        // 0.1287996, 0.6983229\r\n        ctx.fillRect(-0.06, -0.345, 0.12, 0.69);\r\n        break;\r\n      case \"Bone2\":\r\n        // 0.1529365, 0.7249526\r\n        ctx.fillRect(-0.07, -0.36, 0.14, 0.72);\r\n        break;\r\n      case \"Skull1\":\r\n      default:\r\n        ctx.arc(0, 0, 0.24, 0, 2 * Math.PI);\r\n        break;\r\n    }\r\n    ctx.fill();\r\n\r\n    const img = DangerZoneImages[entity.type];\r\n    if (img) {\r\n      const w = img.width / 130;\r\n      const h = img.height / 130;\r\n      ctx.scale(1, -1);\r\n      ctx.translate(-w / 2, -h / 2);\r\n      ctx.drawImage(img, 0, 0, w, h);\r\n    }\r\n    ctx.restore();\r\n  },\r\n};\r\nexport default DangerZonePartDef;\r\n\r\nfunction degreesToRadians(degress: number): number {\r\n  return (degress * Math.PI) / 180;\r\n}\r\n","import DangerZonePartDef from \"./DangerZonePart\";\r\nexport default DangerZonePartDef;\r\n","import { ExperienceBonusMapEntity } from \"@/map-config\";\r\n\r\nimport { EntityDef } from \"../types\";\r\n\r\nconst ExperienceBonusDef: EntityDef<ExperienceBonusMapEntity> = {\r\n  hitRadius: 0.3,\r\n  render(\r\n    ctx: CanvasRenderingContext2D,\r\n    entity: ExperienceBonusMapEntity,\r\n    tweakStyles: (ctx: CanvasRenderingContext2D) => void\r\n  ) {\r\n    ctx.beginPath();\r\n    ctx.fillStyle = \"green\";\r\n    tweakStyles(ctx);\r\n    ctx.arc(0, 0, 0.3, 0, 2 * Math.PI);\r\n    ctx.fill();\r\n  },\r\n};\r\nexport default ExperienceBonusDef;\r\n","import { PotionEffectMapEntity } from \"@/map-config\";\r\n\r\nimport { POTION_RADIUS } from \"../../consts\";\r\nimport { EntityDef } from \"../../types\";\r\n\r\nfunction makeImg(src: string): HTMLImageElement {\r\n  const img = new Image();\r\n  img.onerror = console.error.bind(console);\r\n  img.src = src;\r\n  return img;\r\n}\r\n\r\nconst PotionEffectImages: Record<string, HTMLImageElement> = {\r\n  Acid: makeImg(require(\"./Acid.webp\").default),\r\n  Berserker: makeImg(require(\"./Berserker.webp\").default),\r\n  Bounce: makeImg(require(\"./Bounce.webp\").default),\r\n  Charm: makeImg(require(\"./Charm.webp\").default),\r\n  Crop: makeImg(require(\"./Crop.webp\").default),\r\n  Explosion: makeImg(require(\"./Explosion.webp\").default),\r\n  Fire: makeImg(require(\"./Fire.webp\").default),\r\n  Fly: makeImg(require(\"./Fly.webp\").default),\r\n  Frost: makeImg(require(\"./Frost.webp\").default),\r\n  Growth: makeImg(require(\"./Growth.webp\").default),\r\n  Hallucinations: makeImg(require(\"./Hallucinations.webp\").default),\r\n  Healing: makeImg(require(\"./Healing.webp\").default),\r\n  Invisibility: makeImg(require(\"./Invisibility.webp\").default),\r\n  Libido: makeImg(require(\"./Libido.webp\").default),\r\n  Light: makeImg(require(\"./Light.webp\").default),\r\n  Lightning: makeImg(require(\"./Lightning.webp\").default),\r\n  Mana: makeImg(require(\"./Mana.webp\").default),\r\n  Necromancy: makeImg(require(\"./Necromancy.webp\").default),\r\n  Poison: makeImg(require(\"./Poison.webp\").default),\r\n  SharpVision: makeImg(require(\"./SharpVision.webp\").default),\r\n  Sleep: makeImg(require(\"./Sleep.webp\").default),\r\n  SlowDown: makeImg(require(\"./SlowDown.webp\").default),\r\n  StoneSkin: makeImg(require(\"./StoneSkin.webp\").default),\r\n};\r\n\r\nconst PotionEffectDef: EntityDef<PotionEffectMapEntity> = {\r\n  hitRadius: POTION_RADIUS,\r\n  render(\r\n    ctx: CanvasRenderingContext2D,\r\n    entity: PotionEffectMapEntity,\r\n    tweakStyles: (ctx: CanvasRenderingContext2D) => void\r\n  ) {\r\n    ctx.save();\r\n\r\n    ctx.fillStyle = \"red\";\r\n    tweakStyles(ctx);\r\n\r\n    ctx.beginPath();\r\n    ctx.arc(0, 0, POTION_RADIUS, 0, 2 * Math.PI);\r\n    ctx.rect(-0.2, POTION_RADIUS - 0.04, 0.4, 0.24);\r\n    ctx.fill();\r\n\r\n    const img = PotionEffectImages[entity.effect];\r\n    if (img) {\r\n      const w = img.width / 30;\r\n      const h = img.height / 30;\r\n      ctx.scale(1, -1);\r\n      ctx.translate(-w / 2, -h / 2);\r\n      ctx.drawImage(img, 0, 0, w, h);\r\n    }\r\n\r\n    ctx.restore();\r\n  },\r\n};\r\nexport default PotionEffectDef;\r\n","import PotionEffectDef from \"./PotionEffect\";\r\nexport default PotionEffectDef;\r\n","import { VortexMapEntity } from \"@/map-config\";\r\n\r\nimport { EntityDef } from \"../types\";\r\n\r\nconst VortexDef: EntityDef<VortexMapEntity> = {\r\n  hitRadius: 0.6,\r\n  render(\r\n    ctx: CanvasRenderingContext2D,\r\n    entity: VortexMapEntity,\r\n    tweakStyles: (ctx: CanvasRenderingContext2D) => void\r\n  ) {\r\n    ctx.beginPath();\r\n    ctx.fillStyle = \"gray\";\r\n    tweakStyles(ctx);\r\n    const size = entity.size == \"VortexMedium\" ? 0.5 : 0.6;\r\n    ctx.arc(0, 0, size, 0, 2 * Math.PI);\r\n    ctx.fill();\r\n  },\r\n};\r\nexport default VortexDef;\r\n","import { MapEntity } from \"@/map-config\";\r\n\r\nimport { EntityDef } from \"../types\";\r\n\r\nimport DangerZonePartDef from \"./DangerZonePart\";\r\nimport ExperienceBonusDef from \"./ExperienceBonus\";\r\nimport PotionEffectDef from \"./PotionEffect\";\r\nimport VortexDef from \"./Vortex\";\r\n\r\nexport const EntityDefsByType: Record<MapEntity[\"entityType\"], EntityDef> = {\r\n  DangerZonePart: DangerZonePartDef,\r\n  ExperienceBonus: ExperienceBonusDef,\r\n  PotionEffect: PotionEffectDef,\r\n  Vortex: VortexDef,\r\n};\r\n","import values from \"lodash/values\";\r\n\r\nexport * from \"./types\";\r\nexport * from \"./defs\";\r\n\r\nimport { EntityDefsByType } from \"./defs\";\r\nexport const LargestEntityRadius = values(EntityDefsByType).reduce(\r\n  (x, def) => Math.max(x, def.hitRadius),\r\n  0\r\n);\r\n","import {\r\n  calcSize,\r\n  normalizeRectangle,\r\n  Point,\r\n  pointIntersectsRect,\r\n  Rectangle,\r\n} from \"@/geometry\";\r\nimport { MapEntity } from \"@/map-config\";\r\n\r\ninterface TileData {\r\n  padding: { x: number; y: number };\r\n  entities: MapEntity[];\r\n}\r\n\r\nconst TileDataByType: Record<string, TileData> = {\r\n  \"danger-zone\": require(\"./danger-zone.json\"),\r\n};\r\n\r\nexport function generateTileEntities(\r\n  tileType: string,\r\n  rect: Rectangle\r\n): MapEntity[] {\r\n  const data = TileDataByType[tileType];\r\n  if (!data) {\r\n    return [];\r\n  }\r\n  return tileEntities(data, rect);\r\n}\r\n\r\nfunction tileEntities(tileData: TileData, rect: Rectangle): MapEntity[] {\r\n  rect = normalizeRectangle(rect);\r\n  const { entities: tileEntities, padding: tilePadding } = tileData;\r\n  const tileBounds: Rectangle = {\r\n    p1: {\r\n      x: tileEntities.reduce((x, e) => Math.min(x, e.x), 0) - tilePadding.x / 2,\r\n      y: tileEntities.reduce((y, e) => Math.min(y, e.y), 0) - tilePadding.y / 2,\r\n    },\r\n    p2: {\r\n      x: tileEntities.reduce((x, e) => Math.max(x, e.x), 0) + tilePadding.x / 2,\r\n      y: tileEntities.reduce((y, e) => Math.max(y, e.y), 0) + tilePadding.y / 2,\r\n    },\r\n  };\r\n\r\n  const tileSize = calcSize(tileBounds);\r\n\r\n  const entities: MapEntity[] = [];\r\n\r\n  for (\r\n    let tileXOrdinal = Math.floor(rect.p1.x / tileSize.width);\r\n    tileXOrdinal <= Math.ceil(rect.p2.x / tileSize.width);\r\n    tileXOrdinal++\r\n  ) {\r\n    for (\r\n      let tileYOrdinal = Math.floor(rect.p1.y / tileSize.height);\r\n      tileYOrdinal <= Math.ceil(rect.p2.y / tileSize.height);\r\n      tileYOrdinal++\r\n    ) {\r\n      for (let i = 0; i < tileEntities.length; i++) {\r\n        const tileEntity = tileEntities[i];\r\n        const p: Point = {\r\n          x: tileEntity.x + tileSize.width * tileXOrdinal,\r\n          y: tileEntity.y + tileSize.height * tileYOrdinal,\r\n        };\r\n        if (!pointIntersectsRect(p, rect)) {\r\n          continue;\r\n        }\r\n        entities.push({\r\n          ...tileEntity,\r\n          ...p,\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  return entities;\r\n}\r\n","export type ValueSetter<T> = T | ((old: T) => T);\r\n\r\nexport function fpSet<\r\n  Target extends Record<string, any> | any[],\r\n  P1 extends keyof Target,\r\n  T extends Target[P1]\r\n>(target: Target, p1: P1, value: ValueSetter<T>): Target;\r\nexport function fpSet<\r\n  Target extends Record<string, any> | any[],\r\n  P1 extends keyof Target,\r\n  P2 extends keyof Target[P1],\r\n  T extends Target[P1][P2]\r\n>(target: Target, p1: P1, p2: P2, value: ValueSetter<T>): Target;\r\nexport function fpSet<\r\n  Target extends Record<string, any> | any[],\r\n  P1 extends keyof Target,\r\n  P2 extends keyof Target[P1],\r\n  P3 extends keyof Target[P1][P2],\r\n  T extends Target[P1][P2][P3]\r\n>(target: Target, p1: P1, p2: P2, p3: P3, value: ValueSetter<T>): Target;\r\nexport function fpSet(...args: any[]): any {\r\n  const target = args[0];\r\n  const path = args.slice(1, args.length - 1).map(String);\r\n  const value = args[args.length - 1];\r\n  return fpSetByArray(target, path, value);\r\n}\r\n\r\nexport function fpSetByArray<T extends Record<string, any>>(\r\n  target: T,\r\n  path: (string | number)[],\r\n  value: ValueSetter<any>\r\n): T {\r\n  if (path.length === 0) {\r\n    if (typeof value === \"function\") {\r\n      return value(target);\r\n    }\r\n    return value;\r\n  }\r\n\r\n  const firstPaths = path.slice(0, path.length - 1).map(String);\r\n  const lastPath = path[path.length - 1];\r\n\r\n  const newData = clone(target);\r\n\r\n  let rollingTarget: any = newData;\r\n\r\n  for (const seg of firstPaths) {\r\n    rollingTarget[seg] = clone(rollingTarget[seg]);\r\n    rollingTarget = rollingTarget[seg];\r\n  }\r\n\r\n  if (typeof value === \"function\") {\r\n    rollingTarget[lastPath] = value(rollingTarget[lastPath]);\r\n  } else {\r\n    rollingTarget[lastPath] = value;\r\n  }\r\n\r\n  return newData;\r\n}\r\n\r\nfunction clone<T extends Record<string, unknown> | any[]>(obj: T): T {\r\n  if (Array.isArray(obj)) {\r\n    return obj.slice() as T;\r\n  }\r\n  return Object.assign({}, obj);\r\n}\r\n","export interface Point {\r\n  x: number;\r\n  y: number;\r\n}\r\nexport const ZeroPoint = Object.freeze({ x: 0, y: 0 });\r\n\r\nexport interface Size {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nexport interface Rectangle {\r\n  p1: Point;\r\n  p2: Point;\r\n}\r\n\r\nexport const ZeroRect = Object.freeze({ p1: ZeroPoint, p2: ZeroPoint });\r\n\r\nexport function pointAdd(p1: Point, p2: Point): Point {\r\n  return {\r\n    x: p1.x + p2.x,\r\n    y: p1.y + p2.y,\r\n  };\r\n}\r\n\r\nexport function pointSubtract(p1: Point, p2: Point): Point {\r\n  return {\r\n    x: p1.x - p2.x,\r\n    y: p1.y - p2.y,\r\n  };\r\n}\r\n\r\nexport function magnitude(v: Point): number {\r\n  return Math.sqrt(v.x * v.x + v.y * v.y);\r\n}\r\n\r\nexport function normalizeRectangle(p1: Point, p2: Point): Rectangle;\r\nexport function normalizeRectangle(r: Rectangle): Rectangle;\r\nexport function normalizeRectangle(...args: any[]): Rectangle {\r\n  let p1: Point;\r\n  let p2: Point;\r\n  if (args.length === 1) {\r\n    const r = args[0] as Rectangle;\r\n    p1 = r.p1;\r\n    p2 = r.p2;\r\n  } else {\r\n    p1 = args[0] as Point;\r\n    p2 = args[1] as Point;\r\n  }\r\n  return {\r\n    p1: {\r\n      x: Math.min(p1.x, p2.x),\r\n      y: Math.min(p1.y, p2.y),\r\n    },\r\n    p2: {\r\n      x: Math.max(p1.x, p2.x),\r\n      y: Math.max(p1.y, p2.y),\r\n    },\r\n  };\r\n}\r\n\r\nexport function addPointToRect(r: Rectangle, p: Point): Rectangle {\r\n  return {\r\n    p1: {\r\n      x: Math.min(r.p1.x, p.x),\r\n      y: Math.min(r.p1.y, p.y),\r\n    },\r\n    p2: {\r\n      x: Math.max(r.p2.x, p.x),\r\n      y: Math.max(r.p2.y, p.y),\r\n    },\r\n  };\r\n}\r\n\r\nexport function pointIntersectsRect(p: Point, r: Rectangle): boolean {\r\n  r = normalizeRectangle(r);\r\n\r\n  if (r.p1.x > p.x || r.p2.x < p.x) {\r\n    return false;\r\n  }\r\n\r\n  if (r.p1.y > p.y || r.p2.y < p.y) {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nexport function calcSize(r: Rectangle): Size {\r\n  r = normalizeRectangle(r);\r\n  return {\r\n    width: r.p2.x - r.p1.x,\r\n    height: r.p2.y - r.p1.y,\r\n  };\r\n}\r\n","import { createHashHistory } from \"history\";\r\n\r\nconst history = createHashHistory();\r\nexport default history;\r\n","import * as React from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { AnyAction } from \"redux\";\r\n\r\nexport function useAction(actionCreator: () => AnyAction): () => AnyAction;\r\nexport function useAction<Args>(\r\n  actionCreator: (...args: Args[]) => AnyAction\r\n): () => AnyAction;\r\nexport function useAction<A0, Args>(\r\n  actionCreator: (a0: A0, ...args: Args[]) => AnyAction,\r\n  a0: A0\r\n): () => AnyAction;\r\nexport function useAction(\r\n  actionCreator: (...args: any[]) => AnyAction,\r\n  ...preBind: any[]\r\n): () => AnyAction {\r\n  const dispatch = useDispatch();\r\n  return React.useCallback(() => {\r\n    const action = actionCreator(...preBind);\r\n    if (action) {\r\n      dispatch(action);\r\n    }\r\n  }, [dispatch, actionCreator, ...preBind]) as any;\r\n}\r\n\r\nexport function useClickAction(\r\n  actionCreator: (...args: any[]) => AnyAction,\r\n  ...preBind: any[]\r\n): (e: React.MouseEvent) => AnyAction {\r\n  const dispatch = useDispatch();\r\n  return React.useCallback(\r\n    (e: React.MouseEvent) => {\r\n      if (e.defaultPrevented) {\r\n        return;\r\n      }\r\n      e.preventDefault();\r\n      const action = actionCreator(...preBind);\r\n      if (action) {\r\n        dispatch(action);\r\n      }\r\n    },\r\n    [dispatch, actionCreator, ...preBind]\r\n  ) as any;\r\n}\r\n","import * as React from \"react\";\r\nimport difference from \"lodash/difference\";\r\n\r\nexport type UseArrayState<T> = [\r\n  items: T[],\r\n  addItem: (value: T) => void,\r\n  removeItem: (value: T) => void,\r\n  setItems: (items: T[]) => void\r\n];\r\n\r\nexport function useArrayState<T>(defaultValue: T[] = []): UseArrayState<T> {\r\n  const [items, setItems] = React.useState(defaultValue);\r\n  const addItem = React.useCallback(\r\n    (item: T) => {\r\n      setItems([...items, item]);\r\n    },\r\n    [items]\r\n  );\r\n  const removeItem = React.useCallback(\r\n    (item: T) => {\r\n      setItems(difference(items, [item]));\r\n    },\r\n    [items]\r\n  );\r\n\r\n  return [items, addItem, removeItem, setItems];\r\n}\r\n","import * as React from \"react\";\r\nimport ResizeObserver from \"resize-observer-polyfill\";\r\n\r\ninterface UseComponentBounds {\r\n  left: number;\r\n  top: number;\r\n  right: number;\r\n  bottom: number;\r\n  width: number;\r\n  height: number;\r\n}\r\nexport function useComponentBounds(ref: React.RefObject<HTMLElement | null>) {\r\n  const [size, setSize] = React.useState<UseComponentBounds>({\r\n    left: 0,\r\n    top: 0,\r\n    right: 0,\r\n    bottom: 0,\r\n    width: 0,\r\n    height: 0,\r\n  });\r\n\r\n  React.useLayoutEffect(() => {\r\n    if (!ref.current) {\r\n      return;\r\n    }\r\n\r\n    const observer = new ResizeObserver(() => {\r\n      const el = ref.current;\r\n      if (!el) {\r\n        return;\r\n      }\r\n      const b = el.getBoundingClientRect();\r\n      setSize({\r\n        top: b.top,\r\n        left: b.left,\r\n        right: b.right,\r\n        bottom: b.bottom,\r\n        width: b.width,\r\n        height: b.height,\r\n      });\r\n    });\r\n\r\n    observer.observe(ref.current);\r\n\r\n    return () => {\r\n      observer.disconnect();\r\n    };\r\n  }, [ref]);\r\n\r\n  return size;\r\n}\r\n","import * as React from \"react\";\r\n\r\nexport function useNativeEvent<\r\n  T extends GlobalEventHandlers,\r\n  K extends keyof GlobalEventHandlersEventMap\r\n>(\r\n  ref: React.RefObject<T | null>,\r\n  type: K,\r\n  listener: (\r\n    this: GlobalEventHandlers,\r\n    ev: GlobalEventHandlersEventMap[K]\r\n  ) => any,\r\n  options?: boolean | AddEventListenerOptions\r\n) {\r\n  React.useEffect(() => {\r\n    if (!ref.current) {\r\n      return;\r\n    }\r\n\r\n    // De-reference the target so we remove from the right element.\r\n    const listenTarget = ref.current;\r\n\r\n    listenTarget.addEventListener(type, listener, options);\r\n    return () => {\r\n      listenTarget.removeEventListener(type, listener, options);\r\n    };\r\n  }, [type, listener, ref, options]);\r\n}\r\n","import * as React from \"react\";\r\n\r\nimport { asArray, MaybeArray } from \"@/arrays\";\r\n\r\nexport function useOutsideMouseEvent(\r\n  element: MaybeArray<HTMLElement | null>,\r\n  onOutsideEvent: () => void,\r\n  when = true\r\n) {\r\n  const onEvent = React.useCallback(\r\n    (e: MouseEvent | TouchEvent) => {\r\n      const elements = asArray(element).filter(isTruthy);\r\n      if (!elements.length) {\r\n        return;\r\n      }\r\n\r\n      if (elements.every((element) => !element.contains(e.target as any))) {\r\n        onOutsideEvent();\r\n      }\r\n    },\r\n    [element, onOutsideEvent]\r\n  );\r\n\r\n  React.useEffect(() => {\r\n    if (!when) {\r\n      return;\r\n    }\r\n\r\n    document.addEventListener(\"mousedown\", onEvent);\r\n    document.addEventListener(\"touchstart\", onEvent);\r\n\r\n    return () => {\r\n      document.removeEventListener(\"mousedown\", onEvent);\r\n      document.removeEventListener(\"touchstart\", onEvent);\r\n    };\r\n  }, [onEvent, when]);\r\n}\r\n\r\nfunction isTruthy<T>(x: T | null | undefined): x is T {\r\n  return Boolean(x);\r\n}\r\n","import { AppState } from \"@/state\";\r\nimport { useSelector as realUseSelector } from \"react-redux\";\r\n\r\nexport function useSelector<T>(selector: (state: AppState) => T) {\r\n  return realUseSelector((state) => selector(state as AppState));\r\n}\r\n","import \"@/styles\";\r\n\r\nimport * as React from \"react\";\r\nimport * as ReactDOM from \"react-dom\";\r\n\r\nimport Root from \"./root\";\r\n\r\nconst rootEl = document.getElementById(\"root\");\r\nif (rootEl) {\r\n  ReactDOM.render(<Root />, rootEl);\r\n}\r\n","const oil = require(\"./oil.json\");\r\nconst water = require(\"./water.json\");\r\n\r\nexport const TemplatesByName = {\r\n  oil,\r\n  water,\r\n};\r\n\r\nexport type TemplateName = keyof typeof TemplatesByName;\r\n","import { keyboardModifierUseMeta } from \"./runtime-env\";\r\n\r\nexport const MODIFIER_KEYS_NONE = Object.freeze<ModifierKeys>({});\r\n\r\nexport interface ModifierKeys {\r\n  ctrlMetaKey?: boolean;\r\n  shiftKey?: boolean;\r\n  altKey?: boolean;\r\n}\r\n\r\nexport interface MouseEventModifierKeys {\r\n  ctrlKey: boolean;\r\n  altKey: boolean;\r\n  shiftKey: boolean;\r\n  metaKey: boolean;\r\n}\r\nexport function getModifiers(e: MouseEventModifierKeys): ModifierKeys {\r\n  const { ctrlKey, altKey, shiftKey, metaKey } = e;\r\n  return {\r\n    // Mac reserves ctrl for system use, apps use meta.\r\n    ctrlMetaKey: keyboardModifierUseMeta ? metaKey : ctrlKey,\r\n    altKey,\r\n    shiftKey,\r\n  };\r\n}\r\n","import * as React from \"react\";\r\nimport { useSelector } from \"react-redux\";\r\n\r\nimport { loadingStatusSelector } from \"@/services/map-config/selectors/loading-status\";\r\n\r\nimport TitleBar from \"@/components/TitleBar\";\r\nimport FileMenuButton from \"@/components/FileMenuButton\";\r\n\r\nimport EntitiesWindow from \"./components/EntityTrayWindow\";\r\nimport MapWindow from \"./components/MapWindow\";\r\n\r\nimport styles from \"./EditorPage.module.css\";\r\n\r\nconst EditorPage = () => {\r\n  const status = useSelector(loadingStatusSelector);\r\n\r\n  return (\r\n    <div className={styles[\"editor-page\"]}>\r\n      <TitleBar>\r\n        <FileMenuButton />\r\n      </TitleBar>\r\n      <div className={styles[\"editor-page-content\"]}>\r\n        {status === \"loaded\" && (\r\n          <>\r\n            <MapWindow />\r\n            <EntitiesWindow />\r\n          </>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EditorPage;\r\n","import * as React from \"react\";\r\n\r\nimport { DangerZonePartMapEntity, PotionEffectMapEntity } from \"@/map-config\";\r\n\r\nimport Window from \"../Window\";\r\n\r\nimport { EntityTrayItemData } from \"./types\";\r\n\r\nimport styles from \"./EntityTrayWindow.module.css\";\r\nimport EntityCategory from \"./components/EntityCategory\";\r\n\r\nfunction potionEffectPrototype(\r\n  effect: string\r\n): EntityTrayItemData<PotionEffectMapEntity> {\r\n  return {\r\n    i18nKey: `potioncraft:effects.${effect}`,\r\n    entityType: \"PotionEffect\",\r\n    effect,\r\n    angle: 0,\r\n  };\r\n}\r\n\r\nfunction bonePrototype(\r\n  type: string\r\n): EntityTrayItemData<DangerZonePartMapEntity> {\r\n  return {\r\n    i18nKey: `danger_zone_parts.type_names.${type}`,\r\n    entityType: \"DangerZonePart\",\r\n    type,\r\n    angle: 0,\r\n  };\r\n}\r\n\r\nconst EntityCategories: {\r\n  i18nKey: string;\r\n  entities: EntityTrayItemData[];\r\n}[] = [\r\n  {\r\n    i18nKey: \"danger_zone_parts.title\",\r\n    entities: [\r\n      bonePrototype(\"Skull1\"),\r\n      bonePrototype(\"Bone1\"),\r\n      bonePrototype(\"Bone2\"),\r\n      bonePrototype(\"Fang1\"),\r\n      bonePrototype(\"Fang2\"),\r\n    ],\r\n  },\r\n  {\r\n    i18nKey: \"potion_effects\",\r\n    entities: [\r\n      potionEffectPrototype(\"Crop\"),\r\n      potionEffectPrototype(\"Invisibility\"),\r\n      potionEffectPrototype(\"StoneSkin\"),\r\n      potionEffectPrototype(\"Growth\"),\r\n      potionEffectPrototype(\"SlowDown\"),\r\n      potionEffectPrototype(\"Sleep\"),\r\n      potionEffectPrototype(\"SharpVision\"),\r\n      potionEffectPrototype(\"Mana\"),\r\n      potionEffectPrototype(\"Lightning\"),\r\n      potionEffectPrototype(\"Hallucinations\"),\r\n      potionEffectPrototype(\"Fly\"),\r\n      potionEffectPrototype(\"Explosion\"),\r\n      potionEffectPrototype(\"Charm\"),\r\n      potionEffectPrototype(\"Berserker\"),\r\n      potionEffectPrototype(\"Light\"),\r\n      potionEffectPrototype(\"Libido\"),\r\n      potionEffectPrototype(\"Bounce\"),\r\n      potionEffectPrototype(\"Acid\"),\r\n      potionEffectPrototype(\"Fire\"),\r\n      potionEffectPrototype(\"Necromancy\"),\r\n      potionEffectPrototype(\"Frost\"),\r\n      potionEffectPrototype(\"Poison\"),\r\n      potionEffectPrototype(\"Healing\"),\r\n    ],\r\n  },\r\n];\r\n\r\nconst EntitiesWindow = () => {\r\n  return (\r\n    <Window className={styles[\"entity-tray-window\"]} title=\"Entities\">\r\n      <ul className={styles[\"entity-tray-list\"]}>\r\n        {EntityCategories.map((category, i) => (\r\n          <EntityCategory\r\n            key={i}\r\n            i18nKey={category.i18nKey}\r\n            entities={category.entities}\r\n          />\r\n        ))}\r\n      </ul>\r\n    </Window>\r\n  );\r\n};\r\n\r\nexport default EntitiesWindow;\r\n","import * as React from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\n\r\nimport { EntityTrayItemData } from \"../types\";\r\n\r\nimport styles from \"../EntityTrayWindow.module.css\";\r\n\r\nimport EntityTrayItem from \"./EntityTrayItem\";\r\n\r\nexport interface EntityCategoryProps {\r\n  i18nKey: string;\r\n  entities: EntityTrayItemData[];\r\n}\r\n\r\nconst EntityCategory = ({ i18nKey, entities }: EntityCategoryProps) => {\r\n  const { t } = useTranslation();\r\n  return (\r\n    <>\r\n      <li className={styles[\"entity-tray-category\"]}>{t(i18nKey)}</li>\r\n      {entities.map((entity, i) => (\r\n        <EntityTrayItem key={i} entity={entity} />\r\n      ))}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default EntityCategory;\r\n","import * as React from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useDrag } from \"react-dnd\";\r\n\r\nimport { EntityDefsByType } from \"@/entities\";\r\n\r\nimport {\r\n  DRAGOBJECT_NEW_ENTITY,\r\n  newEntityDragObject,\r\n} from \"@/drag-items/new-entity\";\r\n\r\nimport { EntityTrayItemData } from \"../types\";\r\n\r\nimport styles from \"../EntityTrayWindow.module.css\";\r\n\r\nexport interface DraggableEntityProps {\r\n  entity: EntityTrayItemData;\r\n}\r\n\r\nconst EntityTrayItem = ({ entity }: DraggableEntityProps) => {\r\n  const { entityType, i18nKey } = entity;\r\n  const { t } = useTranslation();\r\n  const canvasRef = React.useRef<HTMLCanvasElement | null>(null);\r\n  const [, dragRef] = useDrag({\r\n    type: DRAGOBJECT_NEW_ENTITY,\r\n    item: newEntityDragObject(entity),\r\n  });\r\n\r\n  React.useLayoutEffect(() => {\r\n    const type = EntityDefsByType[entityType];\r\n    const canvas = canvasRef.current;\r\n    if (!canvas || !type) {\r\n      return;\r\n    }\r\n\r\n    const ctx = canvas.getContext(\"2d\")!;\r\n    ctx.scale(30, 30);\r\n    ctx.translate(0.5, 0.55);\r\n    ctx.scale(1, -1);\r\n    type.render(ctx, entity, () => {});\r\n  }, [entityType]);\r\n\r\n  return (\r\n    <li ref={dragRef} className={styles[\"entity-tray-item\"]}>\r\n      <span className={styles[\"entity-tray-item-preview\"]}>\r\n        <canvas ref={canvasRef} width={30} height={30} />\r\n      </span>\r\n      <span className={styles[\"entity-tray-item-text\"]}>{t(i18nKey)}</span>\r\n    </li>\r\n  );\r\n};\r\n\r\nexport default EntityTrayItem;\r\n","import EntitiesWindow from \"./EntityTrayWindow\";\r\nexport default EntitiesWindow;\r\n","import * as React from \"react\";\r\n\r\nimport MapEditor from \"@/components/MapEditor\";\r\nimport MapEditorToolBar from \"@/components/MapEditorToolbar\";\r\n\r\nimport Window from \"../Window\";\r\n\r\nimport styles from \"./MapWindow.module.css\";\r\n\r\nconst MapWindow = () => {\r\n  return (\r\n    <Window className={styles[\"map-window\"]} title=\"Map\">\r\n      <div className={styles[\"map-window-container\"]}>\r\n        <MapEditorToolBar />\r\n        <MapEditor className={styles[\"map-window-editor\"]} />\r\n      </div>\r\n    </Window>\r\n  );\r\n};\r\n\r\nexport default MapWindow;\r\n","import MapWindow from \"./MapWindow\";\r\nexport default MapWindow;\r\n","import classnames from \"classnames\";\r\nimport * as React from \"react\";\r\n\r\nexport interface WindowProps {\r\n  className?: string;\r\n  title: string;\r\n  children: React.ReactNode;\r\n}\r\n\r\nimport styles from \"./Window.module.css\";\r\n\r\nconst Window = ({ className, title, children }: WindowProps) => {\r\n  return (\r\n    <div className={classnames(styles[\"window\"], className)}>\r\n      <div className={styles[\"window-titlebar\"]}>\r\n        <div className={styles[\"window-title\"]}>{title}</div>\r\n      </div>\r\n      <div className={styles[\"window-content\"]}>{children}</div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Window;\r\n","export * from \"./Window\";\r\nimport Window from \"./Window\";\r\nexport default Window;\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { AppState, defaultAppState } from \"@/state\";\r\n\r\nimport servicesReducer from \"@/services/reducer\";\r\nimport { finalizeReducerList } from \"./utils\";\r\n\r\nconst finalizedReducer = finalizeReducerList(servicesReducer);\r\n\r\nexport default function reducer(\r\n  state: AppState = defaultAppState,\r\n  action: AnyAction\r\n): AppState {\r\n  return finalizedReducer(state, action);\r\n}\r\n","import { AppReducer } from \"./types\";\r\n\r\nexport const PRIORITY_PRE = -10;\r\nexport const PRIORITY_POST = 10;\r\n\r\nexport function reducerPriority(\r\n  priority: number,\r\n  reducer: AppReducer\r\n): AppReducer {\r\n  reducer.weight = priority;\r\n  return reducer;\r\n}\r\n\r\nexport function priorityBefore(reducer: AppReducer) {\r\n  return (reducer.weight ?? 0) - 1;\r\n}\r\n","import { AnyAction } from \"redux\";\r\nimport sortBy from \"lodash/sortBy\";\r\n\r\nimport { MaybeArray } from \"@/arrays\";\r\n\r\nimport { AppState, defaultAppState } from \"@/state\";\r\n\r\nimport { AppReducer } from \"./types\";\r\n\r\nexport function concatReducers(\r\n  ...reducers: MaybeArray<AppReducer>[]\r\n): AppReducer[] {\r\n  // Previously, this was reduceReducers and generated a reducer\r\n  //  that invokes each child reducer.\r\n  // However, we need to be able to order reducers across services,\r\n  //  so we must now aggregate a list of reducers and do a final ordering\r\n  //  step after all are collected.\r\n  return ([] as AppReducer[]).concat(...reducers);\r\n}\r\n\r\nexport function finalizeReducerList(reducers: AppReducer[]): AppReducer {\r\n  // Order the list by weight ascending.\r\n  const finalizedList = sortBy(reducers, (x: AppReducer) => x.weight || 0);\r\n\r\n  return (state: AppState = defaultAppState, action: AnyAction) => {\r\n    return finalizedList.reduce(\r\n      (state, reducer) => reducer(state, action),\r\n      state\r\n    );\r\n  };\r\n}\r\n","import * as React from \"react\";\r\n\r\nimport { Router } from \"react-router-dom\";\r\n\r\nimport { DndProvider } from \"react-dnd\";\r\nimport { HTML5Backend } from \"react-dnd-html5-backend\";\r\n\r\nimport I18NProvider from \"@/services/i18n/components/I18NProvider\";\r\n\r\nimport StoreProvider from \"@/store/components/StoreProvider\";\r\n\r\nimport history from \"@/history\";\r\nimport Routes from \"@/routes\";\r\n\r\nconst Root: React.FC = () => (\r\n  <I18NProvider>\r\n    <StoreProvider>\r\n      <Router history={history}>\r\n        <DndProvider backend={HTML5Backend}>\r\n          <Routes />\r\n        </DndProvider>\r\n      </Router>\r\n    </StoreProvider>\r\n  </I18NProvider>\r\n);\r\n\r\nexport default Root;\r\n","import * as React from \"react\";\r\n\r\nimport { Redirect, Route, Switch } from \"react-router-dom\";\r\n\r\nimport EditorPage from \"./pages/editor/EditorPage\";\r\n\r\nconst Routes: React.FC = () => (\r\n  <Switch>\r\n    <Route path=\"/editor\" exact component={EditorPage} />\r\n    <Redirect to=\"/editor\" />\r\n  </Switch>\r\n);\r\n\r\nexport default Routes;\r\n","import platform from \"platform\";\r\n\r\nconst OS_WINDOWS = /windows/i;\r\nconst OS_MAC = /Mac|iOS|(OS\\ X)/;\r\nconst OS_LINUX = /linux/i;\r\n\r\nexport type OSType = \"windows\" | \"mac\" | \"linux\" | \"unknown\";\r\n\r\nconst osPlatform = (platform.os && platform.os.family) || \"unknown\";\r\nexport const OSType: OSType = OS_WINDOWS.test(osPlatform)\r\n  ? \"windows\"\r\n  : OS_MAC.test(osPlatform)\r\n  ? \"mac\"\r\n  : OS_LINUX.test(osPlatform)\r\n  ? \"linux\"\r\n  : \"unknown\";\r\n\r\nexport const isProd: boolean = process.env.NODE_ENV === \"production\";\r\n\r\nexport const keyboardModifierUseMeta = osPlatform === \"mac\";\r\n","import union from \"lodash/union\";\r\nimport difference from \"lodash/difference\";\r\n\r\nimport { ModifierKeys } from \"./modifier-keys\";\r\n\r\nexport type SelectionMode =\r\n  | \"set\"\r\n  | \"append\"\r\n  | \"remove\"\r\n  | \"toggle\"\r\n  | \"set-if-unselected\";\r\n\r\nexport function getSelectMode(\r\n  modifiers: ModifierKeys,\r\n  defaultMode: SelectionMode = \"set\"\r\n): SelectionMode {\r\n  if (modifiers.shiftKey && modifiers.ctrlMetaKey) {\r\n    return \"remove\";\r\n  }\r\n  if (modifiers.shiftKey) {\r\n    return \"append\";\r\n  }\r\n  if (modifiers.ctrlMetaKey) {\r\n    return \"toggle\";\r\n  }\r\n  return defaultMode;\r\n}\r\n\r\nexport function combineSelection(\r\n  selectedIds: string[],\r\n  chosenIds: string[],\r\n  mode: SelectionMode\r\n) {\r\n  switch (mode) {\r\n    case \"set\":\r\n      return chosenIds;\r\n    case \"set-if-unselected\": {\r\n      if (chosenIds.every((chosen) => selectedIds.indexOf(chosen) !== -1)) {\r\n        // All were selected.\r\n        return selectedIds;\r\n      }\r\n\r\n      // One wasn't selected, set it\r\n      return chosenIds;\r\n    }\r\n    case \"append\":\r\n      return union(selectedIds, chosenIds);\r\n    case \"remove\":\r\n      return difference(selectedIds, chosenIds);\r\n    case \"toggle\": {\r\n      return difference(selectedIds, chosenIds).concat(\r\n        difference(chosenIds, selectedIds)\r\n      );\r\n    }\r\n  }\r\n\r\n  return chosenIds;\r\n}\r\n\r\nexport function combineExtraniousSelection(\r\n  selectedIds: string[],\r\n  mode: SelectionMode\r\n) {\r\n  switch (mode) {\r\n    case \"append\":\r\n    case \"remove\":\r\n      return selectedIds;\r\n  }\r\n\r\n  return [];\r\n}\r\n","import { isEditorRenderedAction } from \"@/actions/editor-rendered\";\r\nimport { createEditorDamageReducer } from \"../state-utils\";\r\n\r\nexport default createEditorDamageReducer((state, action) => {\r\n  if (!isEditorRenderedAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    damageWorldRect: null,\r\n  };\r\n});\r\n","import { isEditorPanAction } from \"@/actions/editor-pan\";\r\nimport { isEditorViewportResizeAction } from \"@/actions/editor-viewport-resize\";\r\nimport { isEditorZoomAction } from \"@/actions/editor-zoom\";\r\nimport { createEditorDamageReducer } from \"../state-utils\";\r\n\r\nexport default createEditorDamageReducer((state, action, appState) => {\r\n  if (\r\n    !isEditorPanAction(action) &&\r\n    !isEditorZoomAction(action) &&\r\n    !isEditorViewportResizeAction(action)\r\n  ) {\r\n    return state;\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    damageWorldRect: {\r\n      p1: {\r\n        x: Number.NEGATIVE_INFINITY,\r\n        y: Number.NEGATIVE_INFINITY,\r\n      },\r\n      p2: {\r\n        x: Number.POSITIVE_INFINITY,\r\n        y: Number.POSITIVE_INFINITY,\r\n      },\r\n    },\r\n  };\r\n});\r\n","import { isEntityDeleteAction } from \"@/actions/entity-delete\";\r\nimport { addPointToRect } from \"@/geometry\";\r\nimport { PRIORITY_PRE, reducerPriority } from \"@/reducer/priorities\";\r\nimport { entityFromKeySelector } from \"@/services/map-entities/selectors/entities\";\r\n\r\nimport { createEditorDamageReducer } from \"../state-utils\";\r\n\r\nexport default reducerPriority(\r\n  PRIORITY_PRE,\r\n  createEditorDamageReducer((state, action, appState) => {\r\n    if (!isEntityDeleteAction(action)) {\r\n      return state;\r\n    }\r\n\r\n    const { entityKeys } = action.payload;\r\n\r\n    const damageRect = entityKeys.reduce((damageRect, entityKey) => {\r\n      const entity = entityFromKeySelector(appState, entityKey);\r\n      if (damageRect == null) {\r\n        return {\r\n          p1: { x: entity.x, y: entity.y },\r\n          p2: { x: entity.x, y: entity.y },\r\n        };\r\n      }\r\n      return addPointToRect(damageRect, entity);\r\n    }, state.damageWorldRect);\r\n\r\n    return {\r\n      ...state,\r\n      damageWorldRect: damageRect,\r\n    };\r\n  })\r\n);\r\n","import values from \"lodash/values\";\r\n\r\nimport { isEntityInsertAction } from \"@/actions/entity-insert\";\r\nimport { addPointToRect } from \"@/geometry\";\r\n\r\nimport { createEditorDamageReducer } from \"../state-utils\";\r\n\r\nexport default createEditorDamageReducer((state, action) => {\r\n  if (!isEntityInsertAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { entities } = action.payload;\r\n\r\n  const damageRect = values(entities).reduce((damageRect, entity) => {\r\n    if (damageRect == null) {\r\n      return {\r\n        p1: { x: entity.x, y: entity.y },\r\n        p2: { x: entity.x, y: entity.y },\r\n      };\r\n    }\r\n    return addPointToRect(damageRect, entity);\r\n  }, state.damageWorldRect);\r\n\r\n  return {\r\n    ...state,\r\n    damageWorldRect: damageRect,\r\n  };\r\n});\r\n","import { addPointToRect } from \"@/geometry\";\r\n\r\nimport { PRIORITY_PRE, reducerPriority } from \"@/reducer/priorities\";\r\n\r\nimport { isEntityOffsetAction } from \"@/actions/entity-offset\";\r\n\r\nimport { entityFromKeySelector } from \"@/services/map-entities/selectors/entities\";\r\n\r\nimport { createEditorDamageReducer } from \"../state-utils\";\r\n\r\nexport default reducerPriority(\r\n  PRIORITY_PRE,\r\n  createEditorDamageReducer((state, action, appState) => {\r\n    if (!isEntityOffsetAction(action)) {\r\n      return state;\r\n    }\r\n\r\n    const { entityKeys, offsetX, offsetY } = action.payload;\r\n\r\n    const damageRect = entityKeys.reduce((damageRect, entityKey) => {\r\n      const entity = entityFromKeySelector(appState, entityKey);\r\n      if (damageRect == null) {\r\n        damageRect = {\r\n          p1: { x: entity.x, y: entity.y },\r\n          p2: { x: entity.x, y: entity.y },\r\n        };\r\n      } else {\r\n        damageRect = addPointToRect(damageRect, entity);\r\n      }\r\n\r\n      return addPointToRect(damageRect, {\r\n        x: entity.x + offsetX,\r\n        y: entity.y + offsetY,\r\n      });\r\n    }, state.damageWorldRect);\r\n\r\n    return {\r\n      ...state,\r\n      damageWorldRect: damageRect,\r\n    };\r\n  })\r\n);\r\n","import { isEntityPrototypeInstantiateAction } from \"@/actions/entity-prototype-instantiate\";\r\nimport { addPointToRect } from \"@/geometry\";\r\nimport { worldToClientSelector } from \"@/services/editor-view/selectors/coordinate-mapping\";\r\n\r\nimport { createEditorDamageReducer } from \"../state-utils\";\r\n\r\nexport default createEditorDamageReducer((state, action, appState) => {\r\n  if (!isEntityPrototypeInstantiateAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { worldPos } = action.payload;\r\n\r\n  return {\r\n    ...state,\r\n    damageWorldRect: state.damageWorldRect\r\n      ? addPointToRect(state.damageWorldRect, worldPos)\r\n      : { p1: worldPos, p2: worldPos },\r\n  };\r\n});\r\n","import { concatReducers } from \"@/reducer/utils\";\r\n\r\nimport editorRenderedReducer from \"./editor-rendered\";\r\nimport editorViewportReducer from \"./editor-viewport\";\r\nimport entityDeleteReducer from \"./entity-delete\";\r\nimport entityInsertReducer from \"./entity-insert\";\r\nimport entityOffsetReducer from \"./entity-offset\";\r\nimport entityPrototypeInstantiateReducer from \"./entity-prototype-instantiate\";\r\nimport mapConfigReceiveReducer from \"./map-config-receive\";\r\nimport selectClearReducer from \"./select-clear\";\r\nimport selectEntityReducer from \"./select-entity\";\r\n\r\nexport default concatReducers(\r\n  editorRenderedReducer,\r\n  editorViewportReducer,\r\n  entityDeleteReducer,\r\n  entityInsertReducer,\r\n  entityOffsetReducer,\r\n  entityPrototypeInstantiateReducer,\r\n  mapConfigReceiveReducer,\r\n  selectClearReducer,\r\n  selectEntityReducer\r\n);\r\n","import { isMapConfigReceiveAction } from \"@/actions/map-config-receive\";\r\nimport { createEditorDamageReducer } from \"../state-utils\";\r\n\r\nexport default createEditorDamageReducer((state, action, appState) => {\r\n  if (!isMapConfigReceiveAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    damageWorldRect: {\r\n      p1: {\r\n        x: Number.NEGATIVE_INFINITY,\r\n        y: Number.NEGATIVE_INFINITY,\r\n      },\r\n      p2: {\r\n        x: Number.POSITIVE_INFINITY,\r\n        y: Number.POSITIVE_INFINITY,\r\n      },\r\n    },\r\n  };\r\n});\r\n","import { addPointToRect } from \"@/geometry\";\r\n\r\nimport { PRIORITY_PRE, reducerPriority } from \"@/reducer/priorities\";\r\n\r\nimport { isSelectClearAction } from \"@/actions/select-clear\";\r\n\r\nimport { selectedEntityKeysSelector } from \"@/services/editor-selection/selectors/selection\";\r\nimport { entityFromKeySelector } from \"@/services/map-entities/selectors/entities\";\r\n\r\nimport { createEditorDamageReducer } from \"../state-utils\";\r\n\r\nexport default reducerPriority(\r\n  PRIORITY_PRE,\r\n  createEditorDamageReducer((state, action, appState) => {\r\n    if (!isSelectClearAction(action)) {\r\n      return state;\r\n    }\r\n\r\n    const selectedEntityKeys = selectedEntityKeysSelector(appState);\r\n\r\n    const damageRect = selectedEntityKeys.reduce((damageRect, entityKey) => {\r\n      const entity = entityFromKeySelector(appState, entityKey);\r\n      if (!entity) {\r\n        return damageRect;\r\n      }\r\n\r\n      if (damageRect == null) {\r\n        return {\r\n          p1: { x: entity.x, y: entity.y },\r\n          p2: { x: entity.x, y: entity.y },\r\n        };\r\n      } else {\r\n        return addPointToRect(damageRect, entity);\r\n      }\r\n    }, state.damageWorldRect);\r\n\r\n    return {\r\n      ...state,\r\n      damageWorldRect: damageRect,\r\n    };\r\n  })\r\n);\r\n","import { addPointToRect } from \"@/geometry\";\r\n\r\nimport { PRIORITY_PRE, reducerPriority } from \"@/reducer/priorities\";\r\n\r\nimport { isSelectEntityAction } from \"@/actions/select-entity\";\r\nimport { entityFromKeySelector } from \"@/services/map-entities/selectors/entities\";\r\nimport { selectedEntityKeysSelector } from \"@/services/editor-selection/selectors/selection\";\r\n\r\nimport { createEditorDamageReducer } from \"../state-utils\";\r\n\r\nexport default reducerPriority(\r\n  PRIORITY_PRE,\r\n  createEditorDamageReducer((state, action, appState) => {\r\n    if (!isSelectEntityAction(action)) {\r\n      return state;\r\n    }\r\n\r\n    const { entityKeys } = action.payload;\r\n\r\n    // Might need to re-render previously selected items to unselect them\r\n    const selectedEntityKeys = selectedEntityKeysSelector(appState);\r\n\r\n    let damageRect = selectedEntityKeys.reduce((damageRect, entityKey) => {\r\n      const entity = entityFromKeySelector(appState, entityKey);\r\n      if (!entity) {\r\n        return damageRect;\r\n      }\r\n\r\n      if (damageRect == null) {\r\n        return {\r\n          p1: { x: entity.x, y: entity.y },\r\n          p2: { x: entity.x, y: entity.y },\r\n        };\r\n      } else {\r\n        return addPointToRect(damageRect, entity);\r\n      }\r\n    }, state.damageWorldRect);\r\n\r\n    damageRect = entityKeys.reduce((damageRect, entityKey) => {\r\n      const entity = entityFromKeySelector(appState, entityKey);\r\n      if (!entity) {\r\n        return damageRect;\r\n      }\r\n\r\n      if (damageRect == null) {\r\n        return {\r\n          p1: { x: entity.x, y: entity.y },\r\n          p2: { x: entity.x, y: entity.y },\r\n        };\r\n      } else {\r\n        return addPointToRect(damageRect, entity);\r\n      }\r\n    }, damageRect);\r\n\r\n    return {\r\n      ...state,\r\n      damageWorldRect: damageRect,\r\n    };\r\n  })\r\n);\r\n","import { createEditorDamageSelector } from \"../state-utils\";\r\n\r\nexport const editorDamageRectSelector = createEditorDamageSelector(\r\n  (state) => state.damageWorldRect\r\n);\r\n","import {\r\n  createServiceReducerCreator,\r\n  createServiceSelectorCreator,\r\n} from \"../state-utils\";\r\n\r\nexport const createEditorDamageReducer =\r\n  createServiceReducerCreator(\"editorDamage\");\r\nexport const createEditorDamageSelector =\r\n  createServiceSelectorCreator(\"editorDamage\");\r\n","import { Rectangle } from \"@/geometry\";\r\n\r\nexport interface EditorDamageState {\r\n  damageWorldRect: Rectangle | null;\r\n}\r\n\r\nconst _defaultState: EditorDamageState = {\r\n  damageWorldRect: null,\r\n};\r\n\r\nexport const defaultEditorDamageState = Object.freeze(_defaultState);\r\n","import { concatReducers } from \"@/reducer/utils\";\r\n\r\nimport modifierkeysChangedReducer from \"./modifierkeys-changed\";\r\nimport mouseDownReducer from \"./mouse-down\";\r\nimport mouseMoveReducer from \"./mouse-move\";\r\nimport mouseOutReducer from \"./mouse-out\";\r\nimport mouseUpReducer from \"./mouse-up\";\r\nimport toolRadiusSetReducer from \"./tool-radius-set\";\r\nimport toolSetReducer from \"./tool-set\";\r\n\r\nexport default concatReducers(\r\n  modifierkeysChangedReducer,\r\n  mouseDownReducer,\r\n  mouseMoveReducer,\r\n  mouseOutReducer,\r\n  mouseUpReducer,\r\n  toolRadiusSetReducer,\r\n  toolSetReducer\r\n);\r\n","import { isEditorModifierKeysChangedAction } from \"@/actions/editor-modifierkeys-changed\";\r\nimport { createEditorMouseReducer } from \"../state-utils\";\r\n\r\nexport default createEditorMouseReducer((state, action) => {\r\n  if (!isEditorModifierKeysChangedAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { modifiers } = action.payload;\r\n\r\n  return {\r\n    ...state,\r\n    modifierKeys: modifiers,\r\n  };\r\n});\r\n","import { isEditorMouseDownAction } from \"@/actions/editor-mouse-down\";\r\n\r\nimport { createEditorMouseReducer } from \"../state-utils\";\r\n\r\nexport default createEditorMouseReducer((state, action) => {\r\n  if (!isEditorMouseDownAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { viewportPos, modifierKeys } = action.payload;\r\n\r\n  return {\r\n    ...state,\r\n    currentPointerGesture: modifierKeys.altKey ? \"pan\" : null,\r\n    mouseDownViewportPos: viewportPos,\r\n    mouseViewportPos: viewportPos,\r\n    modifierKeys,\r\n  };\r\n});\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { magnitude, pointAdd, pointSubtract } from \"@/geometry\";\r\nimport { getSelectMode } from \"@/selection-mode\";\r\nimport { fpSet } from \"@/fp-set\";\r\n\r\nimport { AppState, defaultAppState } from \"@/state\";\r\n\r\nimport rootReducer from \"@/reducer\";\r\n\r\nimport { generateTileEntities } from \"@/entities/tiles\";\r\n\r\nimport {\r\n  EditorMouseMoveAction,\r\n  isEditorMouseMoveAction,\r\n} from \"@/actions/editor-mouse-move\";\r\nimport { selectEntity } from \"@/actions/select-entity\";\r\nimport { editorPan } from \"@/actions/editor-pan\";\r\nimport { entityDelete } from \"@/actions/entity-delete\";\r\nimport { entityInsert } from \"@/actions/entity-insert\";\r\n\r\nimport { clientToWorldSelector } from \"@/services/editor-view/selectors/coordinate-mapping\";\r\nimport {\r\n  entityKeyAtPointSelector,\r\n  entityKeysAtPointSelector,\r\n} from \"@/services/map-entities/selectors/entities\";\r\n\r\nimport { EditorMousePointerGesture, EditorMouseTool } from \"../state\";\r\n\r\nconst GESTURE_START_DISTANCE = 5;\r\n\r\nexport default function mouseMoveReducer(\r\n  state: AppState = defaultAppState,\r\n  action: AnyAction\r\n): AppState {\r\n  if (!isEditorMouseMoveAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { viewportPos, modifierKeys } = action.payload;\r\n\r\n  state = detectGestureReducer(state, action);\r\n\r\n  let { currentTool, currentPointerGesture } = state.services.editorMouse;\r\n\r\n  // Gestures take priority over tools, so holding alt can pan during tool usage.\r\n  if (currentPointerGesture) {\r\n    state = gestureReducer(state, action, currentPointerGesture);\r\n  } else {\r\n    state = toolReducer(state, action, currentTool);\r\n  }\r\n\r\n  state = fpSet(state, \"services\", \"editorMouse\", (mouseState) => ({\r\n    ...mouseState,\r\n    mouseViewportPos: viewportPos,\r\n    modifierKeys,\r\n  }));\r\n\r\n  return state;\r\n}\r\n\r\nfunction detectGestureReducer(\r\n  state: AppState,\r\n  action: EditorMouseMoveAction\r\n): AppState {\r\n  const { viewportPos, modifierKeys } = action.payload;\r\n\r\n  const { mouseDownViewportPos, currentTool } = state.services.editorMouse;\r\n  let { currentPointerGesture } = state.services.editorMouse;\r\n\r\n  // If we are holding the mouse button with the pointer, determine the gesture.\r\n  if (\r\n    mouseDownViewportPos &&\r\n    currentTool == \"pointer\" &&\r\n    currentPointerGesture == null &&\r\n    magnitude(pointSubtract(mouseDownViewportPos, viewportPos)) >\r\n      GESTURE_START_DISTANCE\r\n  ) {\r\n    const mouseDownWorldPos = clientToWorldSelector(\r\n      state,\r\n      mouseDownViewportPos\r\n    );\r\n    const entityKeyAtMouse = entityKeyAtPointSelector(state, mouseDownWorldPos);\r\n\r\n    if (entityKeyAtMouse) {\r\n      const selectionMode = getSelectMode(modifierKeys, \"append\");\r\n      state = rootReducer(state, selectEntity(entityKeyAtMouse, selectionMode));\r\n      currentPointerGesture = \"drag-move\";\r\n    } else {\r\n      currentPointerGesture = \"drag-select\";\r\n    }\r\n  }\r\n\r\n  state = fpSet(\r\n    state,\r\n    \"services\",\r\n    \"editorMouse\",\r\n    \"currentPointerGesture\",\r\n    currentPointerGesture\r\n  );\r\n\r\n  return state;\r\n}\r\n\r\nfunction gestureReducer(\r\n  state: AppState,\r\n  action: EditorMouseMoveAction,\r\n  currentGesture: EditorMousePointerGesture\r\n): AppState {\r\n  switch (currentGesture) {\r\n    case \"pan\":\r\n      return panGestureReducer(state, action);\r\n  }\r\n\r\n  return state;\r\n}\r\n\r\nfunction panGestureReducer(\r\n  state: AppState,\r\n  action: EditorMouseMoveAction\r\n): AppState {\r\n  let previousPos = state.services.editorMouse.mouseViewportPos;\r\n  if (!previousPos) {\r\n    return state;\r\n  }\r\n\r\n  previousPos = clientToWorldSelector(state, previousPos);\r\n  const currentPos = clientToWorldSelector(state, action.payload.viewportPos);\r\n  const offset = pointSubtract(previousPos, currentPos);\r\n  return rootReducer(state, editorPan(offset.x, -offset.y));\r\n}\r\n\r\nfunction toolReducer(\r\n  state: AppState,\r\n  action: EditorMouseMoveAction,\r\n  currentTool: EditorMouseTool\r\n): AppState {\r\n  const { mouseDownViewportPos } = state.services.editorMouse;\r\n  if (mouseDownViewportPos == null) {\r\n    // Mouse is not held\r\n    return state;\r\n  }\r\n\r\n  switch (currentTool) {\r\n    case \"eraser\":\r\n      return eraserReducer(state, action);\r\n    case \"paint-danger-zone\":\r\n      return paintDangerZoneReducer(state, action);\r\n  }\r\n\r\n  return state;\r\n}\r\n\r\nfunction eraserReducer(\r\n  state: AppState,\r\n  action: EditorMouseMoveAction\r\n): AppState {\r\n  const { viewportPos } = action.payload;\r\n  const { toolRadius } = state.services.editorMouse;\r\n  const worldPoint = clientToWorldSelector(state, viewportPos);\r\n  const keys = entityKeysAtPointSelector(state, worldPoint, toolRadius);\r\n  return rootReducer(state, entityDelete(keys));\r\n}\r\n\r\nfunction paintDangerZoneReducer(\r\n  state: AppState,\r\n  action: EditorMouseMoveAction\r\n) {\r\n  const { viewportPos } = action.payload;\r\n  const { toolRadius } = state.services.editorMouse;\r\n  const worldPoint = clientToWorldSelector(state, viewportPos);\r\n  const keys = entityKeysAtPointSelector(state, worldPoint, toolRadius, true);\r\n\r\n  state = rootReducer(state, entityDelete(keys));\r\n\r\n  const p1 = pointSubtract(worldPoint, { x: toolRadius, y: toolRadius });\r\n  const p2 = pointAdd(worldPoint, { x: toolRadius, y: toolRadius });\r\n  const entities = generateTileEntities(\"danger-zone\", { p1, p2 }).filter(\r\n    (entity) => {\r\n      const vec = pointSubtract(entity, worldPoint);\r\n      if (magnitude(vec) >= toolRadius) {\r\n        return false;\r\n      }\r\n      return true;\r\n    }\r\n  );\r\n\r\n  state = rootReducer(state, entityInsert(entities));\r\n  return state;\r\n}\r\n","import { isEditorMouseOutAction } from \"@/actions/editor-mouse-out\";\r\n\r\nimport { defaultEditorMouseServiceState } from \"../state\";\r\nimport { createEditorMouseReducer } from \"../state-utils\";\r\n\r\nexport default createEditorMouseReducer((state, action) => {\r\n  if (!isEditorMouseOutAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  return defaultEditorMouseServiceState;\r\n});\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { fpSet } from \"@/fp-set\";\r\nimport { AppState, defaultAppState } from \"@/state\";\r\nimport { getSelectMode } from \"@/selection-mode\";\r\nimport { normalizeRectangle, pointSubtract } from \"@/geometry\";\r\n\r\nimport rootReducer from \"@/reducer\";\r\n\r\nimport {\r\n  EditorMouseUpAction,\r\n  isEditorMouseUpAction,\r\n} from \"@/actions/editor-mouse-up\";\r\nimport { selectEntity } from \"@/actions/select-entity\";\r\n\r\nimport {\r\n  entitiesByKeySelector,\r\n  entityKeyAtPointSelector,\r\n} from \"@/services/map-entities/selectors/entities\";\r\nimport { clientToWorldSelector } from \"@/services/editor-view/selectors/coordinate-mapping\";\r\nimport { selectClear } from \"@/actions/select-clear\";\r\nimport { entityOffset } from \"@/actions/entity-offset\";\r\n\r\nexport default function mouseUpReducer(\r\n  state: AppState = defaultAppState,\r\n  action: AnyAction\r\n): AppState {\r\n  if (!isEditorMouseUpAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { modifierKeys, viewportPos } = action.payload;\r\n\r\n  const mouseState = state.services.editorMouse;\r\n\r\n  switch (mouseState.currentPointerGesture) {\r\n    case \"drag-select\":\r\n      state = completeDragSelect(state, action);\r\n      break;\r\n    case \"drag-move\":\r\n      state = completeDragMove(state, action);\r\n      break;\r\n    default:\r\n      state = completeClick(state, action);\r\n      break;\r\n  }\r\n\r\n  return fpSet(state, \"services\", \"editorMouse\", (mouseState) => ({\r\n    ...mouseState,\r\n    currentPointerGesture: null,\r\n    mouseDownViewportPos: null,\r\n    mouseViewportPos: viewportPos,\r\n    modifierKeys,\r\n  }));\r\n}\r\n\r\nfunction completeDragSelect(\r\n  state: AppState,\r\n  action: EditorMouseUpAction\r\n): AppState {\r\n  const { viewportPos, modifierKeys } = action.payload;\r\n\r\n  const { mouseDownViewportPos } = state.services.editorMouse;\r\n  if (!mouseDownViewportPos) {\r\n    return state;\r\n  }\r\n\r\n  const worldMouseDownPos = clientToWorldSelector(state, mouseDownViewportPos);\r\n  const worldMouseUpPos = clientToWorldSelector(state, viewportPos);\r\n\r\n  const selectionRect = normalizeRectangle(worldMouseDownPos, worldMouseUpPos);\r\n\r\n  const entitiesById = entitiesByKeySelector(state);\r\n\r\n  const idsToSelect = Object.entries(entitiesById)\r\n    .filter(([_, entity]) => {\r\n      // Not caring about entity sizes for now\r\n      if (entity.x < selectionRect.p1.x || entity.x > selectionRect.p2.x) {\r\n        return false;\r\n      }\r\n      if (entity.y < selectionRect.p1.y || entity.y > selectionRect.p2.y) {\r\n        return false;\r\n      }\r\n      return true;\r\n    })\r\n    .map(([id]) => id);\r\n\r\n  const mode = getSelectMode(modifierKeys);\r\n  return rootReducer(state, selectEntity(idsToSelect, mode));\r\n}\r\n\r\nfunction completeDragMove(\r\n  state: AppState,\r\n  action: EditorMouseUpAction\r\n): AppState {\r\n  const selectedEntityKeys = state.services.editorSelection.selectedEntityKeys;\r\n  if (selectedEntityKeys.length === 0) {\r\n    return state;\r\n  }\r\n\r\n  const { viewportPos } = action.payload;\r\n\r\n  const { mouseDownViewportPos } = state.services.editorMouse;\r\n  if (!mouseDownViewportPos) {\r\n    return state;\r\n  }\r\n\r\n  const worldMouseDownPos = clientToWorldSelector(state, mouseDownViewportPos);\r\n  const worldMouseUpPos = clientToWorldSelector(state, viewportPos);\r\n\r\n  const offset = pointSubtract(worldMouseUpPos, worldMouseDownPos);\r\n\r\n  return rootReducer(\r\n    state,\r\n    entityOffset(selectedEntityKeys, offset.x, offset.y)\r\n  );\r\n}\r\n\r\nfunction completeClick(state: AppState, action: EditorMouseUpAction): AppState {\r\n  const { viewportPos, modifierKeys } = action.payload;\r\n\r\n  const worldPos = clientToWorldSelector(state, viewportPos);\r\n  const selectedKey = entityKeyAtPointSelector(state, worldPos);\r\n\r\n  const mode = getSelectMode(modifierKeys);\r\n\r\n  if (selectedKey != null) {\r\n    return rootReducer(state, selectEntity(selectedKey, mode));\r\n  } else if (mode === \"set\") {\r\n    return rootReducer(state, selectClear());\r\n  }\r\n\r\n  return state;\r\n}\r\n","import { isEditorToolRadiusSetAction } from \"@/actions/editor-tool-radius-set\";\r\n\r\nimport { createEditorMouseReducer } from \"../state-utils\";\r\n\r\nexport default createEditorMouseReducer((state, action) => {\r\n  if (!isEditorToolRadiusSetAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { radius } = action.payload;\r\n\r\n  if (radius <= 0) {\r\n    return state;\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    toolRadius: radius,\r\n  };\r\n});\r\n","import { isEditorToolSetAction } from \"@/actions/editor-tool-set\";\r\nimport { createEditorMouseReducer } from \"../state-utils\";\r\n\r\nexport default createEditorMouseReducer((state, action) => {\r\n  if (!isEditorToolSetAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { tool } = action.payload;\r\n\r\n  return {\r\n    ...state,\r\n    currentTool: tool,\r\n  };\r\n});\r\n","import { pointSubtract } from \"@/geometry\";\r\nimport { AppState } from \"@/state\";\r\nimport { createSelector } from \"reselect\";\r\nimport {\r\n  worldMouseDownPosSelector,\r\n  worldMousePosSelector,\r\n} from \"./world-coords\";\r\n\r\nexport const dragMoveOffsetSelector = createSelector(\r\n  (state: AppState) => state.services.editorMouse.currentPointerGesture,\r\n  worldMousePosSelector,\r\n  worldMouseDownPosSelector,\r\n  (currentGesture, worldMousePos, worldMouseDownPos) => {\r\n    if (\r\n      currentGesture !== \"drag-move\" ||\r\n      !worldMousePos ||\r\n      !worldMouseDownPos\r\n    ) {\r\n      return null;\r\n    }\r\n\r\n    return pointSubtract(worldMousePos, worldMouseDownPos);\r\n  }\r\n);\r\n","import { createSelector } from \"reselect\";\r\n\r\nimport { normalizeRectangle } from \"@/geometry\";\r\n\r\nimport { createEditorMouseSelector } from \"../state-utils\";\r\nimport { EditorMouseServiceState } from \"../state\";\r\n\r\nexport const dragSelectionRectSelector = createEditorMouseSelector(\r\n  createSelector(\r\n    (state: EditorMouseServiceState) =>\r\n      state.currentPointerGesture == \"drag-select\" &&\r\n      state.mouseDownViewportPos,\r\n    (state: EditorMouseServiceState) =>\r\n      state.currentPointerGesture == \"drag-select\" && state.mouseViewportPos,\r\n    (dragStart, dragEnd) => {\r\n      if (dragStart && dragEnd) {\r\n        return normalizeRectangle(dragStart, dragEnd);\r\n      } else {\r\n        return null;\r\n      }\r\n    }\r\n  )\r\n);\r\n","import { AppState } from \"@/state\";\r\nimport { createEditorMouseSelector } from \"../state-utils\";\r\n\r\nexport const currentToolSelector = createEditorMouseSelector((state) => {\r\n  if (state.currentPointerGesture !== null) {\r\n    return \"pointer\" as const;\r\n  }\r\n\r\n  if (state.mouseDownViewportPos == null && state.modifierKeys.altKey) {\r\n    return \"pointer\" as const;\r\n  }\r\n\r\n  return state.currentTool;\r\n});\r\n\r\nexport const toolRadiusSelector = createEditorMouseSelector(\r\n  (state) => state.toolRadius\r\n);\r\n\r\nexport const toolViewportRadiusSelector = (state: AppState) => {\r\n  const radius = toolRadiusSelector(state);\r\n  return radius * state.services.editorView.zoomFactor;\r\n};\r\n","import { createEditorMouseSelector } from \"../state-utils\";\r\n\r\nexport const viewportMousePosSelector = createEditorMouseSelector(\r\n  (state) => state.mouseViewportPos\r\n);\r\n","import { clientToWorld } from \"@/services/editor-view/utils\";\r\nimport { AppState } from \"@/state\";\r\n\r\nexport const worldMousePosSelector = (state: AppState) => {\r\n  const mouseViewportPos = state.services.editorMouse.mouseViewportPos;\r\n  if (!mouseViewportPos) {\r\n    return null;\r\n  }\r\n  return clientToWorld(\r\n    mouseViewportPos,\r\n    state.services.editorView.offsetX,\r\n    state.services.editorView.offsetY,\r\n    state.services.editorView.zoomFactor\r\n  );\r\n};\r\n\r\nexport const worldMouseDownPosSelector = (state: AppState) => {\r\n  const mouseDownViewportPos = state.services.editorMouse.mouseDownViewportPos;\r\n  if (!mouseDownViewportPos) {\r\n    return null;\r\n  }\r\n  return clientToWorld(\r\n    mouseDownViewportPos,\r\n    state.services.editorView.offsetX,\r\n    state.services.editorView.offsetY,\r\n    state.services.editorView.zoomFactor\r\n  );\r\n};\r\n","import {\r\n  createServiceReducerCreator,\r\n  createServiceSelectorCreator,\r\n} from \"../state-utils\";\r\n\r\nexport const createEditorMouseReducer =\r\n  createServiceReducerCreator(\"editorMouse\");\r\nexport const createEditorMouseSelector =\r\n  createServiceSelectorCreator(\"editorMouse\");\r\n","import { Point } from \"@/geometry\";\r\nimport { ModifierKeys, MODIFIER_KEYS_NONE } from \"@/modifier-keys\";\r\n\r\nexport type EditorMouseTool = \"pointer\" | \"eraser\" | \"paint-danger-zone\";\r\nexport type EditorMousePointerGesture = \"pan\" | \"drag-select\" | \"drag-move\";\r\n\r\nexport interface EditorMouseServiceState {\r\n  currentTool: EditorMouseTool;\r\n  toolRadius: number;\r\n  currentPointerGesture: null | EditorMousePointerGesture;\r\n  mouseDownViewportPos: Point | null;\r\n  mouseViewportPos: Point | null;\r\n  modifierKeys: ModifierKeys;\r\n}\r\n\r\nconst _defaultState: EditorMouseServiceState = {\r\n  currentTool: \"pointer\",\r\n  toolRadius: 2,\r\n  currentPointerGesture: null,\r\n  mouseDownViewportPos: null,\r\n  mouseViewportPos: null,\r\n  modifierKeys: MODIFIER_KEYS_NONE,\r\n};\r\n\r\nexport const defaultEditorMouseServiceState = Object.freeze(_defaultState);\r\n","import { isEntityDeleteAction } from \"@/actions/entity-delete\";\r\nimport { createEditorSelectionReducer } from \"../state-utils\";\r\n\r\nexport default createEditorSelectionReducer((state, action) => {\r\n  if (!isEntityDeleteAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { entityKeys } = action.payload;\r\n\r\n  return {\r\n    ...state,\r\n    selectedEntityKeys: state.selectedEntityKeys.filter(\r\n      (x) => !entityKeys.includes(x)\r\n    ),\r\n  };\r\n});\r\n","import { concatReducers } from \"@/reducer/utils\";\r\n\r\nimport entityDeleteReducer from \"./entity-delete\";\r\nimport selectClearReducer from \"./select-clear\";\r\nimport selectEntityReducer from \"./select-entity\";\r\nimport selectionDeleteReducer from \"./selection-delete\";\r\n\r\nexport default concatReducers(\r\n  entityDeleteReducer,\r\n  selectClearReducer,\r\n  selectEntityReducer,\r\n  selectionDeleteReducer\r\n);\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { isSelectClearAction } from \"@/actions/select-clear\";\r\n\r\nimport { defaultEditorSelectionState, EditorSelectionState } from \"../state\";\r\nimport { createEditorSelectionReducer } from \"../state-utils\";\r\n\r\nexport default createEditorSelectionReducer(function selectClearReducer(\r\n  state: EditorSelectionState = defaultEditorSelectionState,\r\n  action: AnyAction\r\n): EditorSelectionState {\r\n  if (!isSelectClearAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    selectedEntityKeys: [],\r\n  };\r\n});\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { isSelectEntityAction } from \"@/actions/select-entity\";\r\nimport { combineSelection } from \"@/selection-mode\";\r\n\r\nimport { defaultEditorSelectionState, EditorSelectionState } from \"../state\";\r\nimport { createEditorSelectionReducer } from \"../state-utils\";\r\n\r\nexport default createEditorSelectionReducer(function selectEntityReducer(\r\n  state: EditorSelectionState = defaultEditorSelectionState,\r\n  action: AnyAction\r\n): EditorSelectionState {\r\n  if (!isSelectEntityAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { entityKeys, mode } = action.payload;\r\n  return {\r\n    ...state,\r\n    selectedEntityKeys: combineSelection(\r\n      state.selectedEntityKeys,\r\n      entityKeys,\r\n      mode\r\n    ),\r\n  };\r\n});\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { AppState, defaultAppState } from \"@/state\";\r\n\r\nimport { isSelectionDeleteAction } from \"@/actions/selection-delete\";\r\nimport { entityDelete } from \"@/actions/entity-delete\";\r\n\r\nimport rootReducer from \"@/reducer\";\r\n\r\nexport default function selectionDeleteReducer(\r\n  state: AppState = defaultAppState,\r\n  action: AnyAction\r\n): AppState {\r\n  if (!isSelectionDeleteAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const selectedEntityKeys = state.services.editorSelection.selectedEntityKeys;\r\n\r\n  if (selectedEntityKeys.length === 0) {\r\n    return state;\r\n  }\r\n\r\n  return rootReducer(state, entityDelete(selectedEntityKeys));\r\n}\r\n","import { AppState } from \"@/state\";\r\n\r\nexport const isEntitySelectedSelector = (state: AppState, entityKey: string) =>\r\n  state.services.editorSelection.selectedEntityKeys.includes(entityKey);\r\n\r\nexport const selectedEntityKeysSelector = (state: AppState) =>\r\n  state.services.editorSelection.selectedEntityKeys;\r\n","import {\r\n  createServiceReducerCreator,\r\n  createServiceSelectorCreator,\r\n} from \"../state-utils\";\r\n\r\nexport const createEditorSelectionReducer =\r\n  createServiceReducerCreator(\"editorSelection\");\r\nexport const createEditorSelectionSelector =\r\n  createServiceSelectorCreator(\"editorSelection\");\r\n","export interface EditorSelectionState {\r\n  selectedEntityKeys: string[];\r\n}\r\n\r\nconst _defaultState: EditorSelectionState = {\r\n  selectedEntityKeys: [],\r\n};\r\n\r\nexport const defaultEditorSelectionState = Object.freeze(_defaultState);\r\n","import * as React from \"react\";\r\n\r\nimport { Point } from \"@/geometry\";\r\n\r\nimport { useSelector } from \"@/hooks/use-selector\";\r\n\r\nimport {\r\n  editorOffsetXSelector,\r\n  editorOffsetYSelector,\r\n  editorZoomFactorSelector,\r\n} from \"../selectors/view\";\r\nimport { clientToWorld } from \"../utils\";\r\n\r\nexport function useClientToWorld() {\r\n  const offsetX = useSelector(editorOffsetXSelector);\r\n  const offsetY = useSelector(editorOffsetYSelector);\r\n  const zoomFactor = useSelector(editorZoomFactorSelector);\r\n\r\n  return React.useCallback(\r\n    (p: Point) => clientToWorld(p, offsetX, offsetY, zoomFactor),\r\n    [offsetX, offsetY, zoomFactor]\r\n  );\r\n}\r\n","import { concatReducers } from \"@/reducer/utils\";\r\n\r\nimport panReducer from \"./pan\";\r\nimport viewportResizeReducer from \"./viewport-resize\";\r\nimport zoomReducer from \"./zoom\";\r\n\r\nexport default concatReducers(panReducer, viewportResizeReducer, zoomReducer);\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { isEditorPanAction } from \"@/actions/editor-pan\";\r\n\r\nimport { defaultEditorViewState, EditorViewState } from \"../state\";\r\nimport { createEditorViewReducer } from \"../state-utils\";\r\n\r\nexport default createEditorViewReducer(function panReducer(\r\n  state: EditorViewState = defaultEditorViewState,\r\n  action: AnyAction\r\n): EditorViewState {\r\n  if (!isEditorPanAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { x, y } = action.payload;\r\n\r\n  return {\r\n    ...state,\r\n    offsetX: state.offsetX + x,\r\n    offsetY: state.offsetY + y,\r\n  };\r\n});\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { isEditorViewportResizeAction } from \"@/actions/editor-viewport-resize\";\r\n\r\nimport { defaultEditorViewState, EditorViewState } from \"../state\";\r\nimport { createEditorViewReducer } from \"../state-utils\";\r\n\r\nexport default createEditorViewReducer(function viewportResizeReducer(\r\n  state: EditorViewState = defaultEditorViewState,\r\n  action: AnyAction\r\n): EditorViewState {\r\n  if (!isEditorViewportResizeAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { height, width } = action.payload;\r\n\r\n  let zoomFactor = state.zoomFactor;\r\n  if (state.viewportWidth === 0) {\r\n    zoomFactor = Math.min(width, height) / 120;\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    viewportWidth: width,\r\n    viewportHeight: height,\r\n    zoomFactor,\r\n  };\r\n});\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { AppState, defaultAppState } from \"@/state\";\r\nimport { fpSet } from \"@/fp-set\";\r\nimport { pointSubtract } from \"@/geometry\";\r\n\r\nimport rootReducer from \"@/reducer\";\r\n\r\nimport { worldMousePosSelector } from \"@/services/editor-mouse/selectors/world-coords\";\r\n\r\nimport { isEditorZoomAction } from \"@/actions/editor-zoom\";\r\nimport { editorPan } from \"@/actions/editor-pan\";\r\n\r\nexport default function zoomReducer(\r\n  state: AppState = defaultAppState,\r\n  action: AnyAction\r\n): AppState {\r\n  if (!isEditorZoomAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { zoomFactor } = action.payload;\r\n\r\n  const worldMousePos = worldMousePosSelector(state);\r\n\r\n  state = fpSet(state, \"services\", \"editorView\", \"zoomFactor\", zoomFactor);\r\n\r\n  const newMousePos = worldMousePosSelector(state);\r\n\r\n  if (worldMousePos != null && newMousePos != null) {\r\n    const offset = pointSubtract(worldMousePos, newMousePos);\r\n    state = rootReducer(state, editorPan(offset.x, -offset.y));\r\n  }\r\n\r\n  return state;\r\n}\r\n","import { Point } from \"@/geometry\";\r\nimport { AppState } from \"@/state\";\r\n\r\nimport { clientToWorld, worldToClient } from \"../utils\";\r\n\r\nexport const clientToWorldSelector = (state: AppState, p: Point) => {\r\n  return clientToWorld(\r\n    p,\r\n    state.services.editorView.offsetX,\r\n    state.services.editorView.offsetY,\r\n    state.services.editorView.zoomFactor\r\n  );\r\n};\r\n\r\nexport const worldToClientSelector = (state: AppState, p: Point) => {\r\n  return worldToClient(\r\n    p,\r\n    state.services.editorView.offsetX,\r\n    state.services.editorView.offsetY,\r\n    state.services.editorView.zoomFactor\r\n  );\r\n};\r\n","import { AppState } from \"@/state\";\r\n\r\nexport const editorOffsetXSelector = (state: AppState) =>\r\n  state.services.editorView.offsetX;\r\nexport const editorOffsetYSelector = (state: AppState) =>\r\n  state.services.editorView.offsetY;\r\n\r\nexport const editorZoomFactorSelector = (state: AppState) =>\r\n  state.services.editorView.zoomFactor;\r\n","import { AppState } from \"@/state\";\r\n\r\nexport const editorViewportWidthSelector = (state: AppState) =>\r\n  state.services.editorView.viewportWidth;\r\nexport const editorViewportHeightSelector = (state: AppState) =>\r\n  state.services.editorView.viewportHeight;\r\n","import {\r\n  createServiceReducerCreator,\r\n  createServiceSelectorCreator,\r\n} from \"../state-utils\";\r\n\r\nexport const createEditorViewReducer =\r\n  createServiceReducerCreator(\"editorView\");\r\nexport const createEditorViewSelector =\r\n  createServiceSelectorCreator(\"editorView\");\r\n","export interface EditorViewState {\r\n  viewportWidth: number;\r\n  viewportHeight: number;\r\n  offsetX: number;\r\n  offsetY: number;\r\n  zoomFactor: number;\r\n}\r\n\r\nconst _defaultState: EditorViewState = {\r\n  viewportWidth: 0,\r\n  viewportHeight: 0,\r\n  offsetX: 0,\r\n  offsetY: 0,\r\n  zoomFactor: 1,\r\n};\r\n\r\nexport const defaultEditorViewState = Object.freeze(_defaultState);\r\n","import { Point } from \"@/geometry\";\r\n\r\nexport const worldToClient = (\r\n  p: Point,\r\n  offsetX: number,\r\n  offsetY: number,\r\n  zoomFactor: number\r\n) => ({\r\n  x: (p.x - offsetX + 60) * zoomFactor,\r\n  y: (-p.y - offsetY + 60) * zoomFactor,\r\n});\r\n\r\nexport const clientToWorld = (\r\n  p: Point,\r\n  offsetX: number,\r\n  offsetY: number,\r\n  zoomFactor: number\r\n) => ({\r\n  x: p.x / zoomFactor - 60 + offsetX,\r\n  y: (p.y / zoomFactor - 60 + offsetY) * -1,\r\n});\r\n","import * as React from \"react\";\r\n\r\nimport { I18nextProvider } from \"react-i18next\";\r\n\r\nimport i18n from \"../i18n\";\r\n\r\nconst I18NProvider: React.FC = ({ children }) => (\r\n  <I18nextProvider i18n={i18n}>{children}</I18nextProvider>\r\n);\r\nexport default I18NProvider;\r\n","import i18n from \"i18next\";\r\nimport { initReactI18next } from \"react-i18next\";\r\n\r\nimport { isProd } from \"@/runtime-env\";\r\n\r\ni18n.use(initReactI18next).init({\r\n  fallbackLng: \"en\",\r\n\r\n  ns: [\"common\", \"potioncraft\"],\r\n  defaultNS: \"common\",\r\n\r\n  resources: {\r\n    en: {\r\n      common: require(\"@/translations/en/common.json\"),\r\n      potioncraft: require(\"@/translations/en/potioncraft.json\"),\r\n    },\r\n  },\r\n\r\n  debug: !isProd,\r\n\r\n  interpolation: {\r\n    escapeValue: false, // not needed for react!!\r\n  },\r\n\r\n  react: {\r\n    wait: true,\r\n  },\r\n});\r\n\r\nexport default i18n;\r\n","import { createStructuredSelector } from \"@/state\";\r\n\r\nimport { I18NState } from \"./state\";\r\nimport i18n from \"./i18n\";\r\nimport { currentLanguageSelector } from \"./selectors/language\";\r\n\r\nexport const persistState = createStructuredSelector({\r\n  language: currentLanguageSelector\r\n});\r\n\r\ntype PersistedState = ReturnType<typeof persistState>;\r\n\r\nexport function loadState(\r\n  state: I18NState,\r\n  persisted: PersistedState\r\n): I18NState {\r\n  i18n.changeLanguage(persisted.language);\r\n\r\n  return {\r\n    ...state,\r\n    ...persisted\r\n  };\r\n}\r\n","import setLanguageReducer from \"./set-language\";\r\n\r\nexport default setLanguageReducer;\r\n","import { Action } from \"redux\";\r\n\r\nimport { ACTION_SET_LANGUAGE, SetLanguageAction } from \"@/actions/set-language\";\r\n\r\nimport { I18NState, defaultI18NState } from \"../state\";\r\nimport { createI18nReducer } from \"../state-utils\";\r\n\r\nimport i18n from \"../i18n\";\r\n\r\nexport default createI18nReducer(function setLanguageReducer(\r\n  state: I18NState = defaultI18NState,\r\n  action: Action\r\n): I18NState {\r\n  if (action.type !== ACTION_SET_LANGUAGE) {\r\n    return state;\r\n  }\r\n\r\n  const lang = (action as SetLanguageAction).payload;\r\n\r\n  // TODO: Side effect should be in saga.\r\n  i18n.changeLanguage(lang);\r\n\r\n  return {\r\n    ...state,\r\n    language: lang,\r\n  };\r\n});\r\n","import { I18NState as I18nState } from \"../state\";\r\nimport { createI18nSelector } from \"../state-utils\";\r\n\r\nexport const currentLanguageSelector = createI18nSelector(\r\n  (state: I18nState) => state.language\r\n);\r\n","import {\r\n  createServiceReducerCreator,\r\n  createServiceSelectorCreator,\r\n} from \"../state-utils\";\r\n\r\nexport const createI18nReducer = createServiceReducerCreator(\"i18n\");\r\nexport const createI18nSelector = createServiceSelectorCreator(\"i18n\");\r\n","export interface I18NState {\r\n  language: string;\r\n}\r\n\r\nexport const defaultI18NState: Readonly<I18NState> = {\r\n  language: \"en\"\r\n};\r\nObject.freeze(defaultI18NState);\r\n","import * as React from \"react\";\r\n\r\nimport { mapConfigLoadFile } from \"@/actions/map-config-load-file\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\n\r\nimport { loadingStatusSelector } from \"../selectors/loading-status\";\r\n\r\nexport interface UseLoadMapConfig {\r\n  disabled: boolean;\r\n  onLoadSave(file: File): void;\r\n}\r\n\r\nexport default function useLoadMapConfig(): UseLoadMapConfig {\r\n  const dispatch = useDispatch();\r\n  const loadingStatus = useSelector(loadingStatusSelector);\r\n  const onLoadSave = React.useCallback(\r\n    (file: File) => {\r\n      dispatch(mapConfigLoadFile(file));\r\n    },\r\n    [dispatch]\r\n  );\r\n  return {\r\n    disabled: loadingStatus === \"loading\",\r\n    onLoadSave,\r\n  };\r\n}\r\n","import { concatReducers } from \"@/reducer/utils\";\r\n\r\nimport entityDeleteReducer from \"../../map-entities/reducer/entity-delete\";\r\nimport loadMapConfig from \"./load-map-config\";\r\nimport receiveMapConfig from \"./receive-map-config\";\r\n\r\nexport default concatReducers(\r\n  entityDeleteReducer,\r\n  loadMapConfig,\r\n  receiveMapConfig\r\n);\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { isMapConfigLoadFileAction } from \"@/actions/map-config-load-file\";\r\n\r\nimport { defaultMapConfigState, MapConfigState } from \"../state\";\r\nimport { createMapConfigReducer } from \"../state-utils\";\r\n\r\nexport default createMapConfigReducer(function loadMapConfig(\r\n  state: MapConfigState = defaultMapConfigState,\r\n  action: AnyAction\r\n): MapConfigState {\r\n  if (!isMapConfigLoadFileAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    loadingStatus: \"loading\",\r\n  };\r\n});\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { isMapConfigReceiveAction } from \"@/actions/map-config-receive\";\r\n\r\nimport { defaultMapConfigState, MapConfigState } from \"../state\";\r\nimport { createMapConfigReducer } from \"../state-utils\";\r\n\r\nexport default createMapConfigReducer(function receiveMapConfig(\r\n  state: MapConfigState = defaultMapConfigState,\r\n  action: AnyAction\r\n): MapConfigState {\r\n  if (!isMapConfigReceiveAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    loadingStatus: \"loaded\",\r\n    errorMessage: null,\r\n  };\r\n});\r\n","import { fork } from \"redux-saga/effects\";\r\n\r\nimport mapConfigLoadBlankSaga from \"./map-config-load-blank\";\r\nimport mapConfigLoadFileSaga from \"./map-config-load-file\";\r\nimport mapConfigLoadTemplateSaga from \"./map-config-load-template\";\r\nimport mapConfigSaveSaga from \"./map-config-save\";\r\n\r\nexport default function* mapConfigSaga() {\r\n  yield fork(mapConfigLoadBlankSaga);\r\n  yield fork(mapConfigLoadFileSaga);\r\n  yield fork(mapConfigLoadTemplateSaga);\r\n  yield fork(mapConfigSaveSaga);\r\n}\r\n","import { put, takeEvery } from \"redux-saga/effects\";\r\nimport { SagaIterator } from \"@redux-saga/types\";\r\n\r\nimport { ACTION_MAPCONFIG_LOAD_BLANK } from \"@/actions/map-config-load-blank\";\r\nimport { mapConfigReceive } from \"@/actions/map-config-receive\";\r\n\r\nexport default function* mapConfigLoadBlank(): SagaIterator {\r\n  yield takeEvery(ACTION_MAPCONFIG_LOAD_BLANK, handleMapConfigLoadBlank);\r\n}\r\n\r\nfunction* handleMapConfigLoadBlank(): SagaIterator {\r\n  // TODO: Ask if unsaved changes.\r\n\r\n  yield put(\r\n    mapConfigReceive({\r\n      entities: [],\r\n    })\r\n  );\r\n}\r\n","import { put, call, takeEvery } from \"redux-saga/effects\";\r\nimport { SagaIterator } from \"@redux-saga/types\";\r\n\r\nimport { MapConfig } from \"@/map-config\";\r\n\r\nimport {\r\n  ACTION_MAPCONFIG_LOAD_FILE,\r\n  MapConfigLoadFileAction,\r\n} from \"@/actions/map-config-load-file\";\r\nimport { mapConfigReceive } from \"@/actions/map-config-receive\";\r\n\r\nexport default function* mapConfigLoadFileSaga(): SagaIterator {\r\n  yield takeEvery(ACTION_MAPCONFIG_LOAD_FILE, handleMapConfigLoadFile);\r\n}\r\n\r\nfunction* handleMapConfigLoadFile(\r\n  action: MapConfigLoadFileAction\r\n): SagaIterator {\r\n  const { file } = action.payload;\r\n\r\n  // TODO: Ask if unsaved changes.\r\n\r\n  // TODO: catch errors and report\r\n  const text = yield call(() => file.text());\r\n\r\n  const mapConfig = JSON.parse(text) as MapConfig;\r\n\r\n  // TODO: Validate config\r\n\r\n  yield put(mapConfigReceive(mapConfig));\r\n}\r\n","import cloneDeep from \"lodash/cloneDeep\";\r\nimport { put, takeEvery } from \"redux-saga/effects\";\r\nimport { SagaIterator } from \"@redux-saga/types\";\r\n\r\nimport {\r\n  ACTION_MAPCONFIG_LOAD_TEMPLATE,\r\n  MapConfigLoadTemplateAction,\r\n} from \"@/actions/map-config-load-template\";\r\nimport { mapConfigReceive } from \"@/actions/map-config-receive\";\r\nimport { TemplatesByName } from \"@/map-templates\";\r\n\r\nexport default function* mapConfigLoadTemplate(): SagaIterator {\r\n  yield takeEvery(ACTION_MAPCONFIG_LOAD_TEMPLATE, handleMapConfigLoadTemplate);\r\n}\r\n\r\nfunction* handleMapConfigLoadTemplate(\r\n  action: MapConfigLoadTemplateAction\r\n): SagaIterator {\r\n  const { templateName } = action.payload;\r\n\r\n  // TODO: Ask if unsaved changes.\r\n\r\n  const template = TemplatesByName[templateName];\r\n  if (!template) {\r\n    return;\r\n  }\r\n\r\n  yield put(mapConfigReceive(cloneDeep(template)));\r\n}\r\n","import { SagaIterator } from \"redux-saga\";\r\nimport { call, select, takeEvery } from \"redux-saga/effects\";\r\nimport { saveAs } from \"file-saver\";\r\n\r\nimport { AppState } from \"@/state\";\r\n\r\nimport { ACTION_MAPCONFIG_SAVE } from \"@/actions/map-config-save\";\r\nimport { mapFileSelector } from \"../selectors/mapfile\";\r\n\r\nexport default function* projectSaveSaga() {\r\n  yield takeEvery(ACTION_MAPCONFIG_SAVE, saveProject);\r\n}\r\n\r\nfunction* saveProject() {\r\n  const state: AppState = yield select();\r\n\r\n  const projectName = \"potioncraft map\";\r\n\r\n  try {\r\n    if (window.showSaveFilePicker) {\r\n      yield call(saveNativeFileApi, state, projectName);\r\n    } else {\r\n      yield call(saveLegacy, state, projectName);\r\n    }\r\n  } catch (e) {\r\n    // TODO: Report error\r\n    console.warn(\"Failed to save project\", e);\r\n  }\r\n}\r\n\r\nfunction* saveNativeFileApi(\r\n  state: AppState,\r\n  projectName: string\r\n): SagaIterator {\r\n  const fileHandle: FileHandle | null = yield call(window.showSaveFilePicker!, {\r\n    // This isn't official yet, even with the not-official showSaveFilePicker\r\n    // https://github.com/WICG/file-system-access/blob/main/SuggestedNameAndDir.md#specifying-suggested-file-name-to-save-as\r\n    // It's so new, chrome does not yet support it, but it will:\r\n    // https://bugs.chromium.org/p/chromium/issues/detail?id=1145102\r\n    suggestedName: projectName,\r\n    types: [\r\n      {\r\n        description: \"PotionCraft Maps\",\r\n        accept: {\r\n          \"application/json\": [\".json\"],\r\n        },\r\n      },\r\n    ],\r\n  });\r\n\r\n  if (!fileHandle) {\r\n    return;\r\n  }\r\n\r\n  // Some confusion over how to get the name of the file...\r\n  // fileHandle.name appears in the debugger for chrome, but does not\r\n  // seem to be documented.\r\n  // getFile().name is documented by mozilla, but gives me undefined.\r\n  let name = fileHandle.name;\r\n  if (!name) {\r\n    name = fileHandle.getFile().name;\r\n  }\r\n  if (name) {\r\n    name = name.substr(0, name.lastIndexOf(\".json\"));\r\n  }\r\n\r\n  const save = mapFileSelector(state);\r\n\r\n  const writable: FileSystemWritableStream = yield call(\r\n    fileHandle.createWritable.bind(fileHandle)\r\n  );\r\n  yield call(writable.write.bind(writable), JSON.stringify(save, null, 2));\r\n  yield call(writable.close.bind(writable));\r\n}\r\n\r\nfunction* saveLegacy(state: AppState, projectName: string): SagaIterator {\r\n  const save = mapFileSelector(state);\r\n  const blob = new Blob([JSON.stringify(save, null, 2)], {\r\n    type: \"application/json;charset=utf-8\",\r\n  });\r\n\r\n  saveAs(blob, `${projectName}.json`);\r\n}\r\n","import { AppState } from \"@/state\";\r\n\r\nexport const loadingStatusSelector = (state: AppState) =>\r\n  state.services.mapConfig.loadingStatus;\r\n","import values from \"lodash/values\";\r\n\r\nimport { AppState } from \"@/state\";\r\n\r\nexport const mapFileSelector = (state: AppState) => {\r\n  return {\r\n    entities: values(state.services.mapEntities.entitiesByKey),\r\n  };\r\n};\r\n","import {\r\n  createServiceReducerCreator,\r\n  createServiceSelectorCreator,\r\n} from \"../state-utils\";\r\n\r\nexport const createMapConfigReducer = createServiceReducerCreator(\"mapConfig\");\r\nexport const createMapConfigSelector =\r\n  createServiceSelectorCreator(\"mapConfig\");\r\n","export interface MapConfigState {\r\n  loadingStatus: \"idle\" | \"loading\" | \"loaded\" | \"error\";\r\n  errorMessage: string | null;\r\n}\r\n\r\nconst _defaultMapConfigState: MapConfigState = {\r\n  loadingStatus: \"idle\",\r\n  errorMessage: null,\r\n};\r\n\r\nexport const defaultMapConfigState = Object.freeze(_defaultMapConfigState);\r\n","import omit from \"lodash/omit\";\r\n\r\nimport { isEntityDeleteAction } from \"@/actions/entity-delete\";\r\n\r\nimport { createMapEntitiesReducer } from \"../state-utils\";\r\nimport { removeFromRegionContainer } from \"../regions\";\r\n\r\nexport default createMapEntitiesReducer((state, action) => {\r\n  if (!isEntityDeleteAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { entityKeys } = action.payload;\r\n\r\n  for (const entityKey of entityKeys) {\r\n    const entity = state.entitiesByKey[entityKey];\r\n    if (!entity) {\r\n      continue;\r\n    }\r\n    state = removeFromRegionContainer(state, entity, entityKey);\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    entitiesByKey: omit(state.entitiesByKey, entityKeys),\r\n  };\r\n});\r\n","import { isEntityInsertAction } from \"@/actions/entity-insert\";\r\n\r\nimport { addToRegionContainer } from \"../regions\";\r\n\r\nimport { createMapEntitiesReducer } from \"../state-utils\";\r\n\r\nexport default createMapEntitiesReducer((state, action) => {\r\n  if (!isEntityInsertAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { entities } = action.payload;\r\n\r\n  for (const entityKey of Object.keys(entities)) {\r\n    const entity = entities[entityKey];\r\n    state = addToRegionContainer(state, entity, entityKey);\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    entitiesByKey: {\r\n      ...state.entitiesByKey,\r\n      ...entities,\r\n    },\r\n  };\r\n});\r\n","import mapValues from \"lodash/mapValues\";\r\n\r\nimport { pointAdd } from \"@/geometry\";\r\n\r\nimport { isEntityOffsetAction } from \"@/actions/entity-offset\";\r\n\r\nimport { createMapEntitiesReducer } from \"../state-utils\";\r\nimport { addToRegionContainer, removeFromRegionContainer } from \"../regions\";\r\n\r\nexport default createMapEntitiesReducer((state, action) => {\r\n  if (!isEntityOffsetAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { entityKeys, offsetX, offsetY } = action.payload;\r\n  const offsetP = { x: offsetX, y: offsetY };\r\n\r\n  for (const entityKey of entityKeys) {\r\n    const entity = state.entitiesByKey[entityKey];\r\n    if (!entity) {\r\n      continue;\r\n    }\r\n    state = removeFromRegionContainer(state, entity, entityKey);\r\n    state = addToRegionContainer(state, pointAdd(entity, offsetP), entityKey);\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    entitiesByKey: mapValues(state.entitiesByKey, (entity, key) => {\r\n      if (!entityKeys.includes(key)) {\r\n        return entity;\r\n      }\r\n      return {\r\n        ...entity,\r\n        ...pointAdd(entity, offsetP),\r\n      };\r\n    }),\r\n  };\r\n});\r\n","import { concatReducers } from \"@/reducer/utils\";\r\n\r\nimport entityDeleteReducer from \"./entity-delete\";\r\nimport entityInsertReducer from \"./entity-insert\";\r\nimport entityOffsetReducer from \"./entity-offset\";\r\nimport prototypeInstantiateReducer from \"./prototype-instantiate\";\r\nimport receiveMapConfigReducer from \"./map-config-receive\";\r\n\r\nexport default concatReducers(\r\n  entityDeleteReducer,\r\n  entityInsertReducer,\r\n  entityOffsetReducer,\r\n  prototypeInstantiateReducer,\r\n  receiveMapConfigReducer\r\n);\r\n","import { v4 as uuidV4 } from \"uuid\";\r\n\r\nimport { MapEntity } from \"@/map-config\";\r\n\r\nimport { isMapConfigReceiveAction } from \"@/actions/map-config-receive\";\r\n\r\nimport { createMapEntitiesReducer } from \"../state-utils\";\r\nimport { addToRegionContainer } from \"../regions\";\r\nimport { defaultMapEntityStates } from \"../state\";\r\n\r\nexport default createMapEntitiesReducer((state, action) => {\r\n  if (!isMapConfigReceiveAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  state = defaultMapEntityStates;\r\n\r\n  const { mapConfig } = action.payload;\r\n\r\n  const entitiesByKey: Record<string, MapEntity> = {};\r\n  for (let entity of mapConfig.entities) {\r\n    entitiesByKey[uuidV4()] = entity;\r\n  }\r\n\r\n  for (const entityKey of Object.keys(entitiesByKey)) {\r\n    const entity = entitiesByKey[entityKey];\r\n    state = addToRegionContainer(state, entity, entityKey);\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    entitiesByKey,\r\n  };\r\n});\r\n","import { isEntityPrototypeInstantiateAction } from \"@/actions/entity-prototype-instantiate\";\r\nimport { MapEntity } from \"@/map-config\";\r\nimport { addToRegionContainer } from \"../regions\";\r\n\r\nimport { createMapEntitiesReducer } from \"../state-utils\";\r\n\r\nexport default createMapEntitiesReducer((state, action) => {\r\n  if (!isEntityPrototypeInstantiateAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { prototype, worldPos, entityKey: key } = action.payload;\r\n\r\n  const entity = {\r\n    ...prototype,\r\n    x: worldPos.x,\r\n    y: worldPos.y,\r\n  } as MapEntity;\r\n\r\n  state = addToRegionContainer(state, entity, key);\r\n\r\n  return {\r\n    ...state,\r\n    entitiesByKey: {\r\n      ...state.entitiesByKey,\r\n      [key]: entity,\r\n    },\r\n  };\r\n});\r\n","import { LargestEntityRadius } from \"@/entities\";\r\nimport { fpSet } from \"@/fp-set\";\r\nimport { Point, pointAdd, Rectangle } from \"@/geometry\";\r\n\r\nexport interface MapRegionContainer {\r\n  entityRegions: MapRegion[];\r\n  outOfBoundsRegion: MapRegion;\r\n}\r\n\r\nexport interface MapRegion {\r\n  entityKeys: string[];\r\n}\r\n\r\nconst MAP_WIDTH = 120;\r\nconst MAP_HEIGHT = 120;\r\nconst REGION_WIDTH = 10;\r\nconst REGION_HEIGHT = 10;\r\n\r\nconst ORIGIN_OFFSET: Point = { x: 60, y: 60 };\r\n\r\nexport const REGION_COUNT =\r\n  (MAP_WIDTH / REGION_WIDTH) * (MAP_HEIGHT / REGION_HEIGHT);\r\n\r\n// FIXME: Entities can be in multiple regions due to their hit radius.  Widen the point and return multiple region indexes from here.\r\nexport function getRegionIndexsFromPoint(p: Point): number[] {\r\n  const r = {\r\n    p1: {\r\n      x: p.x - LargestEntityRadius,\r\n      y: p.y - LargestEntityRadius,\r\n    },\r\n    p2: {\r\n      x: p.x + LargestEntityRadius,\r\n      y: p.y + LargestEntityRadius,\r\n    },\r\n  };\r\n\r\n  return getRegionIndexesFromRect(r);\r\n}\r\n\r\nexport function getEntityKeysFromPoint(\r\n  container: MapRegionContainer,\r\n  p: Point\r\n): string[] {\r\n  const regionIndexes = getRegionIndexsFromPoint(p);\r\n  const regionKeys: string[] = [];\r\n  regionIndexes.forEach((regionIndex) => {\r\n    if (regionIndex === -1) {\r\n      regionKeys.push(...container.outOfBoundsRegion.entityKeys);\r\n    } else {\r\n      regionKeys.push(...container.entityRegions[regionIndex].entityKeys);\r\n    }\r\n  });\r\n\r\n  return regionKeys;\r\n}\r\n\r\nexport function getRegionIndexesFromRect(r: Rectangle): number[] {\r\n  let { p1, p2 } = r;\r\n  p1 = pointAdd(p1, ORIGIN_OFFSET);\r\n  p2 = pointAdd(p2, ORIGIN_OFFSET);\r\n\r\n  let x1 = Math.floor((p1.x - LargestEntityRadius) / REGION_WIDTH);\r\n  let y1 = Math.floor((p1.y - LargestEntityRadius) / REGION_HEIGHT);\r\n  let x2 = Math.floor((p2.x + LargestEntityRadius) / REGION_WIDTH);\r\n  let y2 = Math.floor((p2.y + LargestEntityRadius) / REGION_HEIGHT);\r\n\r\n  const indexes = [];\r\n\r\n  let addedOOB = false;\r\n  const addOOB = () => {\r\n    if (addedOOB) {\r\n      return;\r\n    }\r\n    indexes.push(-1);\r\n    addedOOB = true;\r\n  };\r\n\r\n  if (x1 < 0) {\r\n    x1 = 0;\r\n    addOOB();\r\n  }\r\n\r\n  if (x2 < 0) {\r\n    x2 = 0;\r\n    addOOB();\r\n  }\r\n\r\n  if (x1 >= MAP_WIDTH / REGION_WIDTH) {\r\n    x1 = MAP_WIDTH / REGION_WIDTH - 1;\r\n    addOOB();\r\n  }\r\n\r\n  if (x2 >= MAP_WIDTH / REGION_WIDTH) {\r\n    x2 = MAP_WIDTH / REGION_WIDTH - 1;\r\n    addOOB();\r\n  }\r\n\r\n  if (y1 < 0) {\r\n    y1 = 0;\r\n    addOOB();\r\n  }\r\n\r\n  if (y2 < 0) {\r\n    y2 = 0;\r\n    addOOB();\r\n  }\r\n\r\n  if (y1 >= MAP_HEIGHT / REGION_HEIGHT) {\r\n    y1 = MAP_HEIGHT / REGION_HEIGHT - 1;\r\n    addOOB();\r\n  }\r\n\r\n  if (y2 >= MAP_HEIGHT / REGION_HEIGHT) {\r\n    y2 = MAP_HEIGHT / REGION_HEIGHT - 1;\r\n    addOOB();\r\n  }\r\n\r\n  for (let x = x1; x <= x2; x++) {\r\n    for (let y = y1; y <= y2; y++) {\r\n      indexes.push(x + y * (MAP_WIDTH / REGION_WIDTH));\r\n    }\r\n  }\r\n\r\n  return indexes;\r\n}\r\n\r\nexport function getEntityKeysFromRect(\r\n  container: MapRegionContainer,\r\n  r: Rectangle\r\n): string[] {\r\n  const regionIndexes = getRegionIndexesFromRect(r);\r\n  const regionKeys: string[] = [];\r\n  regionIndexes.forEach((regionIndex) => {\r\n    if (regionIndex === -1) {\r\n      regionKeys.push(...container.outOfBoundsRegion.entityKeys);\r\n    } else {\r\n      regionKeys.push(...container.entityRegions[regionIndex].entityKeys);\r\n    }\r\n  });\r\n\r\n  return regionKeys;\r\n}\r\n\r\nexport function addToRegionContainer<T extends MapRegionContainer>(\r\n  container: T,\r\n  p: Point,\r\n  entityKey: string\r\n) {\r\n  const regionIndexes = getRegionIndexsFromPoint(p);\r\n  return regionIndexes.reduce((container, regionIndex) => {\r\n    if (regionIndex === -1) {\r\n      return fpSet(container, \"outOfBoundsRegion\", (region) =>\r\n        addToRegion(region, entityKey)\r\n      );\r\n    } else {\r\n      return fpSet(container, \"entityRegions\", regionIndex, (region) =>\r\n        addToRegion(region, entityKey)\r\n      );\r\n    }\r\n  }, container);\r\n}\r\n\r\nexport function removeFromRegionContainer<T extends MapRegionContainer>(\r\n  container: T,\r\n  p: Point,\r\n  entityKey: string\r\n) {\r\n  const regionIndexes = getRegionIndexsFromPoint(p);\r\n  return regionIndexes.reduce((container, regionIndex) => {\r\n    if (regionIndex === -1) {\r\n      return fpSet(container, \"outOfBoundsRegion\", (region) =>\r\n        removeFromRegion(region, entityKey)\r\n      );\r\n    } else {\r\n      return fpSet(container, \"entityRegions\", regionIndex, (region) =>\r\n        removeFromRegion(region, entityKey)\r\n      );\r\n    }\r\n  }, container);\r\n}\r\n\r\nfunction addToRegion(region: MapRegion, entityKey: string): MapRegion {\r\n  return {\r\n    ...region,\r\n    entityKeys: [...region.entityKeys, entityKey],\r\n  };\r\n}\r\n\r\nfunction removeFromRegion(region: MapRegion, entityKey: string): MapRegion {\r\n  return {\r\n    ...region,\r\n    entityKeys: region.entityKeys.filter((x) => x !== entityKey),\r\n  };\r\n}\r\n","import { createSelector } from \"reselect\";\r\nimport { AppState } from \"@/state\";\r\nimport { magnitude, Point, pointSubtract, Rectangle } from \"@/geometry\";\r\nimport { EntityDefsByType } from \"@/entities\";\r\n\r\nimport { createMapEntitiesSelector } from \"../state-utils\";\r\nimport { MapEntitiesState } from \"../state\";\r\nimport { getEntityKeysFromPoint, getEntityKeysFromRect } from \"../regions\";\r\n\r\nexport const entitiesByKeySelector = createMapEntitiesSelector(\r\n  (state) => state.entitiesByKey\r\n);\r\n\r\nexport const entitityKeysSelector = createSelector(\r\n  entitiesByKeySelector,\r\n  (entitiesByKey) => Object.keys(entitiesByKey)\r\n);\r\n\r\nexport const entityFromKeySelector = (state: AppState, entityKey: string) =>\r\n  entitiesByKeySelector(state)[entityKey];\r\n\r\nexport const entityKeyAtPointSelector = createMapEntitiesSelector(\r\n  (state: MapEntitiesState, worldPoint: Point) => {\r\n    const regionKeys = getEntityKeysFromPoint(state, worldPoint);\r\n\r\n    const entitiesByKey = state.entitiesByKey;\r\n    for (const key of regionKeys) {\r\n      const entity = entitiesByKey[key];\r\n      const type = EntityDefsByType[entity.entityType];\r\n      if (!type) {\r\n        continue;\r\n      }\r\n\r\n      const vec = pointSubtract(worldPoint, entity);\r\n      if (magnitude(vec) <= type.hitRadius) {\r\n        return key;\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n);\r\n\r\nexport const entityKeysAtPointSelector = (\r\n  state: AppState,\r\n  worldPoint: Point,\r\n  radius: number = 0,\r\n  ignoreHitRadius = false\r\n) => {\r\n  const mapEntities = state.services.mapEntities;\r\n  const r: Rectangle = {\r\n    p1: {\r\n      x: worldPoint.x - radius,\r\n      y: worldPoint.y - radius,\r\n    },\r\n    p2: {\r\n      x: worldPoint.x + radius,\r\n      y: worldPoint.y + radius,\r\n    },\r\n  };\r\n  const regionKeys = getEntityKeysFromRect(mapEntities, r);\r\n  const result = [];\r\n  for (const entityKey of regionKeys) {\r\n    const entity = mapEntities.entitiesByKey[entityKey];\r\n    const type = EntityDefsByType[entity.entityType];\r\n    if (!type) {\r\n      continue;\r\n    }\r\n\r\n    const vec = pointSubtract(worldPoint, entity);\r\n    if (magnitude(vec) <= (ignoreHitRadius ? 0 : type.hitRadius) + radius) {\r\n      result.push(entityKey);\r\n    }\r\n  }\r\n\r\n  return result;\r\n};\r\n","import {\r\n  createServiceReducerCreator,\r\n  createServiceSelectorCreator,\r\n} from \"../state-utils\";\r\n\r\nexport const createMapEntitiesReducer =\r\n  createServiceReducerCreator(\"mapEntities\");\r\nexport const createMapEntitiesSelector =\r\n  createServiceSelectorCreator(\"mapEntities\");\r\n","import { MapEntity } from \"@/map-config\";\r\n\r\nimport { MapRegionContainer, REGION_COUNT } from \"./regions\";\r\n\r\nexport interface MapEntitiesState extends MapRegionContainer {\r\n  entitiesByKey: Record<string, MapEntity>;\r\n}\r\n\r\nconst defaultRegion = Object.freeze({\r\n  entityKeys: [],\r\n});\r\n\r\nconst _defaultState: MapEntitiesState = {\r\n  entitiesByKey: {},\r\n  entityRegions: new Array(REGION_COUNT).fill(defaultRegion),\r\n  outOfBoundsRegion: defaultRegion,\r\n};\r\n\r\nexport const defaultMapEntityStates = Object.freeze(_defaultState);\r\n","import { concatReducers } from \"@/reducer/utils\";\r\n\r\nimport editorDamageReducer from \"@/services/editor-damage/reducer\";\r\nimport editorMouseReducer from \"@/services/editor-mouse/reducer\";\r\nimport editorSelectionReducer from \"@/services/editor-selection/reducer\";\r\nimport editorViewReducer from \"@/services/editor-view/reducer\";\r\nimport i18nReducer from \"@/services/i18n/reducer\";\r\nimport mapConfigReducer from \"@/services/map-config/reducer\";\r\nimport mapEntitiesReducer from \"@/services/map-entities/reducer\";\r\n\r\nexport default concatReducers(\r\n  editorDamageReducer,\r\n  editorMouseReducer,\r\n  editorSelectionReducer,\r\n  editorViewReducer,\r\n  i18nReducer,\r\n  mapConfigReducer,\r\n  mapEntitiesReducer\r\n);\r\n","import { fork } from \"redux-saga/effects\";\r\n\r\nimport mapConfigSaga from \"./map-config/saga\";\r\n\r\nexport function* servicesSaga() {\r\n  yield fork(mapConfigSaga);\r\n}\r\n","import { AnyAction, Reducer } from \"redux\";\r\n\r\nimport { AppState, defaultAppState } from \"@/state\";\r\nimport { fpSet } from \"@/fp-set\";\r\n\r\nexport type ServiceKey = keyof AppState[\"services\"];\r\nexport type ServiceState<TServiceKey extends ServiceKey> =\r\n  AppState[\"services\"][TServiceKey];\r\n\r\nexport interface ServiceReducer<TServiceState> {\r\n  (\r\n    state: Readonly<TServiceState>,\r\n    action: AnyAction,\r\n    appState: AppState\r\n  ): TServiceState;\r\n}\r\n\r\nexport function createServiceReducerCreator<TServiceKey extends ServiceKey>(\r\n  service: TServiceKey\r\n): (\r\n  reducer: ServiceReducer<AppState[\"services\"][TServiceKey]>\r\n) => Reducer<AppState, AnyAction> {\r\n  return (reducer: ServiceReducer<AppState[\"services\"][TServiceKey]>) => {\r\n    return (state: AppState = defaultAppState, action: AnyAction) => {\r\n      const newState = reducer(state.services[service], action, state);\r\n      if (state.services[service] != newState) {\r\n        return fpSet(state, \"services\", service, newState);\r\n      }\r\n      return state;\r\n    };\r\n  };\r\n}\r\n\r\nexport interface ServiceSelectorA0<TServiceKey extends ServiceKey, TReturn> {\r\n  (s: AppState): TReturn;\r\n  local(s: ServiceState<TServiceKey>): TReturn;\r\n}\r\n\r\nexport interface ServiceSelectorA1<\r\n  TServiceKey extends ServiceKey,\r\n  TA1,\r\n  TReturn\r\n> {\r\n  (s: AppState, a1: TA1): TReturn;\r\n  local(s: ServiceState<TServiceKey>, a1: TA1): TReturn;\r\n}\r\n\r\nexport interface ServiceSelectorA2<\r\n  TServiceKey extends ServiceKey,\r\n  TA1,\r\n  TA2,\r\n  TReturn\r\n> {\r\n  (s: AppState, a1: TA1, a2: TA2): TReturn;\r\n  local(s: ServiceState<TServiceKey>, a1: TA1, a2: TA2): TReturn;\r\n}\r\n\r\nexport interface ServiceSelectorCreator<TServiceKey extends ServiceKey> {\r\n  <TReturn>(\r\n    selector: (s: ServiceState<TServiceKey>) => TReturn\r\n  ): ServiceSelectorA0<TServiceKey, TReturn>;\r\n  <TA1, TReturn>(\r\n    selector: (s: ServiceState<TServiceKey>, a1: TA1) => TReturn\r\n  ): ServiceSelectorA1<TServiceKey, TA1, TReturn>;\r\n  <TA1, TA2, TReturn>(\r\n    selector: (s: ServiceState<TServiceKey>, a1: TA1, a2: TA2) => TReturn\r\n  ): ServiceSelectorA2<TServiceKey, TA1, TA2, TReturn>;\r\n}\r\n\r\nexport function createServiceSelectorCreator<TServiceKey extends ServiceKey>(\r\n  service: TServiceKey\r\n): ServiceSelectorCreator<TServiceKey> {\r\n  return <TArgs, TReturn>(\r\n    selector: (s: ServiceState<TServiceKey>, ...args: TArgs[]) => TReturn\r\n  ) => {\r\n    const appSelector: any = (s: AppState, ...args: TArgs[]) =>\r\n      selector(s.services[service], ...args);\r\n    appSelector.local = selector;\r\n    return appSelector;\r\n  };\r\n}\r\n","import {\r\n  EditorDamageState,\r\n  defaultEditorDamageState,\r\n} from \"./editor-damage/state\";\r\nimport {\r\n  EditorMouseServiceState,\r\n  defaultEditorMouseServiceState,\r\n} from \"./editor-mouse/state\";\r\nimport {\r\n  EditorSelectionState,\r\n  defaultEditorSelectionState,\r\n} from \"./editor-selection/state\";\r\nimport { EditorViewState, defaultEditorViewState } from \"./editor-view/state\";\r\nimport { I18NState, defaultI18NState } from \"./i18n/state\";\r\nimport { MapConfigState, defaultMapConfigState } from \"./map-config/state\";\r\nimport { MapEntitiesState, defaultMapEntityStates } from \"./map-entities/state\";\r\n\r\nexport interface ServicesState {\r\n  editorDamage: EditorDamageState;\r\n  editorMouse: EditorMouseServiceState;\r\n  editorSelection: EditorSelectionState;\r\n  editorView: EditorViewState;\r\n  i18n: I18NState;\r\n  mapConfig: MapConfigState;\r\n  mapEntities: MapEntitiesState;\r\n}\r\n\r\nexport const defaultServicesState: Readonly<ServicesState> = Object.freeze({\r\n  editorDamage: defaultEditorDamageState,\r\n  editorMouse: defaultEditorMouseServiceState,\r\n  editorSelection: defaultEditorSelectionState,\r\n  editorView: defaultEditorViewState,\r\n  i18n: defaultI18NState,\r\n  mapConfig: defaultMapConfigState,\r\n  mapEntities: defaultMapEntityStates,\r\n});\r\n","export * from \"./utils\";\r\n\r\nimport { ServicesState, defaultServicesState } from \"@/services/state\";\r\n\r\nexport interface AppState {\r\n  services: ServicesState;\r\n}\r\n\r\nexport const defaultAppState: Readonly<AppState> = Object.freeze({\r\n  services: defaultServicesState,\r\n});\r\n","import { Selector } from \"react-redux\";\r\nimport { createStructuredSelector as createSS } from \"reselect\";\r\n\r\nimport { AppState } from \"@/state\";\r\n\r\nexport type StructuredStateProps<\r\n  TSelectors extends Record<string, Selector<AppState, TOwnProps, any>>,\r\n  TOwnProps = {}\r\n> = { [K in keyof TSelectors]: ReturnType<TSelectors[K]> };\r\n\r\n/**\r\n * Type wrangling function to provide better type inferencing\r\n * for createStructuredSelector against our AppState.\r\n *\r\n * By inverting the type relationship from the real cSS, we\r\n * allow the selector to become the primary inferred type\r\n * and generate the state props from its return types.\r\n */\r\nexport function createStructuredSelector<\r\n  TSelectors extends Record<string, Selector<AppState, any, any>>\r\n>(\r\n  selectors: TSelectors\r\n): (state: AppState) => StructuredStateProps<TSelectors> {\r\n  return createSS(selectors as any) as any;\r\n}\r\n","import * as React from \"react\";\r\n\r\nimport { Provider } from \"react-redux\";\r\n\r\nimport store from \"../store\";\r\n\r\nconst StoreProvider: React.FC = ({ children }) => (\r\n  <Provider store={store}>{children}</Provider>\r\n);\r\nexport default StoreProvider;\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { AppState } from \"@/state\";\r\n\r\nimport { ACTION_EDITOR_MOUSE_MOVE } from \"@/actions/editor-mouse-move\";\r\nimport { ACTION_EDITOR_PAN } from \"@/actions/editor-pan\";\r\nimport { ACTION_EDITOR_ZOOM } from \"@/actions/editor-zoom\";\r\nimport { ACTION_EDITOR_RENDERED } from \"@/actions/editor-rendered\";\r\n\r\nexport const actionsBlacklist: string[] = [\r\n  ACTION_EDITOR_MOUSE_MOVE,\r\n  ACTION_EDITOR_PAN,\r\n  ACTION_EDITOR_ZOOM,\r\n  ACTION_EDITOR_RENDERED,\r\n];\r\n\r\nexport function actionSanitizer(action: AnyAction): AnyAction {\r\n  return action;\r\n}\r\n\r\nexport function stateSanitizer(state: AppState): any {\r\n  return state;\r\n}\r\n","import { AppState, createStructuredSelector } from \"@/state\";\r\n\r\nimport {\r\n  loadState as loadI18nState,\r\n  persistState as persistI18nState\r\n} from \"@/services/i18n/persist\";\r\n\r\nexport function loadPersistedState(state: AppState): AppState {\r\n  const persistedState = getStoredState();\r\n\r\n  return {\r\n    ...state,\r\n    services: {\r\n      ...state.services,\r\n      i18n: loadI18nState(state.services.i18n, persistedState.i18n || {})\r\n    }\r\n  };\r\n}\r\n\r\n// Store the last persisted state to avoid setting the item\r\n//  when no data has changed.\r\nlet lastPersistedState: any = null;\r\n\r\nconst buildPersistedState = createStructuredSelector({\r\n  i18n: persistI18nState\r\n});\r\n\r\nexport function savePersistedState(state: AppState) {\r\n  const persistedState = buildPersistedState(state);\r\n  if (lastPersistedState === persistedState) {\r\n    return;\r\n  }\r\n  setStoredState(persistedState);\r\n  lastPersistedState = persistedState;\r\n}\r\n\r\nconst PERSISTED_STATE_KEY = \"persisted-state\";\r\n\r\nfunction getStoredState(): any {\r\n  const stateJson = localStorage.getItem(PERSISTED_STATE_KEY);\r\n  if (!stateJson) {\r\n    return {};\r\n  }\r\n\r\n  try {\r\n    return JSON.parse(stateJson);\r\n  } catch {\r\n    return {};\r\n  }\r\n}\r\n\r\nfunction setStoredState(state: any) {\r\n  localStorage.setItem(PERSISTED_STATE_KEY, JSON.stringify(state));\r\n}\r\n","import { fork } from \"redux-saga/effects\";\r\n\r\nimport { servicesSaga } from \"@/services/saga\";\r\n\r\nexport default function* rootSaga() {\r\n  yield fork(servicesSaga);\r\n}\r\n","import {\r\n  compose,\r\n  createStore as createReduxStore,\r\n  applyMiddleware,\r\n} from \"redux\";\r\n\r\nimport createSagaMiddleware from \"redux-saga\";\r\n\r\nimport { defaultAppState } from \"@/state\";\r\nimport { initialize } from \"@/actions/initialize\";\r\n\r\nimport reducer from \"@/reducer\";\r\n\r\nimport { loadPersistedState, savePersistedState } from \"./persist\";\r\n\r\nimport {\r\n  actionSanitizer,\r\n  stateSanitizer,\r\n  actionsBlacklist,\r\n} from \"./devtool-sanitizer\";\r\n\r\nimport saga from \"./saga\";\r\n\r\nfunction createStore() {\r\n  const composeEnhancers =\r\n    (window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ &&\r\n      window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({\r\n        actionSanitizer,\r\n        stateSanitizer,\r\n        actionsBlacklist,\r\n      })) ||\r\n    compose;\r\n\r\n  const sagaMiddleware = createSagaMiddleware();\r\n\r\n  const initialState = loadPersistedState(defaultAppState);\r\n\r\n  const store = createReduxStore(\r\n    reducer,\r\n    initialState,\r\n    composeEnhancers(applyMiddleware(sagaMiddleware))\r\n  );\r\n\r\n  sagaMiddleware.run(saga);\r\n\r\n  store.subscribe(() => savePersistedState(store.getState()));\r\n  store.dispatch(initialize());\r\n\r\n  return store;\r\n}\r\n\r\nconst store = createStore();\r\nexport default store;\r\n","import \"normalize.css\";\r\n\r\nimport \"./colors.css\";\r\nimport \"./global.css\";\r\n"],"names":["ACTION_EDITOR_MODIFIERKEYS_CHANGED","editorModifierKeysChanged","modifiers","type","payload","action","ACTION_EDITOR_MOUSE_DOWN","editorMouseDown","viewportPos","modifierKeys","ACTION_EDITOR_MOUSE_MOVE","editorMouseMove","ACTION_EDITOR_MOUSE_OUT","editorMouseOut","ACTION_EDITOR_MOUSE_UP","editorMouseUp","ACTION_EDITOR_PAN","editorPan","xOffset","yOffset","x","y","ACTION_EDITOR_RENDERED","editorRendered","ACTION_EDITOR_TOOL_RADIUS_SET","editorToolRadiusSet","radius","ACTION_EDITOR_TOOL_SET","editorToolSet","tool","ACTION_EDITOR_VIEWPORT_RESIZE","editorViewportResize","width","height","ACTION_EDITOR_ZOOM","editorZoom","zoomFactor","ACTION_ENTITY_DELETE","entityDelete","entityKeys","asArray","ACTION_ENTITY_INSERT","entityInsert","entity","entities","ACTION_ENTITY_OFFSET","entityOffset","offsetX","offsetY","ACTION_ENTITY_PROTOTYPE_INSTANTIATE","entityPrototypeInstantiate","prototype","worldPos","entityKey","ACTION_INITIALIZE","initialize","ACTION_MAPCONFIG_LOAD_BLANK","mapConfigLoadBlank","ACTION_MAPCONFIG_LOAD_FILE","mapConfigLoadFile","file","ACTION_MAPCONFIG_LOAD_TEMPLATE","mapConfigLoadTemplate","templateName","ACTION_MAPFILE_RECEIVE","mapConfigReceive","mapConfig","ACTION_MAPCONFIG_SAVE","mapConfigSave","ACTION_SELECT_CLEAR","selectClear","ACTION_SELECT_ENTITY","selectEntity","mode","ACTION_SELECTION_DELETE","selectionDelete","ACTION_SET_LANGUAGE","setLanguage","language","Array","isArray","ctx","handler","save","scale","translate","restore","beginPath","fillStyle","arc","POTION_RADIUS","Math","PI","fill","isSelected","EntityDefsByType","entityType","render","onInteractionComplete","children","disabled","onLoadSave","inputRef","React","useRef","onClick","useCallback","current","click","onFileChange","e","files","target","length","ref","style","display","accept","onChange","content","placement","anchorEl","open","setOpen","useState","onClose","MenuCloseListener","isOpen","onRequestClose","variant","size","props","className","MapFromTemplateMenu","t","useTranslation","onNewWaterMap","useClickAction","onNewOilMap","loadingStatus","useSelector","loadingStatusSelector","onNewBlankMap","onSaveMap","requestMenuClose","useMenuCloseContext","autoDismissMenu","toolSize","toolRadiusSelector","currentTool","currentToolSelector","onIncreaseToolSize","onDecreaseToolSize","onPointerClick","onEraserClick","onBonesClick","isPressed","toFixed","HotkeysContainer","dispatch","useDispatch","keyHandlers","useMemo","KEYMAP_DELETE","defaultPrevented","preventDefault","HotKeys","keyMap","handlers","component","entitiesByKey","entitiesByKeySelector","selectedEntityKeys","selectedEntityKeysSelector","editorOffsetXSelector","editorOffsetYSelector","editorZoomFactorSelector","viewportWidth","editorViewportWidthSelector","viewportHeight","editorViewportHeightSelector","dragMoveOffset","dragMoveOffsetSelector","canvasRef","useEffect","getContext","console","log","clearRect","transformToMap","key","renderEntity","store","useStore","pointerRef","canvasBounds","useComponentBounds","clientToWorld","useClientToWorld","eventCanvasPoint","clientX","left","clientY","top","onMouseEnter","focus","onPointerDown","pointerId","currentTarget","setPointerCapture","getModifiers","p","onPointerMove","onPointerUp","releasePointerCapture","onKeyDown","onKeyUp","_","dropRef","useDrop","DRAGOBJECT_NEW_ENTITY","drop","item","monitor","isNewEntityDragObject","getClientOffset","worldP","animationFrame","state","getState","damageRect","editorDamageRectSelector","p1","LargestEntityRadius","p2","redrawRect","clearClientP1","worldToClientSelector","clearClientP2","normalizeRectangle","max","min","canvas","lineWidth","setLineDash","moveTo","lineTo","stroke","renderPotionStart","Object","keys","pointIntersectsRect","includes","unsubscribe","subscribe","requestAnimationFrame","cancelAnimationFrame","tabIndex","selectionRect","dragSelectionRectSelector","mousePos","viewportMousePosSelector","toolRadius","toolViewportRadiusSelector","strokeWidth","opacity","strokeDasharray","cx","cy","r","ZOOM_FACTOR","PAN_FACTOR","containerRef","containerBounds","useLayoutEffect","onWheel","ctrlMetaKey","nextZoom","deltaY","stopPropagation","shiftKey","useNativeEvent","passive","keymap","MenuCloseContext","createContext","useContext","onCloseProp","onCloseChain","Provider","value","secondary","onItemClick","d","noop","popoverRef","setPopoverRef","attributes","styles","usePopper","usePopoverChild","popoverChildren","registerPopoverChild","unregisterPopoverChild","useArrayState","insideRefs","useOutsideMouseEvent","createPortal","PopoverChildContextProvider","popper","zIndex","document","body","noopPopoverChildContext","PopoverChildContext","usePopoverChildContext","contextRegister","contextUnregister","parent","parentRegister","parentUnregister","element","providedContext","popoverContext","ctxRef","title","titlebar","newEntityDragObject","makeImg","src","img","Image","onerror","error","bind","DangerZoneImages","Bone1","Bone2","Fang1","Fang2","Skull1","DangerZonePartDef","hitRadius","tweakStyles","rotate","angle","fillRect","w","h","drawImage","ExperienceBonusDef","PotionEffectImages","Acid","Berserker","Bounce","Charm","Crop","Explosion","Fire","Fly","Frost","Growth","Hallucinations","Healing","Invisibility","Libido","Light","Lightning","Mana","Necromancy","Poison","SharpVision","Sleep","SlowDown","StoneSkin","PotionEffectDef","rect","effect","VortexDef","DangerZonePart","ExperienceBonus","PotionEffect","Vortex","reduce","def","TileDataByType","tileType","data","tileData","tileEntities","padding","tilePadding","tileBounds","tileSize","calcSize","tileXOrdinal","floor","ceil","tileYOrdinal","i","tileEntity","push","fpSetByArray","path","firstPaths","slice","map","String","lastPath","newData","clone","rollingTarget","seg","obj","assign","args","ZeroPoint","freeze","ZeroRect","v","sqrt","history","createHashHistory","actionCreator","preBind","defaultValue","items","setItems","addItem","removeItem","setSize","right","bottom","observer","el","b","getBoundingClientRect","observe","disconnect","listener","options","listenTarget","addEventListener","removeEventListener","isTruthy","Boolean","onOutsideEvent","when","onEvent","elements","filter","every","contains","selector","rootEl","getElementById","ReactDOM","oil","water","TemplatesByName","MODIFIER_KEYS_NONE","ctrlKey","altKey","metaKey","keyboardModifierUseMeta","status","potionEffectPrototype","i18nKey","bonePrototype","EntityCategories","category","dragRef","useDrag","finalizedReducer","finalizeReducerList","defaultAppState","PRIORITY_PRE","PRIORITY_POST","priority","reducer","weight","reducers","concat","finalizedList","Router","DndProvider","backend","HTML5Backend","Switch","Route","exact","Redirect","to","osPlatform","os","family","OSType","test","isProd","defaultMode","selectedIds","chosenIds","chosen","indexOf","createEditorDamageReducer","isEditorRenderedAction","damageWorldRect","appState","isEditorPanAction","isEditorZoomAction","isEditorViewportResizeAction","Number","NEGATIVE_INFINITY","POSITIVE_INFINITY","reducerPriority","isEntityDeleteAction","entityFromKeySelector","addPointToRect","isEntityInsertAction","isEntityOffsetAction","isEntityPrototypeInstantiateAction","concatReducers","isMapConfigReceiveAction","isSelectClearAction","isSelectEntityAction","createEditorDamageSelector","createServiceReducerCreator","createServiceSelectorCreator","defaultEditorDamageState","createEditorMouseReducer","isEditorModifierKeysChangedAction","isEditorMouseDownAction","currentPointerGesture","mouseDownViewportPos","mouseViewportPos","isEditorMouseMoveAction","services","editorMouse","magnitude","pointSubtract","mouseDownWorldPos","clientToWorldSelector","entityKeyAtMouse","entityKeyAtPointSelector","selectionMode","getSelectMode","fpSet","detectGestureReducer","currentGesture","previousPos","currentPos","offset","panGestureReducer","gestureReducer","worldPoint","entityKeysAtPointSelector","eraserReducer","pointAdd","generateTileEntities","vec","paintDangerZoneReducer","toolReducer","mouseState","isEditorMouseOutAction","defaultEditorMouseServiceState","isEditorMouseUpAction","worldMouseDownPos","worldMouseUpPos","entitiesById","idsToSelect","entries","id","completeDragSelect","editorSelection","completeDragMove","selectedKey","completeClick","isEditorToolRadiusSetAction","isEditorToolSetAction","createSelector","worldMousePosSelector","worldMouseDownPosSelector","worldMousePos","createEditorMouseSelector","dragStart","dragEnd","editorView","_defaultState","createEditorSelectionReducer","defaultEditorSelectionState","combineSelection","isSelectionDeleteAction","isEntitySelectedSelector","createEditorSelectionSelector","createEditorViewReducer","defaultEditorViewState","newMousePos","worldToClient","createEditorViewSelector","I18nextProvider","i18n","use","initReactI18next","init","fallbackLng","ns","defaultNS","resources","en","common","potioncraft","debug","interpolation","escapeValue","react","wait","persistState","createStructuredSelector","currentLanguageSelector","persisted","changeLanguage","createI18nReducer","defaultI18NState","lang","createI18nSelector","createMapConfigReducer","defaultMapConfigState","isMapConfigLoadFileAction","errorMessage","fork","handleMapConfigLoadBlank","put","takeEvery","handleMapConfigLoadFile","text","call","JSON","parse","handleMapConfigLoadTemplate","template","saveProject","select","projectName","window","showSaveFilePicker","saveNativeFileApi","saveLegacy","warn","fileHandle","suggestedName","types","description","name","getFile","substr","lastIndexOf","mapFileSelector","writable","createWritable","write","stringify","close","blob","Blob","saveAs","mapEntities","createMapConfigSelector","createMapEntitiesReducer","removeFromRegionContainer","addToRegionContainer","offsetP","defaultMapEntityStates","ORIGIN_OFFSET","getRegionIndexsFromPoint","getRegionIndexesFromRect","x1","y1","x2","y2","indexes","addedOOB","addOOB","MAP_WIDTH","MAP_HEIGHT","addToRegion","region","removeFromRegion","REGION_COUNT","container","regionIndexes","regionKeys","forEach","regionIndex","outOfBoundsRegion","entityRegions","createMapEntitiesSelector","entitityKeysSelector","getEntityKeysFromPoint","ignoreHitRadius","getEntityKeysFromRect","result","defaultRegion","service","newState","appSelector","s","local","defaultServicesState","editorDamage","selectors","actionsBlacklist","persistedState","stateJson","localStorage","getItem","PERSISTED_STATE_KEY","getStoredState","lastPersistedState","buildPersistedState","setItem","setStoredState","servicesSaga","composeEnhancers","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","actionSanitizer","stateSanitizer","compose","sagaMiddleware","initialState","loadPersistedState","applyMiddleware","run","savePersistedState","createStore"],"sourceRoot":""}